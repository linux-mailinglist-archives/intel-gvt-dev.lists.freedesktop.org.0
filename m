Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C9B3A6CC0B
	for <lists+intel-gvt-dev@lfdr.de>; Thu, 18 Jul 2019 11:40:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1FB396E378;
	Thu, 18 Jul 2019 09:40:07 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6DB7D6E375
 for <intel-gvt-dev@lists.freedesktop.org>;
 Thu, 18 Jul 2019 09:40:05 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 18 Jul 2019 02:40:05 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,276,1559545200"; d="scan'208";a="175970559"
Received: from cfl-host.sh.intel.com ([10.239.158.129])
 by FMSMGA003.fm.intel.com with ESMTP; 18 Jul 2019 02:40:04 -0700
From: fred gao <fred.gao@intel.com>
To: intel-gvt-dev@lists.freedesktop.org
Subject: [PATCH v3 2/3] drm/i915/gvt: Add MI command valid length check
Date: Thu, 18 Jul 2019 09:39:09 +0800
Message-Id: <20190718013909.3344-1-fred.gao@intel.com>
X-Mailer: git-send-email 2.17.1
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: Gao@freedesktop.org, "Gao, Fred" <fred.gao@intel.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

RnJvbTogIkdhbywgRnJlZCIgPGZyZWQuZ2FvQGludGVsLmNvbT4KCkFkZCB0aGUgY29uc3RhbnQg
dmFsaWQgbGVuZ3RoIG9mIE1JIGNvbW1hbmQuCgp2MjogQWRkIEZfVkFMX0NPTlNUIGZsYWcuICha
aGVueXUgV2FuZykKClNpZ25lZC1vZmYtYnk6IEdhbywgRnJlZCA8ZnJlZC5nYW9AaW50ZWwuY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRfcGFyc2VyLmMgfCA3NCArKysrKysr
KysrKysrKysrKystLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA1MSBpbnNlcnRpb25zKCspLCAy
MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21k
X3BhcnNlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2NtZF9wYXJzZXIuYwppbmRleCA0
MmExMGIyMDA3NDQuLmE3MzEwMmViZDc2ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2NtZF9wYXJzZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3Bh
cnNlci5jCkBAIC0zNzQsNiArMzc0LDE5IEBAIHR5cGVkZWYgaW50ICgqcGFyc2VyX2NtZF9oYW5k
bGVyKShzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMpOwogI2RlZmluZSBBRERSX0ZJWF80KHgx
LCB4MiwgeDMsIHg0KQkoQUREUl9GSVhfMSh4MSkgfCBBRERSX0ZJWF8zKHgyLCB4MywgeDQpKQog
I2RlZmluZSBBRERSX0ZJWF81KHgxLCB4MiwgeDMsIHg0LCB4NSkgIChBRERSX0ZJWF8xKHgxKSB8
IEFERFJfRklYXzQoeDIsIHgzLCB4NCwgeDUpKQogCisjZGVmaW5lIE9QX0xFTkdUSF9CSUFTIDIK
KyNkZWZpbmUgQ01EX0xFTih2YWx1ZSkgICh2YWx1ZSArIE9QX0xFTkdUSF9CSUFTKQorCitzdGF0
aWMgaW50IGd2dF9jaGVja192YWxpZF9jbWRfbGVuZ3RoKGludCBsZW4sIGludCB2YWxpZF9sZW4p
Cit7CisJaWYgKHZhbGlkX2xlbiAhPSBsZW4pIHsKKwkJZ3Z0X2VycigibGVuIGlzIG5vdCB2YWxp
ZDogIGxlbj0ldSAgdmFsaWRfbGVuPSV1XG4iLAorCQkJbGVuLCB2YWxpZF9sZW4pOworCQlyZXR1
cm4gLUVGQVVMVDsKKwl9CisJcmV0dXJuIDA7Cit9CisKIHN0cnVjdCBjbWRfaW5mbyB7CiAJY29u
c3QgY2hhciAqbmFtZTsKIAl1MzIgb3Bjb2RlOwpAQCAtMTkxOCwxOCArMTkzMSwyMSBAQCBzdGF0
aWMgY29uc3Qgc3RydWN0IGNtZF9pbmZvIGNtZF9pbmZvW10gPSB7CiAJeyJNSV9ESVNQTEFZX0ZM
SVAiLCBPUF9NSV9ESVNQTEFZX0ZMSVAsIEZfTEVOX1ZBUiwKIAkJUl9SQ1MgfCBSX0JDUywgRF9B
TEwsIDAsIDgsIGNtZF9oYW5kbGVyX21pX2Rpc3BsYXlfZmxpcH0sCiAKLQl7Ik1JX1NFTUFQSE9S
RV9NQk9YIiwgT1BfTUlfU0VNQVBIT1JFX01CT1gsIEZfTEVOX1ZBUiwgUl9BTEwsIERfQUxMLAot
CQkwLCA4LCBOVUxMfSwKKwl7Ik1JX1NFTUFQSE9SRV9NQk9YIiwgT1BfTUlfU0VNQVBIT1JFX01C
T1gsIEZfTEVOX1ZBUiB8IEZfTEVOX1ZBUl9GSVhFRCwKKwkJUl9BTEwsIERfQUxMLCAwLCA4LCBO
VUxMLCBDTURfTEVOKDEpfSwKIAogCXsiTUlfTUFUSCIsIE9QX01JX01BVEgsIEZfTEVOX1ZBUiwg
Ul9BTEwsIERfQUxMLCAwLCA4LCBOVUxMfSwKIAotCXsiTUlfVVJCX0NMRUFSIiwgT1BfTUlfVVJC
X0NMRUFSLCBGX0xFTl9WQVIsIFJfUkNTLCBEX0FMTCwgMCwgOCwgTlVMTH0sCisJeyJNSV9VUkJf
Q0xFQVIiLCBPUF9NSV9VUkJfQ0xFQVIsIEZfTEVOX1ZBUiB8IEZfTEVOX1ZBUl9GSVhFRCwgUl9S
Q1MsCisJCURfQUxMLCAwLCA4LCBOVUxMLCBDTURfTEVOKDApfSwKIAotCXsiTUlfU0VNQVBIT1JF
X1NJR05BTCIsIE9QX01JX1NFTUFQSE9SRV9TSUdOQUwsIEZfTEVOX1ZBUiwgUl9BTEwsCi0JCURf
QkRXX1BMVVMsIDAsIDgsIE5VTEx9LAorCXsiTUlfU0VNQVBIT1JFX1NJR05BTCIsIE9QX01JX1NF
TUFQSE9SRV9TSUdOQUwsCisJCUZfTEVOX1ZBUiB8IEZfTEVOX1ZBUl9GSVhFRCwgUl9BTEwsIERf
QkRXX1BMVVMsIDAsIDgsCisJCU5VTEwsIENNRF9MRU4oMCl9LAogCi0JeyJNSV9TRU1BUEhPUkVf
V0FJVCIsIE9QX01JX1NFTUFQSE9SRV9XQUlULCBGX0xFTl9WQVIsIFJfQUxMLAotCQlEX0JEV19Q
TFVTLCBBRERSX0ZJWF8xKDIpLCA4LCBjbWRfaGFuZGxlcl9taV9zZW1hcGhvcmVfd2FpdH0sCisJ
eyJNSV9TRU1BUEhPUkVfV0FJVCIsIE9QX01JX1NFTUFQSE9SRV9XQUlULAorCQlGX0xFTl9WQVIg
fCBGX0xFTl9WQVJfRklYRUQsIFJfQUxMLCBEX0JEV19QTFVTLCBBRERSX0ZJWF8xKDIpLAorCQk4
LCBjbWRfaGFuZGxlcl9taV9zZW1hcGhvcmVfd2FpdCwgQ01EX0xFTigyKX0sCiAKIAl7Ik1JX1NU
T1JFX0RBVEFfSU1NIiwgT1BfTUlfU1RPUkVfREFUQV9JTU0sIEZfTEVOX1ZBUiwgUl9BTEwsIERf
QkRXX1BMVVMsCiAJCUFERFJfRklYXzEoMSksIDEwLCBjbWRfaGFuZGxlcl9taV9zdG9yZV9kYXRh
X2ltbX0sCkBAIC0xOTQzLDggKzE5NTksOSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGNtZF9pbmZv
IGNtZF9pbmZvW10gPSB7CiAJeyJNSV9VUERBVEVfR1RUIiwgT1BfTUlfVVBEQVRFX0dUVCwgRl9M
RU5fVkFSLCBSX0FMTCwgRF9CRFdfUExVUywgMCwgMTAsCiAJCWNtZF9oYW5kbGVyX21pX3VwZGF0
ZV9ndHR9LAogCi0JeyJNSV9TVE9SRV9SRUdJU1RFUl9NRU0iLCBPUF9NSV9TVE9SRV9SRUdJU1RF
Ul9NRU0sIEZfTEVOX1ZBUiwgUl9BTEwsCi0JCURfQUxMLCBBRERSX0ZJWF8xKDIpLCA4LCBjbWRf
aGFuZGxlcl9zcm19LAorCXsiTUlfU1RPUkVfUkVHSVNURVJfTUVNIiwgT1BfTUlfU1RPUkVfUkVH
SVNURVJfTUVNLAorCQlGX0xFTl9WQVIgfCBGX0xFTl9WQVJfRklYRUQsIFJfQUxMLCBEX0FMTCwg
QUREUl9GSVhfMSgyKSwgOCwKKwkJY21kX2hhbmRsZXJfc3JtLCBDTURfTEVOKDIpfSwKIAogCXsi
TUlfRkxVU0hfRFciLCBPUF9NSV9GTFVTSF9EVywgRl9MRU5fVkFSLCBSX0FMTCwgRF9BTEwsIDAs
IDYsCiAJCWNtZF9oYW5kbGVyX21pX2ZsdXNoX2R3fSwKQEAgLTE5NTIsMjYgKzE5NjksMzAgQEAg
c3RhdGljIGNvbnN0IHN0cnVjdCBjbWRfaW5mbyBjbWRfaW5mb1tdID0gewogCXsiTUlfQ0xGTFVT
SCIsIE9QX01JX0NMRkxVU0gsIEZfTEVOX1ZBUiwgUl9BTEwsIERfQUxMLCBBRERSX0ZJWF8xKDEp
LAogCQkxMCwgY21kX2hhbmRsZXJfbWlfY2xmbHVzaH0sCiAKLQl7Ik1JX1JFUE9SVF9QRVJGX0NP
VU5UIiwgT1BfTUlfUkVQT1JUX1BFUkZfQ09VTlQsIEZfTEVOX1ZBUiwgUl9BTEwsCi0JCURfQUxM
LCBBRERSX0ZJWF8xKDEpLCA2LCBjbWRfaGFuZGxlcl9taV9yZXBvcnRfcGVyZl9jb3VudH0sCisJ
eyJNSV9SRVBPUlRfUEVSRl9DT1VOVCIsIE9QX01JX1JFUE9SVF9QRVJGX0NPVU5ULAorCQlGX0xF
Tl9WQVIgfCBGX0xFTl9WQVJfRklYRUQsIFJfQUxMLCBEX0FMTCwgQUREUl9GSVhfMSgxKSwgNiwK
KwkJY21kX2hhbmRsZXJfbWlfcmVwb3J0X3BlcmZfY291bnQsIENNRF9MRU4oMil9LAogCi0JeyJN
SV9MT0FEX1JFR0lTVEVSX01FTSIsIE9QX01JX0xPQURfUkVHSVNURVJfTUVNLCBGX0xFTl9WQVIs
IFJfQUxMLAotCQlEX0FMTCwgQUREUl9GSVhfMSgyKSwgOCwgY21kX2hhbmRsZXJfbHJtfSwKKwl7
Ik1JX0xPQURfUkVHSVNURVJfTUVNIiwgT1BfTUlfTE9BRF9SRUdJU1RFUl9NRU0sCisJCUZfTEVO
X1ZBUiB8IEZfTEVOX1ZBUl9GSVhFRCwgUl9BTEwsIERfQUxMLCBBRERSX0ZJWF8xKDIpLCA4LAor
CQljbWRfaGFuZGxlcl9scm0sIENNRF9MRU4oMil9LAogCi0JeyJNSV9MT0FEX1JFR0lTVEVSX1JF
RyIsIE9QX01JX0xPQURfUkVHSVNURVJfUkVHLCBGX0xFTl9WQVIsIFJfQUxMLAotCQlEX0FMTCwg
MCwgOCwgY21kX2hhbmRsZXJfbHJyfSwKKwl7Ik1JX0xPQURfUkVHSVNURVJfUkVHIiwgT1BfTUlf
TE9BRF9SRUdJU1RFUl9SRUcsCisJCUZfTEVOX1ZBUiB8IEZfTEVOX1ZBUl9GSVhFRCwgUl9BTEws
IERfQUxMLCAwLCA4LAorCQljbWRfaGFuZGxlcl9scnIsIENNRF9MRU4oMSl9LAogCi0JeyJNSV9S
U19TVE9SRV9EQVRBX0lNTSIsIE9QX01JX1JTX1NUT1JFX0RBVEFfSU1NLCBGX0xFTl9WQVIsIFJf
UkNTLAotCQlEX0FMTCwgMCwgOCwgTlVMTH0sCisJeyJNSV9SU19TVE9SRV9EQVRBX0lNTSIsIE9Q
X01JX1JTX1NUT1JFX0RBVEFfSU1NLAorCQlGX0xFTl9WQVIgfCBGX0xFTl9WQVJfRklYRUQsIFJf
UkNTLCBEX0FMTCwgMCwKKwkJOCwgTlVMTCwgQ01EX0xFTigyKX0sCiAKLQl7Ik1JX0xPQURfVVJC
X01FTSIsIE9QX01JX0xPQURfVVJCX01FTSwgRl9MRU5fVkFSLCBSX1JDUywgRF9BTEwsCi0JCUFE
RFJfRklYXzEoMiksIDgsIE5VTEx9LAorCXsiTUlfTE9BRF9VUkJfTUVNIiwgT1BfTUlfTE9BRF9V
UkJfTUVNLCBGX0xFTl9WQVIgfCBGX0xFTl9WQVJfRklYRUQsCisJCVJfUkNTLCBEX0FMTCwgQURE
Ul9GSVhfMSgyKSwgOCwgTlVMTCwgQ01EX0xFTigyKX0sCiAKIAl7Ik1JX1NUT1JFX1VSTV9NRU0i
LCBPUF9NSV9TVE9SRV9VUk1fTUVNLCBGX0xFTl9WQVIsIFJfUkNTLCBEX0FMTCwKIAkJQUREUl9G
SVhfMSgyKSwgOCwgTlVMTH0sCiAKLQl7Ik1JX09QXzJFIiwgT1BfTUlfMkUsIEZfTEVOX1ZBUiwg
Ul9BTEwsIERfQkRXX1BMVVMsIEFERFJfRklYXzIoMSwgMiksCi0JCTgsIGNtZF9oYW5kbGVyX21p
X29wXzJlfSwKKwl7Ik1JX09QXzJFIiwgT1BfTUlfMkUsIEZfTEVOX1ZBUiB8IEZfTEVOX1ZBUl9G
SVhFRCwgUl9BTEwsIERfQkRXX1BMVVMsCisJCUFERFJfRklYXzIoMSwgMiksIDgsIGNtZF9oYW5k
bGVyX21pX29wXzJlLCBDTURfTEVOKDMpfSwKIAogCXsiTUlfT1BfMkYiLCBPUF9NSV8yRiwgRl9M
RU5fVkFSLCBSX0FMTCwgRF9CRFdfUExVUywgQUREUl9GSVhfMSgxKSwKIAkJOCwgY21kX2hhbmRs
ZXJfbWlfb3BfMmZ9LApAQCAtMTk4MSw4ICsyMDAyLDggQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBj
bWRfaW5mbyBjbWRfaW5mb1tdID0gewogCQljbWRfaGFuZGxlcl9taV9iYXRjaF9idWZmZXJfc3Rh
cnR9LAogCiAJeyJNSV9DT05ESVRJT05BTF9CQVRDSF9CVUZGRVJfRU5EIiwgT1BfTUlfQ09ORElU
SU9OQUxfQkFUQ0hfQlVGRkVSX0VORCwKLQkJRl9MRU5fVkFSLCBSX0FMTCwgRF9BTEwsIEFERFJf
RklYXzEoMiksIDgsCi0JCWNtZF9oYW5kbGVyX21pX2NvbmRpdGlvbmFsX2JhdGNoX2J1ZmZlcl9l
bmR9LAorCQlGX0xFTl9WQVIgfCBGX0xFTl9WQVJfRklYRUQsIFJfQUxMLCBEX0FMTCwgQUREUl9G
SVhfMSgyKSwgOCwKKwkJY21kX2hhbmRsZXJfbWlfY29uZGl0aW9uYWxfYmF0Y2hfYnVmZmVyX2Vu
ZCwgQ01EX0xFTigyKX0sCiAKIAl7Ik1JX0xPQURfU0NBTl9MSU5FU19JTkNMIiwgT1BfTUlfTE9B
RF9TQ0FOX0xJTkVTX0lOQ0wsIEZfTEVOX0NPTlNULAogCQlSX1JDUyB8IFJfQkNTLCBEX0FMTCwg
MCwgMiwgTlVMTH0sCkBAIC0yNTcyLDYgKzI1OTMsMTMgQEAgc3RhdGljIGludCBjbWRfcGFyc2Vy
X2V4ZWMoc3RydWN0IHBhcnNlcl9leGVjX3N0YXRlICpzKQogCQkJICBjbWRfbGVuZ3RoKHMpLCBz
LT5idWZfdHlwZSwgcy0+YnVmX2FkZHJfdHlwZSwKIAkJCSAgcy0+d29ya2xvYWQsIGluZm8tPm5h
bWUpOwogCisJaWYgKChpbmZvLT5mbGFnICYgRl9MRU5fTUFTSykgPT0gRl9MRU5fVkFSX0ZJWEVE
KSB7CisJCXJldCA9IGd2dF9jaGVja192YWxpZF9jbWRfbGVuZ3RoKGNtZF9sZW5ndGgocyksCisJ
CQlpbmZvLT52YWxpZF9sZW4pOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9CisKIAlp
ZiAoaW5mby0+aGFuZGxlcikgewogCQlyZXQgPSBpbmZvLT5oYW5kbGVyKHMpOwogCQlpZiAocmV0
IDwgMCkgewotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwppbnRlbC1ndnQtZGV2IG1haWxpbmcgbGlzdAppbnRlbC1ndnQtZGV2QGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2ludGVsLWd2dC1kZXY=
