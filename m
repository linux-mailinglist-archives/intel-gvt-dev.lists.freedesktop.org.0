Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 98D16288628
	for <lists+intel-gvt-dev@lfdr.de>; Fri,  9 Oct 2020 11:42:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 424396EC97;
	Fri,  9 Oct 2020 09:42:18 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C41546ECA1;
 Fri,  9 Oct 2020 09:42:16 +0000 (UTC)
IronPort-SDR: jlshqSfLa8F/TBCjv60jBY6sT4PRnggQlDHj1Lv1Z3jQu5NUbQde9ZKH2ax4Jcq23fRD/xjw6+
 LVQfg/lOqFow==
X-IronPort-AV: E=McAfee;i="6000,8403,9768"; a="165525996"
X-IronPort-AV: E=Sophos;i="5.77,354,1596524400"; d="scan'208";a="165525996"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by orsmga103.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 09 Oct 2020 02:42:16 -0700
IronPort-SDR: vNHxnfWGgt7bw6wSYdDWujMamSHFu5J61rtQRUezlFWHZQ54zRdr8vcKv6eJ541woaf9vjLQHE
 ybbnncYzQooQ==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.77,354,1596524400"; d="scan'208";a="316982796"
Received: from unknown (HELO xzhan34-mobl2.bj.intel.com) ([10.238.154.62])
 by orsmga006.jf.intel.com with ESMTP; 09 Oct 2020 02:42:13 -0700
From: Xiaolin Zhang <xiaolin.zhang@intel.com>
To: intel-gvt-dev@lists.freedesktop.org,
	intel-gfx@lists.freedesktop.org
Subject: [PATCH v2 06/12] drm/i915: vgpu workload submisison pv support
Date: Fri,  9 Oct 2020 08:04:37 +0800
Message-Id: <1602201883-27829-7-git-send-email-xiaolin.zhang@intel.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1602201883-27829-1-git-send-email-xiaolin.zhang@intel.com>
References: <1602201883-27829-1-git-send-email-xiaolin.zhang@intel.com>
MIME-Version: 1.0
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@linux.intel.com, kevin.tian@intel.com,
 Xiaolin Zhang <xiaolin.zhang@intel.com>, joonas.lahtinen@linux.intel.com,
 zhenyuw@linux.intel.com, chris@chris-wilson.co.uk, zhiyuan.lv@intel.com,
 zhi.a.wang@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

dG8gaW1wcm92ZSBlZmZpY2llbmN5IGFuZCByZWR1Y2UgdGhlIGNvbXBsZXhpdHkgb2YgdmdwdSB3
b3JrbG9hZApzdWJtaXNzaW9uIHN1cHBvcnQsIGEgcHYgdmVyc2lvbiBvZiB3b3JrbG9hZCBzdWJt
aXNzaW9uIGJhY2tlbmQKaW1wbGVtZW50ZWQgd2l0aCBlbmdpbmUgc3VibWlzc2lvbiBkYXRhIGlu
IHRoZSBzaGFyZWQgbWVtb3J5IGFuZAplbGltaW5hdGluZyBleGVjbGlzdHMgY3NiIHByb2Nlc3Mg
YW5kIGNvbnRleHQgc3dpdGNoIGludGVycnVwdAppbiBzdWJtaXNpc2lvbiByb3V0aW5lLgoKbmV3
IFBWX1NVQk1JU1NJT04gcHZfY2FwIGlzIHVzZWQgdG8gY29udHJvbCB0aGlzIGxldmVsIG9mIHB2
IHN1cHBvcnQgaW4KYm90aCBndWVzdCBhbmQgaG9zdCBzaWRlLgoKU2lnbmVkLW9mZi1ieTogWGlh
b2xpbiBaaGFuZyA8eGlhb2xpbi56aGFuZ0BpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvTWFrZWZpbGUgICAgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYyAgICAgICAgfCAgIDIgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV92Z3B1LmMgICAgICAgICAgIHwgIDY4ICsrKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV92Z3B1LmggICAgICAgICAgIHwgIDI4ICsrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
cHZfc3VibWlzc2lvbi5jIHwgMzI1ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiA1IGZp
bGVzIGNoYW5nZWQsIDQxOCBpbnNlcnRpb25zKCspLCA3IGRlbGV0aW9ucygtKQogY3JlYXRlIG1v
ZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3B2X3N1Ym1pc3Npb24uYwoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvTWFrZWZpbGUKaW5kZXggZTU1NzRlNTAuLjEzZDE3MzkgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2Vm
aWxlCkBAIC0yNjksNyArMjY5LDcgQEAgaTkxNS0kKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkg
Kz0gXAogCXNlbGZ0ZXN0cy9saWJyYXBsLm8KIAogIyB2aXJ0dWFsIGdwdSBjb2RlCi1pOTE1LXkg
Kz0gaTkxNV92Z3B1Lm8KK2k5MTUteSArPSBpOTE1X3ZncHUubyBpbnRlbF9wdl9zdWJtaXNzaW9u
Lm8KIAogaWZlcSAoJChDT05GSUdfRFJNX0k5MTVfR1ZUKSx5KQogaTkxNS15ICs9IGludGVsX2d2
dC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IDI4NzUzNzAuLmQ1YjZkZTgg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC01MDc5LDYgKzUwNzksOCBAQCB2
b2lkIGludGVsX2V4ZWNsaXN0c19zZXRfZGVmYXVsdF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSkKIAkJCWlmIChJU19BQ1RJVkUoQ09ORklHX0RSTV9JOTE1X1RJTUVT
TElDRV9EVVJBVElPTikpCiAJCQkJZW5naW5lLT5mbGFncyB8PSBJOTE1X0VOR0lORV9IQVNfVElN
RVNMSUNFUzsKIAkJfQorCX0gZWxzZSB7CisJCWludGVsX3ZncHVfcHZfY29uZmlnX2NhcHMoZW5n
aW5lLT5pOTE1LCBQVl9TVUJNSVNTSU9OLCBlbmdpbmUpOwogCX0KIAogCWlmIChJTlRFTF9HRU4o
ZW5naW5lLT5pOTE1KSA+PSAxMikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdmdwdS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92Z3B1LmMKaW5kZXggYjExZmNh
ZS4uZTY5YTJkZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92Z3B1LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92Z3B1LmMKQEAgLTEwMSw2ICsxMDEsNyBA
QCB2b2lkIGludGVsX3ZncHVfZGV0ZWN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAogCS8qIGd1ZXN0IGRyaXZlciBQViBjYXBhYmlsaXR5ICovCiAJZGV2X3ByaXYtPnZncHUu
cHZfY2FwcyA9IFBWX1BQR1RUIHwgUFZfR0dUVDsKKwlkZXZfcHJpdi0+dmdwdS5wdl9jYXBzIHw9
IFBWX1NVQk1JU1NJT047CiAKIAlpZiAoaW50ZWxfdmdwdV9wdl9kZXRlY3RfY2FwcyhkZXZfcHJp
diwgc2hhcmVkX2FyZWEpKSB7CiAJCWRybV9pbmZvKCZkZXZfcHJpdi0+ZHJtLApAQCAtMTIyLDYg
KzEyMyw3IEBAIHZvaWQgaW50ZWxfdmdwdV9kZXN0cm95KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogCWlmICghaW50ZWxfdmdwdV9hY3RpdmUoaTkxNSkgfHwgIXB2KQogCQlyZXR1cm47
CiAKKwlrZnJlZShwdi0+c3VibWlzc2lvbik7CiAJX19mcmVlX3BhZ2UodmlydF90b19wYWdlKHB2
LT5tZW0pKTsKIAlrZnJlZShwdik7CiB9CkBAIC02MDYsNyArNjA4LDggQEAgc3RhdGljIHUzMiBp
bnRlbF92Z3B1X3B2X2dldF9uZXh0X2ZlbmNlKHN0cnVjdCBpbnRlbF92Z3B1X3B2ICpwdikKIH0K
IAogc3RhdGljIGludCBpbnRlbF92Z3B1X3B2X3NlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCi0JCQkgICAgICBjb25zdCB1MzIgKmFjdGlvbiwgdTMyIGxlbiwgdTMyICpzdGF0dXMp
CisJCQkgICAgICBjb25zdCB1MzIgKmFjdGlvbiwgdTMyIGxlbiwgdTMyICpzdGF0dXMsCisJCQkg
ICAgICB2b2lkIF9faW9tZW0gKmFkZHIpCiB7CiAJc3RydWN0IGk5MTVfdmlydHVhbF9ncHUgKnZn
cHUgPSAmaTkxNS0+dmdwdTsKIAlzdHJ1Y3QgaW50ZWxfdmdwdV9wdiAqcHYgPSB2Z3B1LT5wdjsK
QEAgLTYyNCw3ICs2MjcsMTAgQEAgc3RhdGljIGludCBpbnRlbF92Z3B1X3B2X3NlbmQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKHVubGlrZWx5KGVycikpCiAJCWdvdG8gdW5s
aW5rOwogCi0JaTkxNS0+dmdwdS5wdi0+bm90aWZ5KGk5MTUpOworCWlmIChhZGRyKQorCQl3cml0
ZWwoVkdUX0cyVl9QVl9TRU5EX1RSSUdHRVIsIGFkZHIgKyB2Z3RpZl9vZmZzZXQoZzJ2X25vdGlm
eSkpOworCWVsc2UKKwkJaTkxNS0+dmdwdS5wdi0+bm90aWZ5KGk5MTUpOwogCiAJZXJyID0gaW50
ZWxfdmdwdV9wdl93YWl0X2Rlc2NfdXBkYXRlKGk5MTUsIGRlc2MsIGZlbmNlLCBzdGF0dXMpOwog
CWlmICh1bmxpa2VseShlcnIpKQpAQCAtNjUyLDcgKzY1OCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxf
dmdwdV9wdl9zZW5kX2NtZF9idWYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIAlz
cGluX2xvY2tfaXJxc2F2ZSgmdmdwdS0+cHYtPmxvY2ssIGZsYWdzKTsKIAotCXJldCA9IGludGVs
X3ZncHVfcHZfc2VuZChpOTE1LCBhY3Rpb24sIGxlbiwgJnN0YXR1cyk7CisJcmV0ID0gaW50ZWxf
dmdwdV9wdl9zZW5kKGk5MTUsIGFjdGlvbiwgbGVuLCAmc3RhdHVzLCBOVUxMKTsKIAlpZiAodW5s
aWtlbHkocmV0IDwgMCkpIHsKIAkJZHJtX2VycigmaTkxNS0+ZHJtLCAiUFY6IHNlbmQgYWN0aW9u
ICUjWCBmYWlsZWQ7IGVycj0lZCBzdGF0dXM9JSNYXG4iLAogCQkJYWN0aW9uWzBdLCByZXQsIHN0
YXR1cyk7CkBAIC02NzEsNiArNjc3LDE5IEBAIHN0YXRpYyB2b2lkIGludGVsX3ZncHVfcHZfbm90
aWZ5X21taW8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkJICAgdmd0aWZf
cmVnKGcydl9ub3RpZnkpLCBWR1RfRzJWX1BWX1NFTkRfVFJJR0dFUik7CiB9CiAKK3N0YXRpYyB2
b2lkCitpbnRlbF92Z3B1X3B2X3JlZ2lzdGVyX2NhcF9ncGEoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCisJCQkgICAgICAgc3RydWN0IGludGVsX3ZncHVfcHZfY2FwX2FkZHIgKmNhcF9h
ZGRyLAorCQkJICAgICAgIHZvaWQgX19pb21lbSAqc2hhcmVkX2FyZWEpCit7CisJdTMyIGRhdGFb
MzJdOworCXUzMiBzdGF0dXMgPSB+MDsKKworCWRhdGFbMF0gPSBQVl9DTURfUkVHSVNURVJfQ0FQ
X0dQQTsKKwltZW1jcHkoJmRhdGFbMV0sIGNhcF9hZGRyLCBzaXplb2YoKmNhcF9hZGRyKSk7CisJ
aW50ZWxfdmdwdV9wdl9zZW5kKGk5MTUsIGRhdGEsIDEgKyBzaXplb2YoY2FwX2FkZHIpLCAmc3Rh
dHVzLCBzaGFyZWRfYXJlYSk7Cit9CisKIC8qCiAgKiBzaGFyZWRfcGFnZSBzZXR1cCBmb3IgVkdQ
VSBQViBmZWF0dXJlcwogICovCkBAIC02ODAsMTcgKzY5OSwyMSBAQCBzdGF0aWMgaW50IGludGVs
X3ZncHVfcHZfc2V0dXBfc2hhcmVkX3BhZ2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJdm9pZCBfX2lvbWVtICphZGRyOwogCXN0cnVjdCBpbnRlbF92Z3B1X3B2ICpwdjsKIAlzdHJ1
Y3QgaW50ZWxfdmdwdV9wdl9zaGFyZWRfcGFnZSAqYmFzZTsKLQl1NjQgZ3BhOworCXN0cnVjdCBp
bnRlbF92Z3B1X3B2X2NhcF9hZGRyIGNhcF9hZGRyOworCXZvaWQgKnN1Yl9iYXNlOworCXU2NCBn
cGEsIHN1Yl9ncGE7CiAJdTE2IHZlcl9tYWosIHZlcl9taW47CiAJaW50IHJldCA9IDA7CisJaW50
IGk7CisJdTMyIHNpemU7CiAKIAkvKiBXZSBhbGxvY2F0ZSAxIHBhZ2Ugc2hhcmVkIGJldHdlZW4g
Z3Vlc3QgYW5kIEdWVCBmb3IgZGF0YSBleGNoYW5nZS4KIAkgKiAgICAgICBfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCiAJICogICAgICB8dmVyc2lvbnxQVl9ERVNDcyhTRU5EKSAgICAg
ICAgIHwKIAkgKiAgICAgIHxfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fUEFHRS84Ci0J
ICogICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwKKwkgKiAgICAgIHxQVl9S
U1ZEICAgICAgICAgICAgICAgICAgICAgICAgfAogCSAqICAgICAgfF9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19QQUdFLzQKLQkgKiAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgfAorCSAqICAgICAgfFBWX1NVQk1JU1NJT04gICAgICAgICAgICAgICAgICB8CiAJICog
ICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwKIAkgKiAgICAgIHwgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgfAogCSAqICAgICAgfF9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19QQUdFLzIKQEAgLTc1OCw2ICs3ODEsMzMgQEAgc3RhdGljIGludCBpbnRlbF92
Z3B1X3B2X3NldHVwX3NoYXJlZF9wYWdlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CXB2LT5ub3RpZnkgPSBpbnRlbF92Z3B1X3B2X25vdGlmeV9tbWlvOwogCXNwaW5fbG9ja19pbml0
KCZwdi0+bG9jayk7CiAKKwkvKiBzZXR1cCBQViBwZXIgZW5naW5lIGRhdGEgZXhjaGFuZ2Ugc3Ry
dWN0dXJlICovCisJaWYgKGk5MTUtPnZncHUucHZfY2FwcyAmIFBWX1NVQk1JU1NJT04pIHsKKwkJ
c3ViX2Jhc2UgPSAodm9pZCAqKWJhc2UgKyBQVl9TVUJfT0ZGOworCQlzdWJfZ3BhID0gZ3BhICsg
UFZfU1VCX09GRjsKKworCQlzaXplID0gc2l6ZW9mKHN0cnVjdCBpbnRlbF92Z3B1X3B2X3N1Ym1p
c3Npb24pOworCQlpZiAoc2l6ZSAqIEk5MTVfTlVNX0VOR0lORVMgPiAoUFZfQ01EX09GRiAtIFBW
X1NVQl9PRkYpKSB7CisJCQlwdi0+c3VibWlzc2lvbiA9IGttYWxsb2NfYXJyYXkoSTkxNV9OVU1f
RU5HSU5FUywgc2l6ZSwgR0ZQX0tFUk5FTCk7CisJCQlpZiAoIXB2LT5zdWJtaXNzaW9uKSB7CisJ
CQkJcmV0ID0gLUVOT01FTTsKKwkJCQlnb3RvIGVycjsKKwkJCX0KKwkJCXN1Yl9iYXNlID0gcHYt
PnN1Ym1pc3Npb247CisJCQlzdWJfZ3BhID0gdmlydF90b19waHlzKHB2LT5zdWJtaXNzaW9uKTsK
KwkJfQorCisJCWZvciAoaSA9IDA7IGkgPCBJOTE1X05VTV9FTkdJTkVTOyBpKyspIHsKKwkJCXB2
LT5zdWJtaXNzaW9uX2RhdGFbaV0gPSBzdWJfYmFzZSArICBzaXplICogaTsKKwkJCXB2LT5zdWJt
aXNzaW9uX2RhdGFbaV0tPnN1Ym1pdHRlZCA9IGZhbHNlOworCQkJc3Bpbl9sb2NrX2luaXQoJnB2
LT5zdWJtaXNzaW9uX2xvY2tbaV0pOworCQl9CisKKwkJY2FwX2FkZHIuY2FwID0gUFZfU1VCTUlT
U0lPTjsKKwkJY2FwX2FkZHIuZ3BhID0gc3ViX2dwYTsKKwkJaW50ZWxfdmdwdV9wdl9yZWdpc3Rl
cl9jYXBfZ3BhKGk5MTUsICZjYXBfYWRkciwgc2hhcmVkX2FyZWEpOworCX0KKwogCXJldHVybiBy
ZXQ7CiBlcnI6CiAJX19mcmVlX3BhZ2UodmlydF90b19wYWdlKGJhc2UpKTsKQEAgLTc3Miw2ICs4
MjIsNyBAQCB2b2lkIGludGVsX3ZncHVfcHZfY29uZmlnX2NhcHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiB7CiAJc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0OwogCXN0cnVjdCBpOTE1
X2dndHQgKmdndHQ7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCiAJaWYgKCFp
bnRlbF92Z3B1X3B2X2NoZWNrX2NhcChpOTE1LCBjYXApKQogCQlyZXR1cm47CkBAIC03ODcsNiAr
ODM4LDExIEBAIHZvaWQgaW50ZWxfdmdwdV9wdl9jb25maWdfY2FwcyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJZ2d0dC0+dm0udm1hX29wcy5iaW5kX3ZtYSAgICA9IGludGVsX3Zn
cHVfcHZfZ2d0dF9iaW5kOwogCQlnZ3R0LT52bS52bWFfb3BzLnVuYmluZF92bWEgID0gaW50ZWxf
dmdwdV9wdl9nZ3R0X3VuYmluZF9ub3A7CiAJfQorCisJaWYgKGNhcCA9PSBQVl9TVUJNSVNTSU9O
KSB7CisJCWVuZ2luZSA9IChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICopZGF0YTsKKwkJaW50ZWxf
dmdwdV9wdl9zZXRfc3VibWlzc2lvbihlbmdpbmUpOworCX0KIH0KIAogLyoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdmdwdS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92Z3B1LmgKaW5kZXggMzlhY2Q5My4uYWFiNWRmMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV92Z3B1LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
Z3B1LmgKQEAgLTI1LDYgKzI1LDcgQEAKICNkZWZpbmUgX0k5MTVfVkdQVV9IXwogCiAjaW5jbHVk
ZSA8bGludXgvdHlwZXMuaD4KKyNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfdHlwZXMuaCIKIAog
c3RydWN0IGRybV9pOTE1X3ByaXZhdGU7CiBzdHJ1Y3QgaTkxNV9nZ3R0OwpAQCAtMzIsNiArMzMs
OCBAQCBzdHJ1Y3QgaTkxNV9nZ3R0OwogI2RlZmluZSBQVl9NQUpPUiAgICAgICAgMAogI2RlZmlu
ZSBQVl9NSU5PUiAgICAgICAgMQogI2RlZmluZSBQVl9ERVNDX09GRiAgICAgKFBBR0VfU0laRSAv
IDI1NikKKyNkZWZpbmUgUFZfUlNWRF9PRkYgICAgIChQQUdFX1NJWkUgLyA4KQorI2RlZmluZSBQ
Vl9TVUJfT0ZGICAgICAgKFBBR0VfU0laRSAvIDQpCiAjZGVmaW5lIFBWX0NNRF9PRkYgICAgICAo
UEFHRV9TSVpFIC8gMikKIAogLyogaW50ZWwgdkdQVSBQViBjYXBhYmlsaXRpZXMgKi8KQEAgLTM5
LDYgKzQyLDcgQEAgZW51bSBpbnRlbF92Z3B1X3B2X2NhcHMgewogCVBWX05PTkUgPSAwLAogCVBW
X1BQR1RUID0gQklUKDApLAogCVBWX0dHVFQgPSBCSVQoMSksCisJUFZfU1VCTUlTU0lPTiA9IEJJ
VCgyKSwKIH07CiAKIC8qIHZncHUgUFYgY29tbWFuZHMgKi8KQEAgLTQ4LDYgKzUyLDggQEAgZW51
bSBpbnRlbF92Z3B1X3B2X2NtZCB7CiAJUFZfQ01EX1VOQklORF9QUEdUVCwKIAlQVl9DTURfQklO
RF9HR1RULAogCVBWX0NNRF9VTkJJTkRfR0dUVCwKKwlQVl9DTURfUkVHSVNURVJfQ0FQX0dQQSwK
KwlQVl9DTURfU1VCTUlUX1dPUktMT0FECiB9OwogCiAvKiBBIHNoYXJlZCBtZW1vcnkoNEtCKSBi
ZXR3ZWVuIEdWVGcgYW5kIHZncHUgYWxsb2NhdGVkIGJ5IGd1ZXN0ICovCkBAIC01Niw2ICs2Miwx
MSBAQCBzdHJ1Y3QgaW50ZWxfdmdwdV9wdl9zaGFyZWRfcGFnZSB7CiAJdTE2IHZlcl9taW5vcjsK
IH07CiAKK3N0cnVjdCBpbnRlbF92Z3B1X3B2X2NhcF9hZGRyIHsKKwl1MzIgY2FwOworCXU2NCBn
cGE7Cit9OworCiAvKiBQViB2aXJ0dWFsIG1lbW9yeSBhZGRyZXNzIGZvciBHR1RUL1BQR1RUICov
CiBzdHJ1Y3QgaW50ZWxfdmdwdV9wdl92bWEgewogCXUzMiBzaXplOyAvKiBudW0gb2YgcGFnZXMg
Ki8KQEAgLTY1LDYgKzc2LDE1IEBAIHN0cnVjdCBpbnRlbF92Z3B1X3B2X3ZtYSB7CiAJdTY0IHBt
bDQ7IC8qIHBwZ3R0IGhhbmRsZXIgKi8KIH07CiAKKy8qIFBWIHdvcmtsb2FkIHN1Ym1pc3Npb24g
Ki8KK3N0cnVjdCBpbnRlbF92Z3B1X3B2X3N1Ym1pc3Npb24geworCWJvb2wgc3VibWl0dGVkOwor
CS8qIHdvcmtsb2FkIGxyYyBkZXNjcmlwdG9yICovCisJdTY0IGRlc2NzW0VYRUNMSVNUX01BWF9Q
T1JUU107CisJLyogZ3Vlc3QgbG9naWNhbCBjb250ZXh0IGhhbmRsZXIgKi8KKwl1NjQgY3R4X2dw
YVtFWEVDTElTVF9NQVhfUE9SVFNdOworfSBfX3BhY2tlZDsKKwogLyoKICAqIERlZmluaXRpb24g
b2YgdGhlIGNvbW1hbmQgdHJhbnNwb3J0IG1lc3NhZ2UgaGVhZGVyIChEVzApCiAgKgpAQCAtMTA4
LDYgKzEyOCwxMyBAQCBzdHJ1Y3QgaW50ZWxfdmdwdV9wdl9jdF9idWYgewogc3RydWN0IGludGVs
X3ZncHVfcHYgewogCXN0cnVjdCBpbnRlbF92Z3B1X3B2X3NoYXJlZF9wYWdlICptZW07CiAKKwkv
KiBwcm90ZWN0IG11bHRpcGxlIHN1Ym1pc3Npb24gcGVyIGVuZ2luZSAqLworCXNwaW5sb2NrX3Qg
c3VibWlzc2lvbl9sb2NrW0k5MTVfTlVNX0VOR0lORVNdOworCS8qIHBlciBlbmdpbmUgUFYgd29y
a2xvYWQgc3VibWlzc2lvbiBkYXRhIGFyZWEgKi8KKwlzdHJ1Y3QgaW50ZWxfdmdwdV9wdl9zdWJt
aXNzaW9uICpzdWJtaXNzaW9uX2RhdGFbSTkxNV9OVU1fRU5HSU5FU107CisJLyogcGVyIGVuZ2lu
ZSBQViB3b3JrbG9hZCBzdWJtaXNzaW9uIGRhdGEgZHluYW1pYyBhbGxvY2F0ZWQgKi8KKwl2b2lk
ICpzdWJtaXNzaW9uOworCiAJLyogUFYgY29tbWFuZCBidWZmZXIgc3VwcG9ydCAqLwogCXN0cnVj
dCBpbnRlbF92Z3B1X3B2X2N0X2J1ZiBjdGI7CiAJdTMyIG5leHRfZmVuY2U7CkBAIC0xMzYsNCAr
MTYzLDUgQEAgYm9vbCBpbnRlbF92Z3B1X3B2X2RldGVjdF9jYXBzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJICAgICAgIHZvaWQgX19pb21lbSAqc2hhcmVkX2FyZWEpOwogdm9p
ZCBpbnRlbF92Z3B1X3B2X2NvbmZpZ19jYXBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCQkJICAgICAgIGVudW0gaW50ZWxfdmdwdV9wdl9jYXBzIGNhcCwgdm9pZCAqZGF0YSk7Cit2
b2lkIGludGVsX3ZncHVfcHZfc2V0X3N1Ym1pc3Npb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKTsKICNlbmRpZiAvKiBfSTkxNV9WR1BVX0hfICovCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9wdl9zdWJtaXNzaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9wdl9zdWJtaXNzaW9uLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MC4uZjRkNGE2NQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3B2X3N1Ym1pc3Npb24uYwpAQCAtMCwwICsxLDMyNSBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IE1JVAorLyoKKyAqIENvcHlyaWdodCDCqSAyMDE4IEludGVsIENvcnBvcmF0aW9uCisg
Ki8KKworI2luY2x1ZGUgImk5MTVfdmdwdS5oIgorI2luY2x1ZGUgImd0L2ludGVsX2xyY19yZWcu
aCIKKyNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5oIgorI2luY2x1ZGUgImd0L2ludGVsX3Jpbmcu
aCIKKyNpbmNsdWRlICJpOTE1X3RyYWNlLmgiCisKKyNkZWZpbmUgQ1RYX0RFU0NfRk9SQ0VfUkVT
VE9SRSBCSVRfVUxMKDIpCisKK3N0YXRpYyB1NjQgZXhlY2xpc3RzX3VwZGF0ZV9jb250ZXh0KHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQoreworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IHJx
LT5jb250ZXh0OworCXU2NCBkZXNjID0gY2UtPmxyYy5kZXNjOworCXUzMiB0YWlsLCBwcmV2Owor
CisJdGFpbCA9IGludGVsX3Jpbmdfc2V0X3RhaWwocnEtPnJpbmcsIHJxLT50YWlsKTsKKwlwcmV2
ID0gY2UtPmxyY19yZWdfc3RhdGVbQ1RYX1JJTkdfVEFJTF07CisJaWYgKHVubGlrZWx5KGludGVs
X3JpbmdfZGlyZWN0aW9uKHJxLT5yaW5nLCB0YWlsLCBwcmV2KSA8PSAwKSkKKwkJZGVzYyB8PSBD
VFhfREVTQ19GT1JDRV9SRVNUT1JFOworCWNlLT5scmNfcmVnX3N0YXRlW0NUWF9SSU5HX1RBSUxd
ID0gdGFpbDsKKwlycS0+dGFpbCA9IHJxLT53YV90YWlsOworCWNlLT5scmMuZGVzYyAmPSB+Q1RY
X0RFU0NfRk9SQ0VfUkVTVE9SRTsKKwlyZXR1cm4gZGVzYzsKK30KKworc3RhdGljIGlubGluZSBz
dHJ1Y3QgaTkxNV9wcmlvbGlzdCAqdG9fcHJpb2xpc3Qoc3RydWN0IHJiX25vZGUgKnJiKQorewor
CXJldHVybiByYl9lbnRyeShyYiwgc3RydWN0IGk5MTVfcHJpb2xpc3QsIG5vZGUpOworfQorCitz
dGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqc2NoZWR1bGVfaW4oc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEsIGludCBpZHgpCit7CisJX19pbnRlbF9ndF9wbV9nZXQocnEtPmVuZ2luZS0+Z3QpOwor
CXJldHVybiBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKK30KKworc3RhdGljIHZvaWQgc2NoZWR1bGVf
b3V0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQoreworCWludGVsX2d0X3BtX3B1dF9hc3luYyhy
cS0+ZW5naW5lLT5ndCk7CisJaTkxNV9yZXF1ZXN0X3B1dChycSk7Cit9CisKK3N0YXRpYyB2b2lk
IHB2X3Jlc2V0X3ByZXBhcmUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCXN0
cnVjdCBpbnRlbF9lbmdpbmVfZXhlY2xpc3RzICogY29uc3QgZXhlY2xpc3RzID0gJmVuZ2luZS0+
ZXhlY2xpc3RzOworCisJX190YXNrbGV0X2Rpc2FibGVfc3luY19vbmNlKCZleGVjbGlzdHMtPnRh
c2tsZXQpOworfQorCitzdGF0aWMgdm9pZAorY2FuY2VsX3BvcnRfcmVxdWVzdHMoc3RydWN0IGlu
dGVsX2VuZ2luZV9leGVjbGlzdHMgKiBjb25zdCBleGVjbGlzdHMpCit7CisJc3RydWN0IGk5MTVf
cmVxdWVzdCAqIGNvbnN0ICpwb3J0LCAqcnE7CisKKwkvKiBOb3RlIHdlIGFyZSBvbmx5IHVzaW5n
IHRoZSBpbmZsaWdodCBhbmQgbm90IHRoZSBwZW5kaW5nIHF1ZXVlICovCisJZm9yIChwb3J0ID0g
ZXhlY2xpc3RzLT5hY3RpdmU7IChycSA9ICpwb3J0KTsgcG9ydCsrKQorCQlzY2hlZHVsZV9vdXQo
cnEpOworCWV4ZWNsaXN0cy0+YWN0aXZlID0KKwkJbWVtc2V0KGV4ZWNsaXN0cy0+aW5mbGlnaHQs
IDAsIHNpemVvZihleGVjbGlzdHMtPmluZmxpZ2h0KSk7Cit9CisKK3N0YXRpYyB2b2lkIHB2X3Jl
c2V0X3Jld2luZChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIGJvb2wgc3RhbGxlZCkK
K3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqIGNvbnN0IGV4ZWNsaXN0cyA9ICZl
bmdpbmUtPmV4ZWNsaXN0czsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwl1bnNpZ25lZCBs
b25nIGZsYWdzOworCisJc3Bpbl9sb2NrX2lycXNhdmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZs
YWdzKTsKKworCWNhbmNlbF9wb3J0X3JlcXVlc3RzKGV4ZWNsaXN0cyk7CisKKwkvKiBQdXNoIGJh
Y2sgYW55IGluY29tcGxldGUgcmVxdWVzdHMgZm9yIHJlcGxheSBhZnRlciB0aGUgcmVzZXQuICov
CisJcnEgPSBleGVjbGlzdHNfdW53aW5kX2luY29tcGxldGVfcmVxdWVzdHMoZXhlY2xpc3RzKTsK
KwlpZiAoIXJxKQorCQlnb3RvIG91dF91bmxvY2s7CisKKwlpZiAoIWk5MTVfcmVxdWVzdF9zdGFy
dGVkKHJxKSkKKwkJc3RhbGxlZCA9IGZhbHNlOworCisJX19pOTE1X3JlcXVlc3RfcmVzZXQocnEs
IHN0YWxsZWQpOworCWludGVsX2xyX2NvbnRleHRfcmVzZXQoZW5naW5lLCBycS0+Y29udGV4dCwg
cnEtPmhlYWQsIHN0YWxsZWQpOworCitvdXRfdW5sb2NrOgorCXNwaW5fdW5sb2NrX2lycXJlc3Rv
cmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKK30KKworc3RhdGljIHZvaWQgcHZfcmVz
ZXRfZmluaXNoKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2V4ZWNsaXN0cyAqIGNvbnN0IGV4ZWNsaXN0cyA9ICZlbmdpbmUtPmV4ZWNsaXN0
czsKKworCWlmIChfX3Rhc2tsZXRfZW5hYmxlKCZleGVjbGlzdHMtPnRhc2tsZXQpKQorCQkvKiBB
bmQga2ljayBpbiBjYXNlIHdlIG1pc3NlZCBhIG5ldyByZXF1ZXN0IHN1Ym1pc3Npb24uICovCisJ
CXRhc2tsZXRfaGlfc2NoZWR1bGUoJmV4ZWNsaXN0cy0+dGFza2xldCk7Cit9CisKK3N0YXRpYyB2
b2lkIHB2X3Jlc2V0X2NhbmNlbChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJ
c3RydWN0IGludGVsX2VuZ2luZV9leGVjbGlzdHMgKiBjb25zdCBleGVjbGlzdHMgPSAmZW5naW5l
LT5leGVjbGlzdHM7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsICpybjsKKwlzdHJ1Y3QgcmJf
bm9kZSAqcmI7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKworCXNwaW5fbG9ja19pcnFzYXZlKCZl
bmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7CisKKwkvKiBDYW5jZWwgdGhlIHJlcXVlc3RzIG9u
IHRoZSBIVyBhbmQgY2xlYXIgdGhlIEVMU1AgdHJhY2tlci4gKi8KKwljYW5jZWxfcG9ydF9yZXF1
ZXN0cyhleGVjbGlzdHMpOworCisJLyogTWFyayBhbGwgZXhlY3V0aW5nIHJlcXVlc3RzIGFzIHNr
aXBwZWQuICovCisJbGlzdF9mb3JfZWFjaF9lbnRyeShycSwgJmVuZ2luZS0+YWN0aXZlLnJlcXVl
c3RzLCBzY2hlZC5saW5rKSB7CisJCWk5MTVfcmVxdWVzdF9zZXRfZXJyb3Jfb25jZShycSwgLUVJ
Tyk7CisJCWk5MTVfcmVxdWVzdF9tYXJrX2NvbXBsZXRlKHJxKTsKKwl9CisKKwkvKiBGbHVzaCB0
aGUgcXVldWVkIHJlcXVlc3RzIHRvIHRoZSB0aW1lbGluZSBsaXN0IChmb3IgcmV0aXJpbmcpLiAq
LworCXdoaWxlICgocmIgPSByYl9maXJzdF9jYWNoZWQoJmV4ZWNsaXN0cy0+cXVldWUpKSkgewor
CQlzdHJ1Y3QgaTkxNV9wcmlvbGlzdCAqcCA9IHRvX3ByaW9saXN0KHJiKTsKKwkJaW50IGk7CisK
KwkJcHJpb2xpc3RfZm9yX2VhY2hfcmVxdWVzdF9jb25zdW1lKHJxLCBybiwgcCwgaSkgeworCQkJ
bGlzdF9kZWxfaW5pdCgmcnEtPnNjaGVkLmxpbmspOworCQkJX19pOTE1X3JlcXVlc3Rfc3VibWl0
KHJxKTsKKwkJCWRtYV9mZW5jZV9zZXRfZXJyb3IoJnJxLT5mZW5jZSwgLUVJTyk7CisJCQlpOTE1
X3JlcXVlc3RfbWFya19jb21wbGV0ZShycSk7CisJCX0KKworCQlyYl9lcmFzZV9jYWNoZWQoJnAt
Pm5vZGUsICZleGVjbGlzdHMtPnF1ZXVlKTsKKwkJaTkxNV9wcmlvbGlzdF9mcmVlKHApOworCX0K
KworCWV4ZWNsaXN0cy0+cXVldWVfcHJpb3JpdHlfaGludCA9IElOVF9NSU47CisJZXhlY2xpc3Rz
LT5xdWV1ZSA9IFJCX1JPT1RfQ0FDSEVEOworCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZW5n
aW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOworfQorCitzdGF0aWMgdm9pZCBwdl9zdWJtaXQoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkgICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICoqb3V0LCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoqZW5kKQoreworCXN0cnVjdCBpbnRlbF9lbmdp
bmVfZXhlY2xpc3RzICogY29uc3QgZXhlY2xpc3RzID0gJmVuZ2luZS0+ZXhlY2xpc3RzOworCXN0
cnVjdCBpbnRlbF92Z3B1X3B2ICpwdiA9IGVuZ2luZS0+aTkxNS0+dmdwdS5wdjsKKwlzdHJ1Y3Qg
aW50ZWxfdmdwdV9wdl9zdWJtaXNzaW9uICpzdWJfZGF0YSA9IHB2LT5zdWJtaXNzaW9uX2RhdGFb
ZW5naW5lLT5pZF07CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJaW50IG4sIGVycjsKKwor
CW1lbXNldChzdWJfZGF0YS0+ZGVzY3MsIDAsIHNpemVvZihzdWJfZGF0YS0+ZGVzY3MpKTsKKwlu
ID0gMDsKKworCWRvIHsKKwkJcnEgPSAqb3V0Kys7CisJCXN1Yl9kYXRhLT5kZXNjc1tuXSA9IGV4
ZWNsaXN0c191cGRhdGVfY29udGV4dChycSk7CisJCW4rKzsKKwl9IHdoaWxlIChvdXQgIT0gZW5k
KTsKKworCXNwaW5fbG9jaygmcHYtPnN1Ym1pc3Npb25fbG9ja1tlbmdpbmUtPmlkXSk7CisJc3Vi
X2RhdGEtPnN1Ym1pdHRlZCA9IHRydWU7CisJd3JpdGVsKFBWX0NNRF9TVUJNSVRfV09SS0xPQUQs
IGV4ZWNsaXN0cy0+c3VibWl0X3JlZyk7CisKKyNkZWZpbmUgZG9uZSAoUkVBRF9PTkNFKHN1Yl9k
YXRhLT5zdWJtaXR0ZWQpID09IGZhbHNlKQorCWVyciA9IHdhaXRfZm9yX2F0b21pY191cyhkb25l
LCAxMDAwKTsKKyN1bmRlZiBkb25lCisJc3Bpbl91bmxvY2soJnB2LT5zdWJtaXNzaW9uX2xvY2tb
ZW5naW5lLT5pZF0pOworCisJaWYgKHVubGlrZWx5KGVycikpCisJCURSTV9FUlJPUigiUFYgKCVz
KSB3b3JrbG9hZCBzdWJtaXNzaW9uIGZhaWxlZFxuIiwgZW5naW5lLT5uYW1lKTsKK30KKworc3Rh
dGljIHZvaWQgcHZfZGVxdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJ
c3RydWN0IGludGVsX2VuZ2luZV9leGVjbGlzdHMgKiBjb25zdCBleGVjbGlzdHMgPSAmZW5naW5l
LT5leGVjbGlzdHM7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqKmZpcnN0ID0gZXhlY2xpc3RzLT5p
bmZsaWdodDsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoqIGNvbnN0IGxhc3RfcG9ydCA9IGZpcnN0
ICsgZXhlY2xpc3RzLT5wb3J0X21hc2s7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqbGFzdCA9IGZp
cnN0WzBdOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKipwb3J0OworCXN0cnVjdCByYl9ub2RlICpy
YjsKKwlib29sIHN1Ym1pdCA9IGZhbHNlOworCisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmZW5naW5l
LT5hY3RpdmUubG9jayk7CisKKwlpZiAobGFzdCkgeworCQlpZiAoKisrZmlyc3QpCisJCQlyZXR1
cm47CisJCWxhc3QgPSBOVUxMOworCX0KKworCXBvcnQgPSBmaXJzdDsKKwl3aGlsZSAoKHJiID0g
cmJfZmlyc3RfY2FjaGVkKCZleGVjbGlzdHMtPnF1ZXVlKSkpIHsKKwkJc3RydWN0IGk5MTVfcHJp
b2xpc3QgKnAgPSB0b19wcmlvbGlzdChyYik7CisJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCAq
cm47CisJCWludCBpOworCisJCXByaW9saXN0X2Zvcl9lYWNoX3JlcXVlc3RfY29uc3VtZShycSwg
cm4sIHAsIGkpIHsKKwkJCWlmIChsYXN0ICYmIHJxLT5jb250ZXh0ICE9IGxhc3QtPmNvbnRleHQp
IHsKKwkJCQlpZiAocG9ydCA9PSBsYXN0X3BvcnQpCisJCQkJCWdvdG8gZG9uZTsKKworCQkJCSpw
b3J0ID0gc2NoZWR1bGVfaW4obGFzdCwgcG9ydCAtIGV4ZWNsaXN0cy0+aW5mbGlnaHQpOworCQkJ
CXBvcnQrKzsKKwkJCX0KKworCQkJbGlzdF9kZWxfaW5pdCgmcnEtPnNjaGVkLmxpbmspOworCQkJ
X19pOTE1X3JlcXVlc3Rfc3VibWl0KHJxKTsKKwkJCXN1Ym1pdCA9IHRydWU7CisJCQlsYXN0ID0g
cnE7CisJCX0KKworCQlyYl9lcmFzZV9jYWNoZWQoJnAtPm5vZGUsICZleGVjbGlzdHMtPnF1ZXVl
KTsKKwkJaTkxNV9wcmlvbGlzdF9mcmVlKHApOworCX0KK2RvbmU6CisJZXhlY2xpc3RzLT5xdWV1
ZV9wcmlvcml0eV9oaW50ID0KKwkJcmIgPyB0b19wcmlvbGlzdChyYiktPnByaW9yaXR5IDogSU5U
X01JTjsKKwlpZiAoc3VibWl0KSB7CisJCSpwb3J0ID0gc2NoZWR1bGVfaW4obGFzdCwgcG9ydCAt
IGV4ZWNsaXN0cy0+aW5mbGlnaHQpOworCQkqKytwb3J0ID0gTlVMTDsKKwkJcHZfc3VibWl0KGVu
Z2luZSwgZmlyc3QsIHBvcnQpOworCX0KKwlleGVjbGlzdHMtPmFjdGl2ZSA9IGV4ZWNsaXN0cy0+
aW5mbGlnaHQ7Cit9CisKK3N0YXRpYyB2b2lkIHZncHVfcHZfc3VibWlzc2lvbl90YXNrbGV0KHVu
c2lnbmVkIGxvbmcgZGF0YSkKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICogY29uc3QgZW5n
aW5lID0gKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKilkYXRhOworCXN0cnVjdCBpbnRlbF9lbmdp
bmVfZXhlY2xpc3RzICogY29uc3QgZXhlY2xpc3RzID0gJmVuZ2luZS0+ZXhlY2xpc3RzOworCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKipwb3J0LCAqcnE7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKwlz
dHJ1Y3QgaW50ZWxfdmdwdV9wdiAqcHYgPSBlbmdpbmUtPmk5MTUtPnZncHUucHY7CisJc3RydWN0
IGludGVsX3ZncHVfcHZfc3VibWlzc2lvbiAqc3ViX2RhdGEgPSBwdi0+c3VibWlzc2lvbl9kYXRh
W2VuZ2luZS0+aWRdOworCisJc3Bpbl9sb2NrX2lycXNhdmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ss
IGZsYWdzKTsKKworCWZvciAocG9ydCA9IGV4ZWNsaXN0cy0+aW5mbGlnaHQ7IChycSA9ICpwb3J0
KTsgcG9ydCsrKSB7CisJCWlmICghaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpCisJCQlicmVh
azsKKworCQlzY2hlZHVsZV9vdXQocnEpOworCX0KKworCWlmIChwb3J0ICE9IGV4ZWNsaXN0cy0+
aW5mbGlnaHQpIHsKKwkJaW50IGlkeCA9IHBvcnQgLSBleGVjbGlzdHMtPmluZmxpZ2h0OworCQlp
bnQgcmVtID0gQVJSQVlfU0laRShleGVjbGlzdHMtPmluZmxpZ2h0KSAtIGlkeDsKKworCQltZW1t
b3ZlKGV4ZWNsaXN0cy0+aW5mbGlnaHQsIHBvcnQsIHJlbSAqIHNpemVvZigqcG9ydCkpOworCX0K
KworCWlmICghc3ViX2RhdGEtPnN1Ym1pdHRlZCkKKwkJcHZfZGVxdWV1ZShlbmdpbmUpOworCisJ
c3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOworfQor
CitzdGF0aWMgaW5saW5lIGJvb2wKK3Jlc2V0X2luX3Byb2dyZXNzKGNvbnN0IHN0cnVjdCBpbnRl
bF9lbmdpbmVfZXhlY2xpc3RzICpleGVjbGlzdHMpCit7CisJcmV0dXJuIHVubGlrZWx5KCFfX3Rh
c2tsZXRfaXNfZW5hYmxlZCgmZXhlY2xpc3RzLT50YXNrbGV0KSk7Cit9CisKK3N0YXRpYyBpbmxp
bmUgaW50IHJxX3ByaW8oY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJcmV0dXJu
IFJFQURfT05DRShycS0+c2NoZWQuYXR0ci5wcmlvcml0eSk7Cit9CisKK3N0YXRpYyB2b2lkIHF1
ZXVlX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkJICBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKK3sKKwlHRU1fQlVHX09OKCFsaXN0X2VtcHR5KCZycS0+c2NoZWQu
bGluaykpOworCWxpc3RfYWRkX3RhaWwoJnJxLT5zY2hlZC5saW5rLAorCQkgICAgICBpOTE1X3Nj
aGVkX2xvb2t1cF9wcmlvbGlzdChlbmdpbmUsIHJxX3ByaW8ocnEpKSk7CisJc2V0X2JpdChJOTE1
X0ZFTkNFX0ZMQUdfUFFVRVVFLCAmcnEtPmZlbmNlLmZsYWdzKTsKK30KKworc3RhdGljIHZvaWQg
cHZfc3VibWl0X3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCkKK3sKKwlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSByZXF1ZXN0LT5lbmdpbmU7CisJdW5zaWduZWQg
bG9uZyBmbGFnczsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqZXhlY2xpc3RzID0g
JmVuZ2luZS0+ZXhlY2xpc3RzOworCisJLyogV2lsbCBiZSBjYWxsZWQgZnJvbSBpcnEtY29udGV4
dCB3aGVuIHVzaW5nIGZvcmVpZ24gZmVuY2VzLiAqLworCXNwaW5fbG9ja19pcnFzYXZlKCZlbmdp
bmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7CisKKwlxdWV1ZV9yZXF1ZXN0KGVuZ2luZSwgcmVxdWVz
dCk7CisKKwlpZiAocnFfcHJpbyhyZXF1ZXN0KSA8PSBleGVjbGlzdHMtPnF1ZXVlX3ByaW9yaXR5
X2hpbnQpCisJCWdvdG8gb3V0OworCisJZXhlY2xpc3RzLT5xdWV1ZV9wcmlvcml0eV9oaW50ID0g
cnFfcHJpbyhyZXF1ZXN0KTsKKwlpZiAocmVzZXRfaW5fcHJvZ3Jlc3MoZXhlY2xpc3RzKSkKKwkJ
Z290byBvdXQ7CisKKwl0YXNrbGV0X2hpX3NjaGVkdWxlKCZleGVjbGlzdHMtPnRhc2tsZXQpOwor
b3V0OgorCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdz
KTsKK30KKwordm9pZCBpbnRlbF92Z3B1X3B2X3NldF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSkKK3sKKwkvKgorCSAqIFdlIGluaGVyaXQgYSBidW5jaCBvZiBmdW5j
dGlvbnMgZnJvbSBleGVjbGlzdHMgdGhhdCB3ZSdkIGxpa2UKKwkgKiB0byBrZWVwIHVzaW5nOgor
CSAqCisJICogICAgZW5naW5lLT5zdWJtaXRfcmVxdWVzdCA9IGV4ZWNsaXN0c19zdWJtaXRfcmVx
dWVzdDsKKwkgKiAgICBlbmdpbmUtPmNhbmNlbF9yZXF1ZXN0cyA9IGV4ZWNsaXN0c19jYW5jZWxf
cmVxdWVzdHM7CisJICogICAgZW5naW5lLT5zY2hlZHVsZSA9IGV4ZWNsaXN0c19zY2hlZHVsZTsK
KwkgKgorCSAqIEJ1dCB3ZSBuZWVkIHRvIG92ZXJyaWRlIHRoZSBhY3R1YWwgc3VibWlzc2lvbiBi
YWNrZW5kIGluIG9yZGVyCisJICogdG8gdGFsayB0byB0aGUgR1ZUIHdpdGggUFYgbm90aWZpY2F0
aW9uIG1lc3NhZ2UuCisJICovCisJZW5naW5lLT5zdWJtaXRfcmVxdWVzdCA9IHB2X3N1Ym1pdF9y
ZXF1ZXN0OworCWVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQuZnVuYyA9IHZncHVfcHZfc3VibWlz
c2lvbl90YXNrbGV0OworCisJLyogZG8gbm90IHVzZSBleGVjbGlzdHMgcGFyay91bnBhcmsgKi8K
KwllbmdpbmUtPnBhcmsgPSBOVUxMOworCWVuZ2luZS0+dW5wYXJrID0gTlVMTDsKKworCWVuZ2lu
ZS0+cmVzZXQucHJlcGFyZSA9IHB2X3Jlc2V0X3ByZXBhcmU7CisJZW5naW5lLT5yZXNldC5yZXdp
bmQgPSBwdl9yZXNldF9yZXdpbmQ7CisJZW5naW5lLT5yZXNldC5jYW5jZWwgPSBwdl9yZXNldF9j
YW5jZWw7CisJZW5naW5lLT5yZXNldC5maW5pc2ggPSBwdl9yZXNldF9maW5pc2g7CisKKwllbmdp
bmUtPmZsYWdzICY9IH5JOTE1X0VOR0lORV9TVVBQT1JUU19TVEFUUzsKKwllbmdpbmUtPmZsYWdz
IHw9IEk5MTVfRU5HSU5FX05FRURTX0JSRUFEQ1JVTUJfVEFTS0xFVDsKK30KLS0gCjIuNy40Cgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwppbnRlbC1ndnQt
ZGV2IG1haWxpbmcgbGlzdAppbnRlbC1ndnQtZGV2QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWd2dC1kZXYK
