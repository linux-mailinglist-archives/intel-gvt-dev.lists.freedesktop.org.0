Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AD03CBD355
	for <lists+intel-gvt-dev@lfdr.de>; Tue, 24 Sep 2019 22:10:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6921A6EAF5;
	Tue, 24 Sep 2019 20:10:33 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3D9A46EAF5
 for <intel-gvt-dev@lists.freedesktop.org>;
 Tue, 24 Sep 2019 20:10:32 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 893AFA26675;
 Tue, 24 Sep 2019 20:10:31 +0000 (UTC)
Received: from x1.home (ovpn-118-102.phx2.redhat.com [10.3.118.102])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 0D809608C2;
 Tue, 24 Sep 2019 20:10:28 +0000 (UTC)
Date: Tue, 24 Sep 2019 14:10:27 -0600
From: Alex Williamson <alex.williamson@redhat.com>
To: Tina Zhang <tina.zhang@intel.com>
Subject: Re: [PATCH v6 4/6] drm/i915/gvt: Deliver vGPU refresh event to
 userspace
Message-ID: <20190924141027.317af985@x1.home>
In-Reply-To: <20190924064143.9282-5-tina.zhang@intel.com>
References: <20190924064143.9282-1-tina.zhang@intel.com>
 <20190924064143.9282-5-tina.zhang@intel.com>
Organization: Red Hat
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.6.2
 (mx1.redhat.com [10.5.110.68]); Tue, 24 Sep 2019 20:10:31 +0000 (UTC)
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: kevin.tian@intel.com, yi.l.liu@intel.com, kvm@vger.kernel.org,
 linux-kernel@vger.kernel.org, zhenyuw@linux.intel.com, hang.yuan@intel.com,
 zhiyuan.lv@intel.com, Kechen Lu <kechen.lu@intel.com>,
 intel-gvt-dev@lists.freedesktop.org, zhi.a.wang@intel.com, kraxel@redhat.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

T24gVHVlLCAyNCBTZXAgMjAxOSAxNDo0MTo0MSArMDgwMApUaW5hIFpoYW5nIDx0aW5hLnpoYW5n
QGludGVsLmNvbT4gd3JvdGU6Cgo+IERlbGl2ZXIgdGhlIGRpc3BsYXkgcmVmcmVzaCBldmVudHMg
dG8gdGhlIHVzZXIgbGFuZC4gVXNlcnNwYWNlIGNhbiB1c2UKPiB0aGUgaXJxIG1hc2svdW5tYXNr
IG1lY2hhbmlzbSB0byBkaXNhYmxlIG9yIGVuYWJsZSB0aGUgZXZlbnQgZGVsaXZlcnkuCj4gCj4g
QXMgd2Uga25vdywgZGVsaXZlcmluZyByZWZyZXNoIGV2ZW50IGF0IGVhY2ggdmJsYW5rIHNhZmVs
eSBhdm9pZHMKPiB0ZWFyaW5nIGFuZCB1bmV4cGVjdGVkIGV2ZW50IG92ZXJ3aGVsbWluZywgYnV0
IHRoZXJlIGFyZSBzdGlsbCBzcGFjZXMKPiB0byBvcHRpbWl6ZS4KPiAKPiBGb3IgaGFuZGxpbmcg
dGhlIG5vcm1hbCBjYXNlLCBkZWxpdmVyIHRoZSBwYWdlIGZsaXAgcmVmcmVzaAo+IGV2ZW50IGF0
IGVhY2ggdmJsYW5rLCBpbiBvdGhlciB3b3JkcywgYm91bmRlZCBieSB2YmxhbmtzLiBTa2lwcGlu
ZyBzb21lCj4gZXZlbnRzIGJyaW5nIHBlcmZvcm1hbmNlIGVuaGFuY2VtZW50IHdoaWxlIG5vdCBo
dXJ0aW5nIHVzZXIgZXhwZXJpZW5jZS4KPiAKPiBGb3Igc2luZ2xlIGZyYW1lYnVmZmVyIGNhc2Us
IGRlbGl2ZXIgdGhlIHJlZnJlc2ggZXZlbnRzIHRvIHVzZXJzcGFjZSBhdAo+IGFsbCB2Ymxhbmtz
LiBUaGlzIGhldXJpc3RpYyBhdCBlYWNoIHZibGFuayBsZXZlcmFnZXMgcGFnZWZsaXBfY291bnQK
PiBpbmNyZXNlbWVudHMgdG8gZGV0ZXJtaW5lIGlmIHRoZXJlIGlzIG5vIHBhZ2UgZmxpcCBoYXBw
ZW5zIGFmdGVyIGEgY2VydGFpbgo+IHBlcmlvZCBhbmQgc28gdGhhdCB0aGUgY2FzZSBpcyByZWdh
cmRlZCBhcyBzaW5nbGUgZnJhbWVidWZmZXIgb25lLgo+IEFsdGhvdWdoIHRoaXMgaGV1cmlzdGlj
IG1ha2VzIGluY29ycmVjdCBkZWNpc2lvbiBzb21ldGltZXMgYW5kIGl0IGRlcGVuZHMKPiBvbiBn
dWVzdCBiZWhhdmlvciwgZm9yIGV4YW1wbGUsIHdoZW4gbm8gY3Vyc29yIG1vdmVtZW50cyBoYXBw
ZW4sIHRoZQo+IHVzZXIgZXhwZXJpZW5jZSBkb2VzIG5vdCBoYXJtIGFuZCBmcm9udCBidWZmZXIg
aXMgc3RpbGwgY29ycmVjdGx5IGFjcXVpcmVkLgo+IE1lYW53aGlsZSwgaW4gYWN0dWFsIHNpbmds
ZSBmcmFtZWJ1ZmZlciBjYXNlLCB0aGUgdXNlciBleHBlcmllbmNlIGlzCj4gZW5oYW5jZWQgY29t
cGFyZWQgd2l0aCBwYWdlIGZsaXAgZXZlbnRzIG9ubHkuCj4gCj4gQWRkdGlvbmFsbHksIHRvIG1p
dGlnYXRlIHRoZSBldmVudHMgZGVsaXZlcmluZyBmb290cHJpbnRzLCBvbmUgZXZlbnRmZCBhbmQK
PiA4IGJ5dGUgZXZlbnRmZCBjb3VudGVyIHBhcnRpdGlvbiBhcmUgbGV2ZXJhZ2VkLgo+IAo+IHYz
Ogo+IC0gbWFrZSBub19wYWdlZmxpcF9jb3VudCBiZSBwZXItdmdwdSBpbnN0ZWFkIG9mIHN0YXRp
Yy4gKFpoZW55dSkKPiAKPiB2MjoKPiAtIFN1cHBvcnQgdmZpb19pcnFfaW5mb19jYXBfZGlzcGxh
eV9wbGFuZV9ldmVudHMuIChUaW5hKQo+IAo+IFNpZ25lZC1vZmYtYnk6IFRpbmEgWmhhbmcgPHRp
bmEuemhhbmdAaW50ZWwuY29tPgo+IFNpZ25lZC1vZmYtYnk6IEtlY2hlbiBMdSA8a2VjaGVuLmx1
QGludGVsLmNvbT4KPiAtLS0KPiAgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2Rpc3BsYXkuYyB8
ICAyMCArKysrCj4gIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9ndnQuaCAgICAgfCAgIDMgKwo+
ICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQva3ZtZ3QuYyAgIHwgMTU5ICsrKysrKysrKysrKysr
KysrKysrKysrKysrKy0tCj4gIDMgZmlsZXMgY2hhbmdlZCwgMTczIGluc2VydGlvbnMoKyksIDkg
ZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9k
aXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZGlzcGxheS5jCj4gaW5kZXggMWEw
YTRhZTQ4MjZlLi45ZjJjMmNkMTAzNjkgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2Rpc3BsYXkuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9kaXNwbGF5
LmMKPiBAQCAtMzQsNiArMzQsOCBAQAo+ICAKPiAgI2luY2x1ZGUgImk5MTVfZHJ2LmgiCj4gICNp
bmNsdWRlICJndnQuaCIKPiArI2luY2x1ZGUgPHVhcGkvbGludXgvdmZpby5oPgo+ICsjaW5jbHVk
ZSA8ZHJtL2RybV9wbGFuZS5oPgo+ICAKPiAgc3RhdGljIGludCBnZXRfZWRwX3BpcGUoc3RydWN0
IGludGVsX3ZncHUgKnZncHUpCj4gIHsKPiBAQCAtMzg3LDYgKzM4OSw4IEBAIHZvaWQgaW50ZWxf
Z3Z0X2NoZWNrX3ZibGFua19lbXVsYXRpb24oc3RydWN0IGludGVsX2d2dCAqZ3Z0KQo+ICAJbXV0
ZXhfdW5sb2NrKCZndnQtPmxvY2spOwo+ICB9Cj4gIAo+ICsjZGVmaW5lIFBBR0VGTElQX0RFTEFZ
X1RIUiAxMAo+ICsKPiAgc3RhdGljIHZvaWQgZW11bGF0ZV92Ymxhbmtfb25fcGlwZShzdHJ1Y3Qg
aW50ZWxfdmdwdSAqdmdwdSwgaW50IHBpcGUpCj4gIHsKPiAgCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7Cj4gQEAgLTM5Niw3ICs0MDAsOSBA
QCBzdGF0aWMgdm9pZCBlbXVsYXRlX3ZibGFua19vbl9waXBlKHN0cnVjdCBpbnRlbF92Z3B1ICp2
Z3B1LCBpbnQgcGlwZSkKPiAgCQlbUElQRV9CXSA9IFBJUEVfQl9WQkxBTkssCj4gIAkJW1BJUEVf
Q10gPSBQSVBFX0NfVkJMQU5LLAo+ICAJfTsKPiArCWludCBwcmlfZmxpcF9ldmVudCA9IFNLTF9G
TElQX0VWRU5UKHBpcGUsIFBMQU5FX1BSSU1BUlkpOwo+ICAJaW50IGV2ZW50Owo+ICsJdTY0IGV2
ZW50ZmRfc2lnbmFsX3ZhbCA9IDA7Cj4gIAo+ICAJaWYgKHBpcGUgPCBQSVBFX0EgfHwgcGlwZSA+
IFBJUEVfQykKPiAgCQlyZXR1cm47Cj4gQEAgLTQwNyw5ICs0MTMsMjMgQEAgc3RhdGljIHZvaWQg
ZW11bGF0ZV92Ymxhbmtfb25fcGlwZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgaW50IHBpcGUp
Cj4gIAkJaWYgKCFwaXBlX2lzX2VuYWJsZWQodmdwdSwgcGlwZSkpCj4gIAkJCWNvbnRpbnVlOwo+
ICAKPiArCQlpZiAoZXZlbnQgPT0gcHJpX2ZsaXBfZXZlbnQpCj4gKwkJCWV2ZW50ZmRfc2lnbmFs
X3ZhbCB8PSBESVNQTEFZX1BSSV9SRUZSRVNIX0VWRU5UX1ZBTDsKPiArCj4gIAkJaW50ZWxfdmdw
dV90cmlnZ2VyX3ZpcnR1YWxfZXZlbnQodmdwdSwgZXZlbnQpOwo+ICAJfQo+ICAKPiArCWlmIChl
dmVudGZkX3NpZ25hbF92YWwpCj4gKwkJdmdwdS0+bm9fcGFnZWZsaXBfY291bnQgPSAwOwo+ICsJ
ZWxzZSBpZiAoIWV2ZW50ZmRfc2lnbmFsX3ZhbCAmJiB2Z3B1LT5ub19wYWdlZmxpcF9jb3VudCA+
IFBBR0VGTElQX0RFTEFZX1RIUikKClRoZSAhZXZlbnRmZF9zaWduYWxfdmFsIHRlc3QgaXMgcmVk
dW5kYW50IHNpbmNlIHRoaXMgaXMgYW5kIGVsc2UgYnJhbmNoCm9mIGEgdGVzdCBmb3IgZXZlbnRm
ZF9zaWduYWxfdmFsLgoKPiArCQlldmVudGZkX3NpZ25hbF92YWwgfD0gRElTUExBWV9QUklfUkVG
UkVTSF9FVkVOVF9WQUw7Cj4gKwllbHNlCj4gKwkJdmdwdS0+bm9fcGFnZWZsaXBfY291bnQrKzsK
PiArCj4gKwlpZiAodmdwdS0+dmRldi52YmxhbmtfdHJpZ2dlciAmJiAhdmdwdS0+dmRldi5kaXNw
bGF5X2V2ZW50X21hc2sgJiYKPiArCQlldmVudGZkX3NpZ25hbF92YWwpCj4gKwkJZXZlbnRmZF9z
aWduYWwodmdwdS0+dmRldi52YmxhbmtfdHJpZ2dlciwgZXZlbnRmZF9zaWduYWxfdmFsKTsKPiAr
Cj4gIAlpZiAocGlwZV9pc19lbmFibGVkKHZncHUsIHBpcGUpKSB7Cj4gIAkJdmdwdV92cmVnX3Qo
dmdwdSwgUElQRV9GUk1DT1VOVF9HNFgocGlwZSkpKys7Cj4gIAkJaW50ZWxfdmdwdV90cmlnZ2Vy
X3ZpcnR1YWxfZXZlbnQodmdwdSwgdmJsYW5rX2V2ZW50W3BpcGVdKTsKPiBkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d2dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L2d2dC5oCj4gaW5kZXggODAwODA0N2QwMjZjLi5jYzM5YjQ0OWIwNjEgMTAwNjQ0Cj4gLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d2dC5oCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2d2dC5oCj4gQEAgLTIwNSw2ICsyMDUsOCBAQCBzdHJ1Y3QgaW50ZWxfdmdwdSB7Cj4g
IAkJaW50IG51bV9pcnFzOwo+ICAJCXN0cnVjdCBldmVudGZkX2N0eCAqaW50eF90cmlnZ2VyOwo+
ICAJCXN0cnVjdCBldmVudGZkX2N0eCAqbXNpX3RyaWdnZXI7Cj4gKwkJc3RydWN0IGV2ZW50ZmRf
Y3R4ICp2YmxhbmtfdHJpZ2dlcjsKPiArCQlib29sIGRpc3BsYXlfZXZlbnRfbWFzazsKPiAgCj4g
IAkJLyoKPiAgCQkgKiBUd28gY2FjaGVzIGFyZSB1c2VkIHRvIGF2b2lkIG1hcHBpbmcgZHVwbGlj
YXRlZCBwYWdlcyAoZWcuCj4gQEAgLTIyOSw2ICsyMzEsNyBAQCBzdHJ1Y3QgaW50ZWxfdmdwdSB7
Cj4gIAlzdHJ1Y3QgaWRyIG9iamVjdF9pZHI7Cj4gIAo+ICAJc3RydWN0IGNvbXBsZXRpb24gdmJs
YW5rX2RvbmU7Cj4gKwlpbnQgbm9fcGFnZWZsaXBfY291bnQ7Cj4gIAo+ICAJdTMyIHNjYW5fbm9u
cHJpdmJiOwo+ICB9Owo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQva3Zt
Z3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9rdm1ndC5jCj4gaW5kZXggMjY5NTA2MzAw
MzEwLi5mMzBiN2E1MjcyZTggMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L2t2bWd0LmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQva3ZtZ3QuYwo+IEBAIC0x
MjUwLDYgKzEyNTAsOCBAQCBzdGF0aWMgaW50IGludGVsX3ZncHVfZ2V0X2lycV9jb3VudChzdHJ1
Y3QgaW50ZWxfdmdwdSAqdmdwdSwgaW50IHR5cGUpCj4gIHsKPiAgCWlmICh0eXBlID09IFZGSU9f
UENJX0lOVFhfSVJRX0lOREVYIHx8IHR5cGUgPT0gVkZJT19QQ0lfTVNJX0lSUV9JTkRFWCkKPiAg
CQlyZXR1cm4gMTsKPiArCWVsc2UgaWYgKHR5cGUgPCBWRklPX1BDSV9OVU1fSVJRUyArIHZncHUt
PnZkZXYubnVtX2lycXMpCj4gKwkJcmV0dXJuIHZncHUtPnZkZXYuaXJxW3R5cGUgLSBWRklPX1BD
SV9OVU1fSVJRU10uY291bnQ7Cj4gIAo+ICAJcmV0dXJuIDA7Cj4gIH0KPiBAQCAtMTI5Nyw3ICsx
Mjk5LDYwIEBAIHN0YXRpYyBpbnQgaW50ZWxfdmdwdV9zZXRfbXNpX3RyaWdnZXIoc3RydWN0IGlu
dGVsX3ZncHUgKnZncHUsCj4gIAlyZXR1cm4gMDsKPiAgfQo+ICAKPiAtc3RhdGljIGludCBpbnRl
bF92Z3B1X3NldF9pcnFzKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCB1MzIgZmxhZ3MsCj4gK3N0
YXRpYyBpbnQgaW50ZWxfdmd1X3NldF9kaXNwbGF5X2lycV9tYXNrKHN0cnVjdCBpbnRlbF92Z3B1
ICp2Z3B1LAo+ICsJCXVuc2lnbmVkIGludCBpbmRleCwgdW5zaWduZWQgaW50IHN0YXJ0LCB1bnNp
Z25lZCBpbnQgY291bnQsCj4gKwkJdTMyIGZsYWdzLCB2b2lkICpkYXRhKQo+ICt7Cj4gKwlpZiAo
c3RhcnQgIT0gMCB8fCBjb3VudCA+IDIpCj4gKwkJcmV0dXJuIC1FSU5WQUw7CgpXYXMgdGhpcyBt
ZWFudCB0byBiZSA+PSAyPyAgT3IganVzdCA+IDE/ICBJIHRoaW5rIHdlJ3JlIG9ubHkKYWR2ZXJ0
aXNpbmcgYW4gaW5kZXggd2l0aCBhIGNvdW50IG9mIDEuCgo+ICsKPiArCWlmIChmbGFncyAmIFZG
SU9fSVJRX1NFVF9EQVRBX05PTkUpCj4gKwkJdmdwdS0+dmRldi5kaXNwbGF5X2V2ZW50X21hc2sg
PSB0cnVlOwoKSXQncyBhbHNvIHZhbGlkIGZvciBhIHVzZXIgdG8gc2V0IHRoaXMgd2l0aCBEQVRB
X0JPT0wuCgpCb3RoIGNvbW1lbnRzIGFib3ZlIGFwcGx5IHRvIGluc3RhbmNlcyBiZWxvdyBhcyB3
ZWxsLgoKPiArCj4gKwlyZXR1cm4gMDsKPiArfQo+ICsKPiArc3RhdGljIGludCBpbnRlbF92Z3Vf
c2V0X2Rpc3BsYXlfaXJxX3VubWFzayhzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwKPiArCQl1bnNp
Z25lZCBpbnQgaW5kZXgsIHVuc2lnbmVkIGludCBzdGFydCwgdW5zaWduZWQgaW50IGNvdW50LAo+
ICsJCXUzMiBmbGFncywgdm9pZCAqZGF0YSkKPiArewo+ICsJaWYgKHN0YXJ0ICE9IDAgfHwgY291
bnQgPiAyKQo+ICsJCXJldHVybiAtRUlOVkFMOwo+ICsKPiArCWlmIChmbGFncyAmIFZGSU9fSVJR
X1NFVF9EQVRBX05PTkUpCj4gKwkJdmdwdS0+dmRldi5kaXNwbGF5X2V2ZW50X21hc2sgPSBmYWxz
ZTsKPiArCj4gKwlyZXR1cm4gMDsKPiArfQo+ICsKPiArc3RhdGljIGludCBpbnRlbF92Z3B1X3Nl
dF9kaXNwbGF5X2V2ZW50X3RyaWdnZXIoc3RydWN0IGludGVsX3ZncHUgKnZncHUsCj4gKwkJdW5z
aWduZWQgaW50IGluZGV4LCB1bnNpZ25lZCBpbnQgc3RhcnQsIHVuc2lnbmVkIGludCBjb3VudCwK
PiArCQl1MzIgZmxhZ3MsIHZvaWQgKmRhdGEpCj4gK3sKPiArCXN0cnVjdCBldmVudGZkX2N0eCAq
dHJpZ2dlcjsKCnN0YXJ0IGFuZCBjb3VudCBhcmUgaWdub3JlZCBoZXJlLCB0aGUgdXNlciBjb3Vs
ZCBwYXNzIGFueXRoaW5nLgoKPiArCWlmIChmbGFncyAmIFZGSU9fSVJRX1NFVF9EQVRBX0VWRU5U
RkQpIHsKPiArCQlpbnQgZmQgPSAqKGludCAqKWRhdGE7Cj4gKwo+ICsJCXRyaWdnZXIgPSBldmVu
dGZkX2N0eF9mZGdldChmZCk7Cj4gKwkJaWYgKElTX0VSUih0cmlnZ2VyKSkgewo+ICsJCQlndnRf
dmdwdV9lcnIoImV2ZW50ZmRfY3R4X2ZkZ2V0IGZhaWxlZFxuIik7Cj4gKwkJCXJldHVybiBQVFJf
RVJSKHRyaWdnZXIpOwo+ICsJCX0KPiArCQl2Z3B1LT52ZGV2LnZibGFua190cmlnZ2VyID0gdHJp
Z2dlcjsKPiArCQl2Z3B1LT52ZGV2LmRpc3BsYXlfZXZlbnRfbWFzayA9IGZhbHNlOwo+ICsJfSBl
bHNlIGlmICgoZmxhZ3MgJiBWRklPX0lSUV9TRVRfREFUQV9OT05FKSAmJiAhY291bnQpIHsKPiAr
CQl0cmlnZ2VyID0gdmdwdS0+dmRldi52YmxhbmtfdHJpZ2dlcjsKPiArCQlpZiAodHJpZ2dlcikg
ewo+ICsJCQlldmVudGZkX2N0eF9wdXQodHJpZ2dlcik7Cj4gKwkJCXZncHUtPnZkZXYudmJsYW5r
X3RyaWdnZXIgPSBOVUxMOwo+ICsJCX0KPiArCX0KCkkgZG9uJ3QgdGhpbmsgdGhpcyBzdXBwb3J0
cyBhbGwgdXNlciBpbnRlcmFjdGlvbnMgZWl0aGVyLCBub3RhYmx5CnByb3ZpZGluZyBhbiBldmVu
dGZkIG9mIC0xIHRvIGRpc2FibGUgdGhlIElSUSBhcyBkZWZpbmVkIGluIHRoZSB1YXBpLgpUaGFu
a3MsCgpBbGV4Cgo+ICsKPiArCXJldHVybiAwOwo+ICt9Cj4gKwo+ICtpbnQgaW50ZWxfdmdwdV9z
ZXRfaXJxcyhzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdTMyIGZsYWdzLAo+ICAJCXVuc2lnbmVk
IGludCBpbmRleCwgdW5zaWduZWQgaW50IHN0YXJ0LCB1bnNpZ25lZCBpbnQgY291bnQsCj4gIAkJ
dm9pZCAqZGF0YSkKPiAgewo+IEBAIC0xMzMwLDYgKzEzODUsMzUgQEAgc3RhdGljIGludCBpbnRl
bF92Z3B1X3NldF9pcnFzKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCB1MzIgZmxhZ3MsCj4gIAkJ
CWJyZWFrOwo+ICAJCX0KPiAgCQlicmVhazsKPiArCWRlZmF1bHQ6Cj4gKwl7Cj4gKwkJaW50IGk7
Cj4gKwo+ICsJCWlmIChpbmRleCA+PSBWRklPX1BDSV9OVU1fSVJRUyArCj4gKwkJCQkJdmdwdS0+
dmRldi5udW1faXJxcykKPiArCQkJcmV0dXJuIC1FSU5WQUw7Cj4gKwkJaW5kZXggPQo+ICsJCQlh
cnJheV9pbmRleF9ub3NwZWMoaW5kZXgsCj4gKwkJCQkJCVZGSU9fUENJX05VTV9JUlFTICsKPiAr
CQkJCQkJdmdwdS0+dmRldi5udW1faXJxcyk7Cj4gKwo+ICsJCWkgPSBpbmRleCAtIFZGSU9fUENJ
X05VTV9JUlFTOwo+ICsJCWlmICh2Z3B1LT52ZGV2LmlycVtpXS50eXBlID09IFZGSU9fSVJRX1RZ
UEVfR0ZYICYmCj4gKwkJICAgIHZncHUtPnZkZXYuaXJxW2ldLnN1YnR5cGUgPT0KPiArCQkgICAg
VkZJT19JUlFfU1VCVFlQRV9HRlhfRElTUExBWV9JUlEpIHsKPiArCQkJc3dpdGNoIChmbGFncyAm
IFZGSU9fSVJRX1NFVF9BQ1RJT05fVFlQRV9NQVNLKSB7Cj4gKwkJCWNhc2UgVkZJT19JUlFfU0VU
X0FDVElPTl9NQVNLOgo+ICsJCQkJZnVuYyA9IGludGVsX3ZndV9zZXRfZGlzcGxheV9pcnFfbWFz
azsKPiArCQkJCWJyZWFrOwo+ICsJCQljYXNlIFZGSU9fSVJRX1NFVF9BQ1RJT05fVU5NQVNLOgo+
ICsJCQkJZnVuYyA9IGludGVsX3ZndV9zZXRfZGlzcGxheV9pcnFfdW5tYXNrOwo+ICsJCQkJYnJl
YWs7Cj4gKwkJCWNhc2UgVkZJT19JUlFfU0VUX0FDVElPTl9UUklHR0VSOgo+ICsJCQkJZnVuYyA9
IGludGVsX3ZncHVfc2V0X2Rpc3BsYXlfZXZlbnRfdHJpZ2dlcjsKPiArCQkJCWJyZWFrOwo+ICsJ
CQl9Cj4gKwkJfQo+ICsJfQo+ICAJfQo+ICAKPiAgCWlmICghZnVuYykKPiBAQCAtMTM2MSw3ICsx
NDQ1LDcgQEAgc3RhdGljIGxvbmcgaW50ZWxfdmdwdV9pb2N0bChzdHJ1Y3QgbWRldl9kZXZpY2Ug
Km1kZXYsIHVuc2lnbmVkIGludCBjbWQsCj4gIAkJaW5mby5mbGFncyB8PSBWRklPX0RFVklDRV9G
TEFHU19SRVNFVDsKPiAgCQlpbmZvLm51bV9yZWdpb25zID0gVkZJT19QQ0lfTlVNX1JFR0lPTlMg
Kwo+ICAJCQkJdmdwdS0+dmRldi5udW1fcmVnaW9uczsKPiAtCQlpbmZvLm51bV9pcnFzID0gVkZJ
T19QQ0lfTlVNX0lSUVM7Cj4gKwkJaW5mby5udW1faXJxcyA9IFZGSU9fUENJX05VTV9JUlFTICsg
dmdwdS0+dmRldi5udW1faXJxczsKPiAgCj4gIAkJcmV0dXJuIGNvcHlfdG9fdXNlcigodm9pZCBf
X3VzZXIgKilhcmcsICZpbmZvLCBtaW5zeikgPwo+ICAJCQktRUZBVUxUIDogMDsKPiBAQCAtMTUx
OSwzMiArMTYwMyw4OCBAQCBzdGF0aWMgbG9uZyBpbnRlbF92Z3B1X2lvY3RsKHN0cnVjdCBtZGV2
X2RldmljZSAqbWRldiwgdW5zaWduZWQgaW50IGNtZCwKPiAgCQkJLUVGQVVMVCA6IDA7Cj4gIAl9
IGVsc2UgaWYgKGNtZCA9PSBWRklPX0RFVklDRV9HRVRfSVJRX0lORk8pIHsKPiAgCQlzdHJ1Y3Qg
dmZpb19pcnFfaW5mbyBpbmZvOwo+ICsJCXN0cnVjdCB2ZmlvX2luZm9fY2FwIGNhcHMgPSB7IC5i
dWYgPSBOVUxMLCAuc2l6ZSA9IDAgfTsKPiArCQl1bnNpZ25lZCBpbnQgaTsKPiArCQlpbnQgcmV0
Owo+ICAKPiAgCQltaW5zeiA9IG9mZnNldG9mZW5kKHN0cnVjdCB2ZmlvX2lycV9pbmZvLCBjb3Vu
dCk7Cj4gIAo+ICAJCWlmIChjb3B5X2Zyb21fdXNlcigmaW5mbywgKHZvaWQgX191c2VyICopYXJn
LCBtaW5zeikpCj4gIAkJCXJldHVybiAtRUZBVUxUOwo+ICAKPiAtCQlpZiAoaW5mby5hcmdzeiA8
IG1pbnN6IHx8IGluZm8uaW5kZXggPj0gVkZJT19QQ0lfTlVNX0lSUVMpCj4gKwkJaWYgKGluZm8u
YXJnc3ogPCBtaW5zeikKPiAgCQkJcmV0dXJuIC1FSU5WQUw7Cj4gIAo+ICAJCXN3aXRjaCAoaW5m
by5pbmRleCkgewo+ICAJCWNhc2UgVkZJT19QQ0lfSU5UWF9JUlFfSU5ERVg6Cj4gIAkJY2FzZSBW
RklPX1BDSV9NU0lfSVJRX0lOREVYOgo+ICsJCQlpbmZvLmZsYWdzID0gVkZJT19JUlFfSU5GT19F
VkVOVEZEOwo+ICAJCQlicmVhazsKPiAtCQlkZWZhdWx0Ogo+ICsJCWNhc2UgVkZJT19QQ0lfTVNJ
WF9JUlFfSU5ERVg6Cj4gKwkJY2FzZSBWRklPX1BDSV9FUlJfSVJRX0lOREVYOgo+ICsJCWNhc2Ug
VkZJT19QQ0lfUkVRX0lSUV9JTkRFWDoKPiAgCQkJcmV0dXJuIC1FSU5WQUw7Cj4gLQkJfQo+ICsJ
CWRlZmF1bHQ6Cj4gKwkJewo+ICsJCQlzdHJ1Y3QgdmZpb19pcnFfaW5mb19jYXBfdHlwZSBjYXBf
dHlwZSA9IHsKPiArCQkJCS5oZWFkZXIuaWQgPSBWRklPX0lSUV9JTkZPX0NBUF9UWVBFLAo+ICsJ
CQkJLmhlYWRlci52ZXJzaW9uID0gMSB9Owo+ICAKPiAtCQlpbmZvLmZsYWdzID0gVkZJT19JUlFf
SU5GT19FVkVOVEZEOwo+ICsJCQlpZiAoaW5mby5pbmRleCA+PSBWRklPX1BDSV9OVU1fSVJRUyAr
Cj4gKwkJCQkJdmdwdS0+dmRldi5udW1faXJxcykKPiArCQkJCXJldHVybiAtRUlOVkFMOwo+ICsJ
CQlpbmZvLmluZGV4ID0KPiArCQkJCWFycmF5X2luZGV4X25vc3BlYyhpbmZvLmluZGV4LAo+ICsJ
CQkJCQlWRklPX1BDSV9OVU1fSVJRUyArCj4gKwkJCQkJCXZncHUtPnZkZXYubnVtX2lycXMpOwo+
ICsKPiArCQkJaSA9IGluZm8uaW5kZXggLSBWRklPX1BDSV9OVU1fSVJRUzsKPiArCj4gKwkJCWlu
Zm8uZmxhZ3MgPSB2Z3B1LT52ZGV2LmlycVtpXS5mbGFnczsKPiArCQkJY2FwX3R5cGUudHlwZSA9
IHZncHUtPnZkZXYuaXJxW2ldLnR5cGU7Cj4gKwkJCWNhcF90eXBlLnN1YnR5cGUgPSB2Z3B1LT52
ZGV2LmlycVtpXS5zdWJ0eXBlOwo+ICsKPiArCQkJcmV0ID0gdmZpb19pbmZvX2FkZF9jYXBhYmls
aXR5KCZjYXBzLAo+ICsJCQkJCQkmY2FwX3R5cGUuaGVhZGVyLAo+ICsJCQkJCQlzaXplb2YoY2Fw
X3R5cGUpKTsKPiArCQkJaWYgKHJldCkKPiArCQkJCXJldHVybiByZXQ7Cj4gKwo+ICsJCQlpZiAo
dmdwdS0+dmRldi5pcnFbaV0ub3BzLT5hZGRfY2FwYWJpbGl0eSkgewo+ICsJCQkJcmV0ID0gdmdw
dS0+dmRldi5pcnFbaV0ub3BzLT5hZGRfY2FwYWJpbGl0eSh2Z3B1LAo+ICsJCQkJCQkJCQkgICAg
JmNhcHMpOwo+ICsJCQkJaWYgKHJldCkKPiArCQkJCQlyZXR1cm4gcmV0Owo+ICsJCQl9Cj4gKwkJ
fQo+ICsJCX0KPiAgCj4gIAkJaW5mby5jb3VudCA9IGludGVsX3ZncHVfZ2V0X2lycV9jb3VudCh2
Z3B1LCBpbmZvLmluZGV4KTsKPiAgCj4gIAkJaWYgKGluZm8uaW5kZXggPT0gVkZJT19QQ0lfSU5U
WF9JUlFfSU5ERVgpCj4gIAkJCWluZm8uZmxhZ3MgfD0gKFZGSU9fSVJRX0lORk9fTUFTS0FCTEUg
fAo+ICAJCQkJICAgICAgIFZGSU9fSVJRX0lORk9fQVVUT01BU0tFRCk7Cj4gLQkJZWxzZQo+IC0J
CQlpbmZvLmZsYWdzIHw9IFZGSU9fSVJRX0lORk9fTk9SRVNJWkU7Cj4gKwo+ICsJCWlmIChjYXBz
LnNpemUpIHsKPiArCQkJaW5mby5mbGFncyB8PSBWRklPX0lSUV9JTkZPX0ZMQUdfQ0FQUzsKPiAr
CQkJaWYgKGluZm8uYXJnc3ogPCBzaXplb2YoaW5mbykgKyBjYXBzLnNpemUpIHsKPiArCQkJCWlu
Zm8uYXJnc3ogPSBzaXplb2YoaW5mbykgKyBjYXBzLnNpemU7Cj4gKwkJCQlpbmZvLmNhcF9vZmZz
ZXQgPSAwOwo+ICsJCQl9IGVsc2Ugewo+ICsJCQkJdmZpb19pbmZvX2NhcF9zaGlmdCgmY2Fwcywg
c2l6ZW9mKGluZm8pKTsKPiArCQkJCWlmIChjb3B5X3RvX3VzZXIoKHZvaWQgX191c2VyICopYXJn
ICsKPiArCQkJCQkJICBzaXplb2YoaW5mbyksIGNhcHMuYnVmLAo+ICsJCQkJCQkgIGNhcHMuc2l6
ZSkpIHsKPiArCQkJCQlrZnJlZShjYXBzLmJ1Zik7Cj4gKwkJCQkJcmV0dXJuIC1FRkFVTFQ7Cj4g
KwkJCQl9Cj4gKwkJCQlpbmZvLmNhcF9vZmZzZXQgPSBzaXplb2YoaW5mbyk7Cj4gKwkJCQlpZiAo
b2Zmc2V0b2ZlbmQoc3RydWN0IHZmaW9faXJxX2luZm8sIGNhcF9vZmZzZXQpID4gbWluc3opCj4g
KwkJCQkJbWluc3ogPSBvZmZzZXRvZmVuZChzdHJ1Y3QgdmZpb19pcnFfaW5mbywgY2FwX29mZnNl
dCk7Cj4gKwkJCX0KPiArCj4gKwkJCWtmcmVlKGNhcHMuYnVmKTsKPiArCQl9Cj4gIAo+ICAJCXJl
dHVybiBjb3B5X3RvX3VzZXIoKHZvaWQgX191c2VyICopYXJnLCAmaW5mbywgbWluc3opID8KPiAg
CQkJLUVGQVVMVCA6IDA7Cj4gQEAgLTE1NjMsNyArMTcwMyw4IEBAIHN0YXRpYyBsb25nIGludGVs
X3ZncHVfaW9jdGwoc3RydWN0IG1kZXZfZGV2aWNlICptZGV2LCB1bnNpZ25lZCBpbnQgY21kLAo+
ICAJCQlpbnQgbWF4ID0gaW50ZWxfdmdwdV9nZXRfaXJxX2NvdW50KHZncHUsIGhkci5pbmRleCk7
Cj4gIAo+ICAJCQlyZXQgPSB2ZmlvX3NldF9pcnFzX3ZhbGlkYXRlX2FuZF9wcmVwYXJlKCZoZHIs
IG1heCwKPiAtCQkJCQkJVkZJT19QQ0lfTlVNX0lSUVMsICZkYXRhX3NpemUpOwo+ICsJCQkJCVZG
SU9fUENJX05VTV9JUlFTICsgdmdwdS0+dmRldi5udW1faXJxcywKPiArCQkJCQkJCQkgJmRhdGFf
c2l6ZSk7Cj4gIAkJCWlmIChyZXQpIHsKPiAgCQkJCWd2dF92Z3B1X2VycigiaW50ZWw6dmZpb19z
ZXRfaXJxc192YWxpZGF0ZV9hbmRfcHJlcGFyZSBmYWlsZWRcbiIpOwo+ICAJCQkJcmV0dXJuIC1F
SU5WQUw7CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpp
bnRlbC1ndnQtZGV2IG1haWxpbmcgbGlzdAppbnRlbC1ndnQtZGV2QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWd2dC1kZXY=
