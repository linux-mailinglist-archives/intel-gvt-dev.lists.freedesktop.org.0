Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 23C2968369
	for <lists+intel-gvt-dev@lfdr.de>; Mon, 15 Jul 2019 08:08:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C3A1F897EB;
	Mon, 15 Jul 2019 06:08:26 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1B5DB897EB
 for <intel-gvt-dev@lists.freedesktop.org>;
 Mon, 15 Jul 2019 06:08:26 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 14 Jul 2019 23:08:25 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,493,1557212400"; d="scan'208";a="194405145"
Received: from cfl-host.sh.intel.com ([10.239.158.129])
 by fmsmga002.fm.intel.com with ESMTP; 14 Jul 2019 23:08:24 -0700
From: fred gao <fred.gao@intel.com>
To: intel-gvt-dev@lists.freedesktop.org
Subject: [PATCH v1 2/3] drm/i915/gvt: Add MI command valid length check
Date: Mon, 15 Jul 2019 06:07:23 +0800
Message-Id: <20190714220723.13857-1-fred.gao@intel.com>
X-Mailer: git-send-email 2.17.1
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: Gao@freedesktop.org, "Gao, Fred" <fred.gao@intel.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

RnJvbTogIkdhbywgRnJlZCIgPGZyZWQuZ2FvQGludGVsLmNvbT4KCkFkZCB0aGUgY29uc3RhbnQg
dmFsaWQgbGVuZ3RoIG9mIE1JIGNvbW1hbmQuCgp2MjogQWRkIEZfVkFMX0NPTlNUIGZsYWcuICha
aGVueXUgV2FuZykKClNpZ25lZC1vZmYtYnk6IEdhbywgRnJlZCA8ZnJlZC5nYW9AaW50ZWwuY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRfcGFyc2VyLmMgfCA3OSArKysrKysr
KysrKysrKysrKystLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA1NCBpbnNlcnRpb25zKCspLCAy
NSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21k
X3BhcnNlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2NtZF9wYXJzZXIuYwppbmRleCA0
MmExMGIyMDA3NDQuLjU5MzEyOWIxMDg5NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2NtZF9wYXJzZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3Bh
cnNlci5jCkBAIC0zNzQsNiArMzc0LDE5IEBAIHR5cGVkZWYgaW50ICgqcGFyc2VyX2NtZF9oYW5k
bGVyKShzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMpOwogI2RlZmluZSBBRERSX0ZJWF80KHgx
LCB4MiwgeDMsIHg0KQkoQUREUl9GSVhfMSh4MSkgfCBBRERSX0ZJWF8zKHgyLCB4MywgeDQpKQog
I2RlZmluZSBBRERSX0ZJWF81KHgxLCB4MiwgeDMsIHg0LCB4NSkgIChBRERSX0ZJWF8xKHgxKSB8
IEFERFJfRklYXzQoeDIsIHgzLCB4NCwgeDUpKQogCisjZGVmaW5lIE9QX0xFTkdUSF9CSUFTIDIK
KyNkZWZpbmUgQ01EX0xFTih2YWx1ZSkgICh2YWx1ZSArIE9QX0xFTkdUSF9CSUFTKQorCitzdGF0
aWMgaW50IGd2dF9jaGVja192YWxpZF9jbWRfbGVuZ3RoKGludCBsZW4sIGludCB2YWxpZF9sZW4p
Cit7CisJaWYgKHZhbGlkX2xlbiAhPSBsZW4pIHsKKwkJZ3Z0X2VycigibGVuIGlzIG5vdCB2YWxp
ZDogIGxlbj0ldSAgdmFsaWRfbGVuPSV1XG4iLAorCQkJbGVuLCB2YWxpZF9sZW4pOworCQlyZXR1
cm4gLUVGQVVMVDsKKwl9CisJcmV0dXJuIDA7Cit9CisKIHN0cnVjdCBjbWRfaW5mbyB7CiAJY29u
c3QgY2hhciAqbmFtZTsKIAl1MzIgb3Bjb2RlOwpAQCAtMTkxOCwxOCArMTkzMSwyMSBAQCBzdGF0
aWMgY29uc3Qgc3RydWN0IGNtZF9pbmZvIGNtZF9pbmZvW10gPSB7CiAJeyJNSV9ESVNQTEFZX0ZM
SVAiLCBPUF9NSV9ESVNQTEFZX0ZMSVAsIEZfTEVOX1ZBUiwKIAkJUl9SQ1MgfCBSX0JDUywgRF9B
TEwsIDAsIDgsIGNtZF9oYW5kbGVyX21pX2Rpc3BsYXlfZmxpcH0sCiAKLQl7Ik1JX1NFTUFQSE9S
RV9NQk9YIiwgT1BfTUlfU0VNQVBIT1JFX01CT1gsIEZfTEVOX1ZBUiwgUl9BTEwsIERfQUxMLAot
CQkwLCA4LCBOVUxMfSwKKwl7Ik1JX1NFTUFQSE9SRV9NQk9YIiwgT1BfTUlfU0VNQVBIT1JFX01C
T1gsIEZfTEVOX1ZBUiB8IEZfTEVOX1ZBUl9GSVhFRCwKKwkJUl9BTEwsIERfQUxMLCAwLCA4LCBO
VUxMLCBDTURfTEVOKDEpfSwKIAogCXsiTUlfTUFUSCIsIE9QX01JX01BVEgsIEZfTEVOX1ZBUiwg
Ul9BTEwsIERfQUxMLCAwLCA4LCBOVUxMfSwKIAotCXsiTUlfVVJCX0NMRUFSIiwgT1BfTUlfVVJC
X0NMRUFSLCBGX0xFTl9WQVIsIFJfUkNTLCBEX0FMTCwgMCwgOCwgTlVMTH0sCisJeyJNSV9VUkJf
Q0xFQVIiLCBPUF9NSV9VUkJfQ0xFQVIsIEZfTEVOX1ZBUiB8IEZfTEVOX1ZBUl9GSVhFRCwgUl9S
Q1MsCisJCURfQUxMLCAwLCA4LCBOVUxMLCBDTURfTEVOKDApfSwKIAotCXsiTUlfU0VNQVBIT1JF
X1NJR05BTCIsIE9QX01JX1NFTUFQSE9SRV9TSUdOQUwsIEZfTEVOX1ZBUiwgUl9BTEwsCi0JCURf
QkRXX1BMVVMsIDAsIDgsIE5VTEx9LAorCXsiTUlfU0VNQVBIT1JFX1NJR05BTCIsIE9QX01JX1NF
TUFQSE9SRV9TSUdOQUwsCisJCUZfTEVOX1ZBUiB8IEZfTEVOX1ZBUl9GSVhFRCwgUl9BTEwsIERf
QkRXX1BMVVMsIDAsIDgsCisJCU5VTEwsIENNRF9MRU4oMCl9LAogCi0JeyJNSV9TRU1BUEhPUkVf
V0FJVCIsIE9QX01JX1NFTUFQSE9SRV9XQUlULCBGX0xFTl9WQVIsIFJfQUxMLAotCQlEX0JEV19Q
TFVTLCBBRERSX0ZJWF8xKDIpLCA4LCBjbWRfaGFuZGxlcl9taV9zZW1hcGhvcmVfd2FpdH0sCisJ
eyJNSV9TRU1BUEhPUkVfV0FJVCIsIE9QX01JX1NFTUFQSE9SRV9XQUlULAorCQlGX0xFTl9WQVIg
fCBGX0xFTl9WQVJfRklYRUQsIFJfQUxMLCBEX0JEV19QTFVTLCBBRERSX0ZJWF8xKDIpLAorCQk4
LCBjbWRfaGFuZGxlcl9taV9zZW1hcGhvcmVfd2FpdCwgQ01EX0xFTigyKX0sCiAKIAl7Ik1JX1NU
T1JFX0RBVEFfSU1NIiwgT1BfTUlfU1RPUkVfREFUQV9JTU0sIEZfTEVOX1ZBUiwgUl9BTEwsIERf
QkRXX1BMVVMsCiAJCUFERFJfRklYXzEoMSksIDEwLCBjbWRfaGFuZGxlcl9taV9zdG9yZV9kYXRh
X2ltbX0sCkBAIC0xOTM3LDE0ICsxOTUzLDE2IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgY21kX2lu
Zm8gY21kX2luZm9bXSA9IHsKIAl7Ik1JX1NUT1JFX0RBVEFfSU5ERVgiLCBPUF9NSV9TVE9SRV9E
QVRBX0lOREVYLCBGX0xFTl9WQVIsIFJfQUxMLCBEX0FMTCwKIAkJMCwgOCwgY21kX2hhbmRsZXJf
bWlfc3RvcmVfZGF0YV9pbmRleH0sCiAKLQl7Ik1JX0xPQURfUkVHSVNURVJfSU1NIiwgT1BfTUlf
TE9BRF9SRUdJU1RFUl9JTU0sIEZfTEVOX1ZBUiwgUl9BTEwsCi0JCURfQUxMLCAwLCA4LCBjbWRf
aGFuZGxlcl9scml9LAorCXsiTUlfTE9BRF9SRUdJU1RFUl9JTU0iLCBPUF9NSV9MT0FEX1JFR0lT
VEVSX0lNTSwKKwkJRl9MRU5fVkFSIHwgRl9MRU5fVkFSX0ZJWEVELCBSX0FMTCwgRF9BTEwsIDAs
IDgsCisJCWNtZF9oYW5kbGVyX2xyaSwgQ01EX0xFTigxKX0sCiAKIAl7Ik1JX1VQREFURV9HVFQi
LCBPUF9NSV9VUERBVEVfR1RULCBGX0xFTl9WQVIsIFJfQUxMLCBEX0JEV19QTFVTLCAwLCAxMCwK
IAkJY21kX2hhbmRsZXJfbWlfdXBkYXRlX2d0dH0sCiAKLQl7Ik1JX1NUT1JFX1JFR0lTVEVSX01F
TSIsIE9QX01JX1NUT1JFX1JFR0lTVEVSX01FTSwgRl9MRU5fVkFSLCBSX0FMTCwKLQkJRF9BTEws
IEFERFJfRklYXzEoMiksIDgsIGNtZF9oYW5kbGVyX3NybX0sCisJeyJNSV9TVE9SRV9SRUdJU1RF
Ul9NRU0iLCBPUF9NSV9TVE9SRV9SRUdJU1RFUl9NRU0sCisJCUZfTEVOX1ZBUiB8IEZfTEVOX1ZB
Ul9GSVhFRCwgUl9BTEwsIERfQUxMLCBBRERSX0ZJWF8xKDIpLCA4LAorCQljbWRfaGFuZGxlcl9z
cm0sIENNRF9MRU4oMil9LAogCiAJeyJNSV9GTFVTSF9EVyIsIE9QX01JX0ZMVVNIX0RXLCBGX0xF
Tl9WQVIsIFJfQUxMLCBEX0FMTCwgMCwgNiwKIAkJY21kX2hhbmRsZXJfbWlfZmx1c2hfZHd9LApA
QCAtMTk1MiwyNiArMTk3MCwzMCBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGNtZF9pbmZvIGNtZF9p
bmZvW10gPSB7CiAJeyJNSV9DTEZMVVNIIiwgT1BfTUlfQ0xGTFVTSCwgRl9MRU5fVkFSLCBSX0FM
TCwgRF9BTEwsIEFERFJfRklYXzEoMSksCiAJCTEwLCBjbWRfaGFuZGxlcl9taV9jbGZsdXNofSwK
IAotCXsiTUlfUkVQT1JUX1BFUkZfQ09VTlQiLCBPUF9NSV9SRVBPUlRfUEVSRl9DT1VOVCwgRl9M
RU5fVkFSLCBSX0FMTCwKLQkJRF9BTEwsIEFERFJfRklYXzEoMSksIDYsIGNtZF9oYW5kbGVyX21p
X3JlcG9ydF9wZXJmX2NvdW50fSwKKwl7Ik1JX1JFUE9SVF9QRVJGX0NPVU5UIiwgT1BfTUlfUkVQ
T1JUX1BFUkZfQ09VTlQsCisJCUZfTEVOX1ZBUiB8IEZfTEVOX1ZBUl9GSVhFRCwgUl9BTEwsIERf
QUxMLCBBRERSX0ZJWF8xKDEpLCA2LAorCQljbWRfaGFuZGxlcl9taV9yZXBvcnRfcGVyZl9jb3Vu
dCwgQ01EX0xFTigyKX0sCiAKLQl7Ik1JX0xPQURfUkVHSVNURVJfTUVNIiwgT1BfTUlfTE9BRF9S
RUdJU1RFUl9NRU0sIEZfTEVOX1ZBUiwgUl9BTEwsCi0JCURfQUxMLCBBRERSX0ZJWF8xKDIpLCA4
LCBjbWRfaGFuZGxlcl9scm19LAorCXsiTUlfTE9BRF9SRUdJU1RFUl9NRU0iLCBPUF9NSV9MT0FE
X1JFR0lTVEVSX01FTSwKKwkJRl9MRU5fVkFSIHwgRl9MRU5fVkFSX0ZJWEVELCBSX0FMTCwgRF9B
TEwsIEFERFJfRklYXzEoMiksIDgsCisJCWNtZF9oYW5kbGVyX2xybSwgQ01EX0xFTigyKX0sCiAK
LQl7Ik1JX0xPQURfUkVHSVNURVJfUkVHIiwgT1BfTUlfTE9BRF9SRUdJU1RFUl9SRUcsIEZfTEVO
X1ZBUiwgUl9BTEwsCi0JCURfQUxMLCAwLCA4LCBjbWRfaGFuZGxlcl9scnJ9LAorCXsiTUlfTE9B
RF9SRUdJU1RFUl9SRUciLCBPUF9NSV9MT0FEX1JFR0lTVEVSX1JFRywKKwkJRl9MRU5fVkFSIHwg
Rl9MRU5fVkFSX0ZJWEVELCBSX0FMTCwgRF9BTEwsIDAsIDgsCisJCWNtZF9oYW5kbGVyX2xyciwg
Q01EX0xFTigxKX0sCiAKLQl7Ik1JX1JTX1NUT1JFX0RBVEFfSU1NIiwgT1BfTUlfUlNfU1RPUkVf
REFUQV9JTU0sIEZfTEVOX1ZBUiwgUl9SQ1MsCi0JCURfQUxMLCAwLCA4LCBOVUxMfSwKKwl7Ik1J
X1JTX1NUT1JFX0RBVEFfSU1NIiwgT1BfTUlfUlNfU1RPUkVfREFUQV9JTU0sCisJCUZfTEVOX1ZB
UiB8IEZfTEVOX1ZBUl9GSVhFRCwgUl9SQ1MsIERfQUxMLCAwLAorCQk4LCBOVUxMLCBDTURfTEVO
KDIpfSwKIAotCXsiTUlfTE9BRF9VUkJfTUVNIiwgT1BfTUlfTE9BRF9VUkJfTUVNLCBGX0xFTl9W
QVIsIFJfUkNTLCBEX0FMTCwKLQkJQUREUl9GSVhfMSgyKSwgOCwgTlVMTH0sCisJeyJNSV9MT0FE
X1VSQl9NRU0iLCBPUF9NSV9MT0FEX1VSQl9NRU0sIEZfTEVOX1ZBUiB8IEZfTEVOX1ZBUl9GSVhF
RCwKKwkJUl9SQ1MsIERfQUxMLCBBRERSX0ZJWF8xKDIpLCA4LCBOVUxMLCBDTURfTEVOKDIpfSwK
IAogCXsiTUlfU1RPUkVfVVJNX01FTSIsIE9QX01JX1NUT1JFX1VSTV9NRU0sIEZfTEVOX1ZBUiwg
Ul9SQ1MsIERfQUxMLAogCQlBRERSX0ZJWF8xKDIpLCA4LCBOVUxMfSwKIAotCXsiTUlfT1BfMkUi
LCBPUF9NSV8yRSwgRl9MRU5fVkFSLCBSX0FMTCwgRF9CRFdfUExVUywgQUREUl9GSVhfMigxLCAy
KSwKLQkJOCwgY21kX2hhbmRsZXJfbWlfb3BfMmV9LAorCXsiTUlfT1BfMkUiLCBPUF9NSV8yRSwg
Rl9MRU5fVkFSIHwgRl9MRU5fVkFSX0ZJWEVELCBSX0FMTCwgRF9CRFdfUExVUywKKwkJQUREUl9G
SVhfMigxLCAyKSwgOCwgY21kX2hhbmRsZXJfbWlfb3BfMmUsIENNRF9MRU4oMyl9LAogCiAJeyJN
SV9PUF8yRiIsIE9QX01JXzJGLCBGX0xFTl9WQVIsIFJfQUxMLCBEX0JEV19QTFVTLCBBRERSX0ZJ
WF8xKDEpLAogCQk4LCBjbWRfaGFuZGxlcl9taV9vcF8yZn0sCkBAIC0xOTgxLDggKzIwMDMsOCBA
QCBzdGF0aWMgY29uc3Qgc3RydWN0IGNtZF9pbmZvIGNtZF9pbmZvW10gPSB7CiAJCWNtZF9oYW5k
bGVyX21pX2JhdGNoX2J1ZmZlcl9zdGFydH0sCiAKIAl7Ik1JX0NPTkRJVElPTkFMX0JBVENIX0JV
RkZFUl9FTkQiLCBPUF9NSV9DT05ESVRJT05BTF9CQVRDSF9CVUZGRVJfRU5ELAotCQlGX0xFTl9W
QVIsIFJfQUxMLCBEX0FMTCwgQUREUl9GSVhfMSgyKSwgOCwKLQkJY21kX2hhbmRsZXJfbWlfY29u
ZGl0aW9uYWxfYmF0Y2hfYnVmZmVyX2VuZH0sCisJCUZfTEVOX1ZBUiB8IEZfTEVOX1ZBUl9GSVhF
RCwgUl9BTEwsIERfQUxMLCBBRERSX0ZJWF8xKDIpLCA4LAorCQljbWRfaGFuZGxlcl9taV9jb25k
aXRpb25hbF9iYXRjaF9idWZmZXJfZW5kLCBDTURfTEVOKDIpfSwKIAogCXsiTUlfTE9BRF9TQ0FO
X0xJTkVTX0lOQ0wiLCBPUF9NSV9MT0FEX1NDQU5fTElORVNfSU5DTCwgRl9MRU5fQ09OU1QsCiAJ
CVJfUkNTIHwgUl9CQ1MsIERfQUxMLCAwLCAyLCBOVUxMfSwKQEAgLTI1NzIsNiArMjU5NCwxMyBA
QCBzdGF0aWMgaW50IGNtZF9wYXJzZXJfZXhlYyhzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMp
CiAJCQkgIGNtZF9sZW5ndGgocyksIHMtPmJ1Zl90eXBlLCBzLT5idWZfYWRkcl90eXBlLAogCQkJ
ICBzLT53b3JrbG9hZCwgaW5mby0+bmFtZSk7CiAKKwlpZiAoKGluZm8tPmZsYWcgJiBGX0xFTl9N
QVNLKSA9PSBGX0xFTl9WQVJfRklYRUQpIHsKKwkJcmV0ID0gZ3Z0X2NoZWNrX3ZhbGlkX2NtZF9s
ZW5ndGgoY21kX2xlbmd0aChzKSwKKwkJCWluZm8tPnZhbGlkX2xlbik7CisJCWlmIChyZXQpCisJ
CQlyZXR1cm4gcmV0OworCX0KKwogCWlmIChpbmZvLT5oYW5kbGVyKSB7CiAJCXJldCA9IGluZm8t
PmhhbmRsZXIocyk7CiAJCWlmIChyZXQgPCAwKSB7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmludGVsLWd2dC1kZXYgbWFpbGluZyBs
aXN0CmludGVsLWd2dC1kZXZAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ3Z0LWRldg==
