Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 178A66836A
	for <lists+intel-gvt-dev@lfdr.de>; Mon, 15 Jul 2019 08:09:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C397989369;
	Mon, 15 Jul 2019 06:09:34 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7AD6B89359
 for <intel-gvt-dev@lists.freedesktop.org>;
 Mon, 15 Jul 2019 06:09:33 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 14 Jul 2019 23:09:33 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,493,1557212400"; d="scan'208";a="194405282"
Received: from cfl-host.sh.intel.com ([10.239.158.129])
 by fmsmga002.fm.intel.com with ESMTP; 14 Jul 2019 23:09:32 -0700
From: fred gao <fred.gao@intel.com>
To: intel-gvt-dev@lists.freedesktop.org
Subject: [PATCH v1 3/3] drm/i915/gvt: Add valid length check for MI variable
 commands
Date: Mon, 15 Jul 2019 06:08:31 +0800
Message-Id: <20190714220831.14009-1-fred.gao@intel.com>
X-Mailer: git-send-email 2.17.1
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: Gao@freedesktop.org, "Gao, Fred" <fred.gao@intel.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

RnJvbTogIkdhbywgRnJlZCIgPGZyZWQuZ2FvQGludGVsLmNvbT4KCkFkZCB2YWxpZCBsZW5ndGgg
Y2hlY2sgZm9yIHRoZSBjb21tYW5kcyB3aXRoIHZhcmlhYmxlIGxlbmd0aC4KCnYyOiByZW1vdmUg
dGhlIG1hY3JvIGRlZmluaXRpb24uIChaaGVueXUpCgpTaWduZWQtb2ZmLWJ5OiBHYW8sIEZyZWQg
PGZyZWQuZ2FvQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3Bh
cnNlci5jIHwgNDAgKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAxIGZpbGUgY2hhbmdlZCwg
NDAgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9j
bWRfcGFyc2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jCmluZGV4
IDU5MzEyOWIxMDg5NC4uYjJlOTk2NjBlODcwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndnQvY21kX3BhcnNlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRf
cGFyc2VyLmMKQEAgLTM3NCw2ICszNzQsOSBAQCB0eXBlZGVmIGludCAoKnBhcnNlcl9jbWRfaGFu
ZGxlcikoc3RydWN0IHBhcnNlcl9leGVjX3N0YXRlICpzKTsKICNkZWZpbmUgQUREUl9GSVhfNCh4
MSwgeDIsIHgzLCB4NCkJKEFERFJfRklYXzEoeDEpIHwgQUREUl9GSVhfMyh4MiwgeDMsIHg0KSkK
ICNkZWZpbmUgQUREUl9GSVhfNSh4MSwgeDIsIHgzLCB4NCwgeDUpICAoQUREUl9GSVhfMSh4MSkg
fCBBRERSX0ZJWF80KHgyLCB4MywgeDQsIHg1KSkKIAorI2RlZmluZSBEV09SRF9GSUVMRChkd29y
ZCwgZW5kLCBzdGFydCkgXAorCUZJRUxEX0dFVChHRU5NQVNLKGVuZCwgc3RhcnQpLCBjbWRfdmFs
KHMsIGR3b3JkKSkKKwogI2RlZmluZSBPUF9MRU5HVEhfQklBUyAyCiAjZGVmaW5lIENNRF9MRU4o
dmFsdWUpICAodmFsdWUgKyBPUF9MRU5HVEhfQklBUykKIApAQCAtMTM5MSw2ICsxMzk0LDE1IEBA
IHN0YXRpYyBpbnQgY21kX2hhbmRsZXJfbWlfZGlzcGxheV9mbGlwKHN0cnVjdCBwYXJzZXJfZXhl
Y19zdGF0ZSAqcykKIAlpbnQgcmV0OwogCWludCBpOwogCWludCBsZW4gPSBjbWRfbGVuZ3RoKHMp
OworCXUzMiB2YWxpZF9sZW4gPSBDTURfTEVOKDEpOworCisJLyogRmxpcCBUeXBlID09IFN0ZXJl
byAzRCBGbGlwICovCisJaWYgKERXT1JEX0ZJRUxEKDIsIDEsIDApID09IDIpCisJCXZhbGlkX2xl
bisrOworCXJldCA9IGd2dF9jaGVja192YWxpZF9jbWRfbGVuZ3RoKGNtZF9sZW5ndGgocyksCisJ
CQl2YWxpZF9sZW4pOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAKIAlyZXQgPSBkZWNvZGVf
bWlfZGlzcGxheV9mbGlwKHMsICZpbmZvKTsKIAlpZiAocmV0KSB7CkBAIC0xNTEwLDEyICsxNTIy
LDIxIEBAIHN0YXRpYyBpbnQgY21kX2hhbmRsZXJfbWlfc3RvcmVfZGF0YV9pbW0oc3RydWN0IHBh
cnNlcl9leGVjX3N0YXRlICpzKQogCWludCBvcF9zaXplID0gKGNtZF9sZW5ndGgocykgLSAzKSAq
IHNpemVvZih1MzIpOwogCWludCBjb3JlX2lkID0gKGNtZF92YWwocywgMikgJiAoMSA8PCAwKSkg
PyAxIDogMDsKIAl1bnNpZ25lZCBsb25nIGdtYSwgZ21hX2xvdywgZ21hX2hpZ2g7CisJdTMyIHZh
bGlkX2xlbiA9IENNRF9MRU4oMik7CiAJaW50IHJldCA9IDA7CiAKIAkvKiBjaGVjayBwcGdndCAq
LwogCWlmICghKGNtZF92YWwocywgMCkgJiAoMSA8PCAyMikpKQogCQlyZXR1cm4gMDsKIAorCS8q
IGNoZWNrIGlmIFFXT1JEICovCisJaWYgKERXT1JEX0ZJRUxEKDAsIDIxLCAyMSkpCisJCXZhbGlk
X2xlbisrOworCXJldCA9IGd2dF9jaGVja192YWxpZF9jbWRfbGVuZ3RoKGNtZF9sZW5ndGgocyks
CisJCQl2YWxpZF9sZW4pOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKIAlnbWEgPSBjbWRf
dmFsKHMsIDIpICYgR0VOTUFTSygzMSwgMik7CiAKIAlpZiAoZ21hZHJfYnl0ZXMgPT0gOCkgewpA
QCAtMTU1OCwxMSArMTU3OSwyMCBAQCBzdGF0aWMgaW50IGNtZF9oYW5kbGVyX21pX29wXzJmKHN0
cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAqcykKIAlpbnQgb3Bfc2l6ZSA9ICgxIDw8ICgoY21kX3Zh
bChzLCAwKSAmIEdFTk1BU0soMjAsIDE5KSkgPj4gMTkpKSAqCiAJCQlzaXplb2YodTMyKTsKIAl1
bnNpZ25lZCBsb25nIGdtYSwgZ21hX2hpZ2g7CisJdTMyIHZhbGlkX2xlbiA9IENNRF9MRU4oMSk7
CiAJaW50IHJldCA9IDA7CiAKIAlpZiAoIShjbWRfdmFsKHMsIDApICYgKDEgPDwgMjIpKSkKIAkJ
cmV0dXJuIHJldDsKIAorCS8qIGNoZWNrIGlmIFFXT1JEICovCisJaWYgKERXT1JEX0ZJRUxEKDAs
IDIwLCAxOSkgPT0gMSkKKwkJdmFsaWRfbGVuICs9IDg7CisJcmV0ID0gZ3Z0X2NoZWNrX3ZhbGlk
X2NtZF9sZW5ndGgoY21kX2xlbmd0aChzKSwKKwkJCXZhbGlkX2xlbik7CisJaWYgKHJldCkKKwkJ
cmV0dXJuIHJldDsKKwogCWdtYSA9IGNtZF92YWwocywgMSkgJiBHRU5NQVNLKDMxLCAyKTsKIAlp
ZiAoZ21hZHJfYnl0ZXMgPT0gOCkgewogCQlnbWFfaGlnaCA9IGNtZF92YWwocywgMikgJiBHRU5N
QVNLKDE1LCAwKTsKQEAgLTE2MDAsNiArMTYzMCwxNiBAQCBzdGF0aWMgaW50IGNtZF9oYW5kbGVy
X21pX2ZsdXNoX2R3KHN0cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAqcykKIAlib29sIGluZGV4X21v
ZGUgPSBmYWxzZTsKIAlpbnQgcmV0ID0gMDsKIAl1MzIgaHdzX3BnYSwgdmFsOworCXUzMiB2YWxp
ZF9sZW4gPSBDTURfTEVOKDIpOworCisJcmV0ID0gZ3Z0X2NoZWNrX3ZhbGlkX2NtZF9sZW5ndGgo
Y21kX2xlbmd0aChzKSwKKwkJCXZhbGlkX2xlbik7CisJaWYgKHJldCkgeworCQkvKiBDaGVjayBh
Z2FpbiBmb3IgUXdvcmQgKi8KKwkJcmV0ID0gZ3Z0X2NoZWNrX3ZhbGlkX2NtZF9sZW5ndGgoY21k
X2xlbmd0aChzKSwKKwkJCSsrdmFsaWRfbGVuKTsKKwkJcmV0dXJuIHJldDsKKwl9CiAKIAkvKiBD
aGVjayBwb3N0LXN5bmMgYW5kIHBwZ3R0IGJpdCAqLwogCWlmICgoKGNtZF92YWwocywgMCkgPj4g
MTQpICYgMHgzKSAmJiAoY21kX3ZhbChzLCAxKSAmICgxIDw8IDIpKSkgewotLSAKMi4xNy4xCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwppbnRlbC1ndnQt
ZGV2IG1haWxpbmcgbGlzdAppbnRlbC1ndnQtZGV2QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWd2dC1kZXY=
