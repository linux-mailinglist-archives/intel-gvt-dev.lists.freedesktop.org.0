Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2BA4B16EDF
	for <lists+intel-gvt-dev@lfdr.de>; Wed,  8 May 2019 04:19:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C88156E858;
	Wed,  8 May 2019 02:19:45 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A290B6E858
 for <intel-gvt-dev@lists.freedesktop.org>;
 Wed,  8 May 2019 02:19:44 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 07 May 2019 19:19:44 -0700
X-ExtLoop1: 1
Received: from joy-optiplex-7040.sh.intel.com ([10.239.13.9])
 by fmsmga007.fm.intel.com with ESMTP; 07 May 2019 19:19:42 -0700
From: Yan Zhao <yan.y.zhao@intel.com>
To: intel-gvt-dev@lists.freedesktop.org
Subject: [PATCH v3 1/4] drm/i915/gvt: use cmd to restore in-context mmios to
 hw for gen9 platform
Date: Tue,  7 May 2019 22:14:04 -0400
Message-Id: <20190508021404.17218-1-yan.y.zhao@intel.com>
X-Mailer: git-send-email 2.17.1
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: Yan Zhao <yan.y.zhao@intel.com>, Weinan Li <weinan.z.li@intel.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

Zm9yIHJlc3RvcmUtaW5oaWJpdCBjb250ZXh0LCBoYXJkd2FyZSB3aWxsIG5vdCBsb2FkIGluLWNv
bnRleHQgbW1pb3MKKGVuZ2luZSBjb250ZXh0IHBhcnQpIHRvIGhhcmR3YXJlLCBidXQgaGFyZHdh
cmUgd2lsbCBzYXZlIHRoZSBtbWlvCnZhbHVlcyBpbiBoYXJkd2FyZSBiYWNrIHRvIGNvbnRleHQg
aW1hZ2UuIFNvLCBpbiBvcmRlciB0byBzYXZlIGNvcnJlY3QKdmFsdWVzIG9mIHZHUFUgYmFjayB0
byBjb250ZXh0IGltYWdlLCB2YWx1ZXMgb2YgdkdQVSBtbWlvcyBoYXZlIHRvIGJlCmxvYWRlZCBp
bnRvIGhhcmR3YXJlIGZpcnN0IGZvciByZXN0b3JlLWluaGliaXQgY29udGV4dC4KCkluIHRoaXMg
cGF0Y2gsIHRoZSBtZWNoYW5pc20gaXMgYXBwbGllZCB0byBhbGwgZ2VuOSBwbGF0Zm9ybS4KClRo
ZSByZWFzb24gZXhjbHVkaW5nIGdlbjggcGxhdGZvcm1zIGlzIG9ubHkgYmVjYXVzZSBvZiBsYWNr
aW5nIG9mIHRlc3RpbmcKb24gdGhvc2UgcGxhdGZvcm1zLgoKdjM6IGZvciBtb2NzIHJlZ2lzdGVy
cywgZ290byBpbi1jb250ZXh0IG1taW9zIHNhdmUtcmVzdG9yZSBwYXRoIGZvciBza2wKcGxhdGZv
cm0gYXMgd2VsbCAod2VpbmFuIGxpKQp2MjogdXBkYXRlIHZyZWcgd2hlbiBzY2FubmluZyBpbmRp
cmVjdCBjb250ZXh0IGZvciBpbmhpYml0IGNvbnRleHQgZm9yCmdlbjkKCkNjOiBXZWluYW4gTGkg
PHdlaW5hbi56LmxpQGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogWWFuIFpoYW8gPHlhbi55Lnpo
YW9AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRfcGFyc2VyLmMg
ICB8IDE0ICsrKysrKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvbW1pb19jb250
ZXh0LmMgfCAxMCArKystLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVy
LmMgICAgfCAgNCArLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDEzIGluc2VydGlvbnMoKyksIDE1IGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRfcGFy
c2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jCmluZGV4IGFiMDAy
Y2ZkM2NhYi4uNWNiNTljMGI0YmJlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dnQvY21kX3BhcnNlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRfcGFyc2Vy
LmMKQEAgLTg5NiwxMiArODk2LDE2IEBAIHN0YXRpYyBpbnQgY21kX3JlZ19oYW5kbGVyKHN0cnVj
dCBwYXJzZXJfZXhlY19zdGF0ZSAqcywKIAl9CiAKIAkvKiBUT0RPCi0JICogUmlnaHQgbm93IG9u
bHkgc2NhbiBMUkkgY29tbWFuZCBvbiBLQkwgYW5kIGluIGluaGliaXQgY29udGV4dC4KLQkgKiBJ
dCdzIGdvb2QgZW5vdWdoIHRvIHN1cHBvcnQgaW5pdGlhbGl6aW5nIG1taW8gYnkgbHJpIGNvbW1h
bmQgaW4KLQkgKiB2Z3B1IGluaGliaXQgY29udGV4dCBvbiBLQkwuCisJICogSW4gb3JkZXIgdG8g
bGV0IHdvcmtsb2FkIHdpdGggaW5oaWJpdCBjb250ZXh0IHRvIGdlbmVyYXRlCisJICogY29ycmVj
dCBpbWFnZSBkYXRhIGludG8gbWVtb3J5LCB2cmVncyB2YWx1ZXMgd2lsbCBiZSBsb2FkZWQgdG8K
KwkgKiBodyB2aWEgTFJJcyBpbiB0aGUgd29ya2xvYWQgd2l0aCBpbmhpYml0IGNvbnRleHQuIEJ1
dCBhcworCSAqIGluZGlyZWN0IGNvbnRleHQgaXMgbG9hZGVkIHByaW9yIHRvIExSSXMgaW4gd29y
a2xvYWQsIHdlIGRvbid0CisJICogd2FudCByZWcgdmFsdWVzIHNwZWNpZmllZCBpbiBpbmRpcmVj
dCBjb250ZXh0IG92ZXJ3cml0dGVuIGJ5CisJICogTFJJcyBpbiB3b3JrbG9hZHMuIFNvLCB3aGVu
IHNjYW5uaW5nIGFuIGluZGlyZWN0IGNvbnRleHQsIHdlCisJICogdXBkYXRlIHJlZyB2YWx1ZXMg
aW4gaXQgaW50byB2cmVncywgc28gTFJJcyBpbiB3b3JrbG9hZCB3aXRoCisJICogaW5oaWJpdCBj
b250ZXh0IHdpbGwgcmVzdG9yZSB3aXRoIGNvcnJlY3QgdmFsdWVzCiAJICovCi0JaWYgKChJU19L
QUJZTEFLRShzLT52Z3B1LT5ndnQtPmRldl9wcml2KQotCQl8fCBJU19DT0ZGRUVMQUtFKHMtPnZn
cHUtPmd2dC0+ZGV2X3ByaXYpKSAmJgorCWlmIChJU19HRU4oZ3Z0LT5kZXZfcHJpdiwgOSkgJiYK
IAkJCWludGVsX2d2dF9tbWlvX2lzX2luX2N0eChndnQsIG9mZnNldCkgJiYKIAkJCSFzdHJuY21w
KGNtZCwgImxyaSIsIDMpKSB7CiAJCWludGVsX2d2dF9oeXBlcnZpc29yX3JlYWRfZ3BhKHMtPnZn
cHUsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvbW1pb19jb250ZXh0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvbW1pb19jb250ZXh0LmMKaW5kZXggZTdlMTRjODQy
YmU0Li5mZTg3ZmI4Nzc3NmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9t
bWlvX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvbW1pb19jb250ZXh0
LmMKQEAgLTM5MSwxMCArMzkxLDcgQEAgc3RhdGljIHZvaWQgc3dpdGNoX21vY3Moc3RydWN0IGlu
dGVsX3ZncHUgKnByZSwgc3RydWN0IGludGVsX3ZncHUgKm5leHQsCiAJaWYgKFdBUk5fT04ocmlu
Z19pZCA+PSBBUlJBWV9TSVpFKHJlZ3MpKSkKIAkJcmV0dXJuOwogCi0JaWYgKHJpbmdfaWQgPT0g
UkNTMCAmJgotCSAgICAoSVNfS0FCWUxBS0UoZGV2X3ByaXYpIHx8Ci0JICAgICBJU19CUk9YVE9O
KGRldl9wcml2KSB8fAotCSAgICAgSVNfQ09GRkVFTEFLRShkZXZfcHJpdikpKQorCWlmIChyaW5n
X2lkID09IFJDUzAgJiYgSVNfR0VOKGRldl9wcml2LCA5KSkKIAkJcmV0dXJuOwogCiAJaWYgKCFw
cmUgJiYgIWdlbjlfcmVuZGVyX21vY3MuaW5pdGlhbGl6ZWQpCkBAIC00NjksMTEgKzQ2NiwxMCBA
QCBzdGF0aWMgdm9pZCBzd2l0Y2hfbW1pbyhzdHJ1Y3QgaW50ZWxfdmdwdSAqcHJlLAogCQkJY29u
dGludWU7CiAJCS8qCiAJCSAqIE5vIG5lZWQgdG8gZG8gc2F2ZSBvciByZXN0b3JlIG9mIHRoZSBt
bWlvIHdoaWNoIGlzIGluIGNvbnRleHQKLQkJICogc3RhdGUgaW1hZ2Ugb24ga2FieWxha2UsIGl0
J3MgaW5pdGlhbGl6ZWQgYnkgbHJpIGNvbW1hbmQgYW5kCisJCSAqIHN0YXRlIGltYWdlIG9uIGdl
bjksIGl0J3MgaW5pdGlhbGl6ZWQgYnkgbHJpIGNvbW1hbmQgYW5kCiAJCSAqIHNhdmUgb3IgcmVz
dG9yZSB3aXRoIGNvbnRleHQgdG9nZXRoZXIuCiAJCSAqLwotCQlpZiAoKElTX0tBQllMQUtFKGRl
dl9wcml2KSB8fCBJU19CUk9YVE9OKGRldl9wcml2KQotCQkJfHwgSVNfQ09GRkVFTEFLRShkZXZf
cHJpdikpICYmIG1taW8tPmluX2NvbnRleHQpCisJCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYm
IG1taW8tPmluX2NvbnRleHQpCiAJCQljb250aW51ZTsKIAogCQkvLyBzYXZlCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndnQvc2NoZWR1bGVyLmMKaW5kZXggODk5OGZhNWFiMTk4Li4xZjNiYThlZmI5OTQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKQEAgLTI5OSw5ICsyOTksNyBAQCBzdGF0
aWMgaW50IGNvcHlfd29ya2xvYWRfdG9fcmluZ19idWZmZXIoc3RydWN0IGludGVsX3ZncHVfd29y
a2xvYWQgKndvcmtsb2FkKQogCXZvaWQgKnNoYWRvd19yaW5nX2J1ZmZlcl92YTsKIAl1MzIgKmNz
OwogCi0JaWYgKChJU19LQUJZTEFLRShyZXEtPmk5MTUpIHx8IElTX0JST1hUT04ocmVxLT5pOTE1
KQotCQl8fCBJU19DT0ZGRUVMQUtFKHJlcS0+aTkxNSkpCi0JCSYmIGlzX2luaGliaXRfY29udGV4
dChyZXEtPmh3X2NvbnRleHQpKQorCWlmIChJU19HRU4ocmVxLT5pOTE1LCA5KSAmJiBpc19pbmhp
Yml0X2NvbnRleHQocmVxLT5od19jb250ZXh0KSkKIAkJaW50ZWxfdmdwdV9yZXN0b3JlX2luaGli
aXRfY29udGV4dCh2Z3B1LCByZXEpOwogCiAJLyogYWxsb2NhdGUgc2hhZG93IHJpbmcgYnVmZmVy
ICovCi0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCmludGVsLWd2dC1kZXYgbWFpbGluZyBsaXN0CmludGVsLWd2dC1kZXZAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ3Z0LWRldg==
