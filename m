Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 649592B093
	for <lists+intel-gvt-dev@lfdr.de>; Mon, 27 May 2019 10:48:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 22F0089948;
	Mon, 27 May 2019 08:48:50 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9998789948
 for <intel-gvt-dev@lists.freedesktop.org>;
 Mon, 27 May 2019 08:48:48 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 27 May 2019 01:48:48 -0700
X-ExtLoop1: 1
Received: from gvt.bj.intel.com ([10.238.158.187])
 by fmsmga004.fm.intel.com with ESMTP; 27 May 2019 01:48:45 -0700
From: Tina Zhang <tina.zhang@intel.com>
To: 
Subject: [PATCH 2/2] drm/i915/gvt: Support delivering page flip event to
 userspace
Date: Mon, 27 May 2019 16:43:12 +0800
Message-Id: <20190527084312.8872-3-tina.zhang@intel.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190527084312.8872-1-tina.zhang@intel.com>
References: <20190527084312.8872-1-tina.zhang@intel.com>
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: kvm@vger.kernel.org, linux-kernel@vger.kernel.org, zhenyuw@linux.intel.com,
 Tina Zhang <tina.zhang@intel.com>, alex.williamson@redhat.com,
 kraxel@redhat.com, hang.yuan@intel.com, intel-gvt-dev@lists.freedesktop.org,
 zhiyuan.lv@intel.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

VXNlIHRoZSBldmVudGZkIGJhc2VkIHNpZ25hbGluZyBtZWNoYW5pc20gcHJvdmlkZWQgYnkgdmZp
by9kaXNwbGF5CnRvIGRlbGl2ZXIgdkdQVSBmcmFtZWJ1ZmZlciBwYWdlIGZsaXAgZXZlbnQgdG8g
dXNlcnNwYWNlLgoKU2lnbmVkLW9mZi1ieTogVGluYSBaaGFuZyA8dGluYS56aGFuZ0BpbnRlbC5j
b20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2RtYWJ1Zi5jICAgfCAzMSArKysrKysr
KysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2RtYWJ1Zi5o
ICAgfCAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZ3Z0LmMgICAgICB8ICAxICsKIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9ndnQuaCAgICAgIHwgIDIgKysKIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d2dC9oYW5kbGVycy5jIHwgIDIgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9r
dm1ndC5jICAgIHwgIDcgKysrKysrKwogNiBmaWxlcyBjaGFuZ2VkLCA0NCBpbnNlcnRpb25zKCsp
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2RtYWJ1Zi5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L2RtYWJ1Zi5jCmluZGV4IDRlMWU0MjUxODliYS4uZjJlZDQ1NjE2
ZDcyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZG1hYnVmLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2RtYWJ1Zi5jCkBAIC01MzgsNiArNTM4LDM1IEBAIGlu
dCBpbnRlbF92Z3B1X2dldF9kbWFidWYoc3RydWN0IGludGVsX3ZncHUgKnZncHUsIHVuc2lnbmVk
IGludCBkbWFidWZfaWQpCiAJcmV0dXJuIHJldDsKIH0KIAorc3RhdGljIHZvaWQgcmVsZWFzZV9m
bGlwX2V2ZW50ZmRfY3R4KHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQoreworCXN0cnVjdCBldmVu
dGZkX2N0eCAqKnRyaWdnZXIgPSAmdmdwdS0+cGFnZV9mbGlwX3RyaWdnZXI7CisKKwlpZiAoKnRy
aWdnZXIpIHsKKwkJZXZlbnRmZF9jdHhfcHV0KCp0cmlnZ2VyKTsKKwkJKnRyaWdnZXIgPSBOVUxM
OworCX0KK30KKworaW50IGludGVsX3ZncHVfc2V0X2ZsaXBfZXZlbnRmZChzdHJ1Y3QgaW50ZWxf
dmdwdSAqdmdwdSwgaW50IGZkKQoreworCXN0cnVjdCBldmVudGZkX2N0eCAqdHJpZ2dlcjsKKwor
CWlmIChmZCA9PSAtMSkgeworCQlyZWxlYXNlX2ZsaXBfZXZlbnRmZF9jdHgodmdwdSk7CisJfSBl
bHNlIGlmIChmZCA+PSAwKSB7CisJCXRyaWdnZXIgPSBldmVudGZkX2N0eF9mZGdldChmZCk7CisJ
CWlmIChJU19FUlIodHJpZ2dlcikpIHsKKwkJCWd2dF92Z3B1X2VycigiZXZlbnRmZF9jdHhfZmRn
ZXQgZmFpbGVkXG4iKTsKKwkJCXJldHVybiBQVFJfRVJSKHRyaWdnZXIpOworCQl9CisJCXZncHUt
PnBhZ2VfZmxpcF90cmlnZ2VyID0gdHJpZ2dlcjsKKwl9IGVsc2UKKwkJcmV0dXJuIC1FSU5WQUw7
CisKKwlyZXR1cm4gMDsKK30KKwogdm9pZCBpbnRlbF92Z3B1X2RtYWJ1Zl9jbGVhbnVwKHN0cnVj
dCBpbnRlbF92Z3B1ICp2Z3B1KQogewogCXN0cnVjdCBsaXN0X2hlYWQgKnBvcywgKm47CkBAIC01
NjEsNCArNTkwLDYgQEAgdm9pZCBpbnRlbF92Z3B1X2RtYWJ1Zl9jbGVhbnVwKHN0cnVjdCBpbnRl
bF92Z3B1ICp2Z3B1KQogCiAJfQogCW11dGV4X3VubG9jaygmdmdwdS0+ZG1hYnVmX2xvY2spOwor
CisJcmVsZWFzZV9mbGlwX2V2ZW50ZmRfY3R4KHZncHUpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L2RtYWJ1Zi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2Rt
YWJ1Zi5oCmluZGV4IDVmOGYwM2ZiMWQxYi4uNGQ5Y2FhMzczMmQyIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZG1hYnVmLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Z0L2RtYWJ1Zi5oCkBAIC02Miw2ICs2Miw3IEBAIHN0cnVjdCBpbnRlbF92Z3B1X2RtYWJ1Zl9v
YmogewogCiBpbnQgaW50ZWxfdmdwdV9xdWVyeV9wbGFuZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdw
dSwgdm9pZCAqYXJncyk7CiBpbnQgaW50ZWxfdmdwdV9nZXRfZG1hYnVmKHN0cnVjdCBpbnRlbF92
Z3B1ICp2Z3B1LCB1bnNpZ25lZCBpbnQgZG1hYnVmX2lkKTsKK2ludCBpbnRlbF92Z3B1X3NldF9m
bGlwX2V2ZW50ZmQoc3RydWN0IGludGVsX3ZncHUgKnZncHUsIGludCBmZCk7CiB2b2lkIGludGVs
X3ZncHVfZG1hYnVmX2NsZWFudXAoc3RydWN0IGludGVsX3ZncHUgKnZncHUpOwogCiAjZW5kaWYK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9ndnQuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d2dC9ndnQuYwppbmRleCA0M2Y0MjQyMDYyZGQuLjdmZDRhZmE0MzJlZiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d2dC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d2dC9ndnQuYwpAQCAtMTg0LDYgKzE4NCw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1
Y3QgaW50ZWxfZ3Z0X29wcyBpbnRlbF9ndnRfb3BzID0gewogCS5nZXRfZ3Z0X2F0dHJzID0gaW50
ZWxfZ2V0X2d2dF9hdHRycywKIAkudmdwdV9xdWVyeV9wbGFuZSA9IGludGVsX3ZncHVfcXVlcnlf
cGxhbmUsCiAJLnZncHVfZ2V0X2RtYWJ1ZiA9IGludGVsX3ZncHVfZ2V0X2RtYWJ1ZiwKKwkudmdw
dV9zZXRfZmxpcF9ldmVudGZkID0gaW50ZWxfdmdwdV9zZXRfZmxpcF9ldmVudGZkLAogCS53cml0
ZV9wcm90ZWN0X2hhbmRsZXIgPSBpbnRlbF92Z3B1X3BhZ2VfdHJhY2tfaGFuZGxlciwKIAkuZW11
bGF0ZV9ob3RwbHVnID0gaW50ZWxfdmdwdV9lbXVsYXRlX2hvdHBsdWcsCiB9OwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d2dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Z0L2d2dC5oCmluZGV4IGY1YTMyOGI1MjkwYS4uODZjYTIyM2Y5YTYwIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZ3Z0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Z0L2d2dC5oCkBAIC0yMjksNiArMjI5LDcgQEAgc3RydWN0IGludGVsX3ZncHUgewogCXN0cnVj
dCBjb21wbGV0aW9uIHZibGFua19kb25lOwogCiAJdTMyIHNjYW5fbm9ucHJpdmJiOworCXN0cnVj
dCBldmVudGZkX2N0eCAqcGFnZV9mbGlwX3RyaWdnZXI7CiB9OwogCiAvKiB2YWxpZGF0aW5nIEdN
IGhlYWx0aHkgc3RhdHVzKi8KQEAgLTU3MCw2ICs1NzEsNyBAQCBzdHJ1Y3QgaW50ZWxfZ3Z0X29w
cyB7CiAJCQlzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwICoqKmludGVsX3ZncHVfdHlwZV9ncm91cHMp
OwogCWludCAoKnZncHVfcXVlcnlfcGxhbmUpKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCB2b2lk
ICopOwogCWludCAoKnZncHVfZ2V0X2RtYWJ1Zikoc3RydWN0IGludGVsX3ZncHUgKnZncHUsIHVu
c2lnbmVkIGludCk7CisJaW50ICgqdmdwdV9zZXRfZmxpcF9ldmVudGZkKShzdHJ1Y3QgaW50ZWxf
dmdwdSAqdmdwdSwgaW50IGZkKTsKIAlpbnQgKCp3cml0ZV9wcm90ZWN0X2hhbmRsZXIpKHN0cnVj
dCBpbnRlbF92Z3B1ICosIHU2NCwgdm9pZCAqLAogCQkJCSAgICAgdW5zaWduZWQgaW50KTsKIAl2
b2lkICgqZW11bGF0ZV9ob3RwbHVnKShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgYm9vbCBjb25u
ZWN0ZWQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2hhbmRsZXJzLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvaGFuZGxlcnMuYwppbmRleCAxOGYwMWVlYjI1MTAu
LjFiNTQ1NTg4OGJkZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2hhbmRs
ZXJzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2hhbmRsZXJzLmMKQEAgLTc2Myw2
ICs3NjMsOCBAQCBzdGF0aWMgaW50IHByaV9zdXJmX21taW9fd3JpdGUoc3RydWN0IGludGVsX3Zn
cHUgKnZncHUsIHVuc2lnbmVkIGludCBvZmZzZXQsCiAJZWxzZQogCQlzZXRfYml0KGV2ZW50LCB2
Z3B1LT5pcnEuZmxpcF9kb25lX2V2ZW50W3BpcGVdKTsKIAorCWV2ZW50ZmRfc2lnbmFsKHZncHUt
PnBhZ2VfZmxpcF90cmlnZ2VyLCAxKTsKKwogCXJldHVybiAwOwogfQogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQva3ZtZ3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2
dC9rdm1ndC5jCmluZGV4IGE2OGFkZGY5NWMyMy4uMDBjNzViZDc2YmMwIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQva3ZtZ3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndnQva3ZtZ3QuYwpAQCAtMTU0Nyw2ICsxNTQ3LDEzIEBAIHN0YXRpYyBsb25nIGludGVsX3Zn
cHVfaW9jdGwoc3RydWN0IG1kZXZfZGV2aWNlICptZGV2LCB1bnNpZ25lZCBpbnQgY21kLAogCQlk
bWFidWZfZmQgPSBpbnRlbF9ndnRfb3BzLT52Z3B1X2dldF9kbWFidWYodmdwdSwgZG1hYnVmX2lk
KTsKIAkJcmV0dXJuIGRtYWJ1Zl9mZDsKIAorCX0gZWxzZSBpZiAoY21kID09IFZGSU9fREVWSUNF
X1NFVF9HRlhfRkxJUF9FVkVOVEZEKSB7CisJCV9fczMyIGV2ZW50X2ZkOworCisJCWlmIChnZXRf
dXNlcihldmVudF9mZCwgKF9fczMyIF9fdXNlciAqKWFyZykpCisJCQlyZXR1cm4gLUVGQVVMVDsK
KworCQlyZXR1cm4gaW50ZWxfZ3Z0X29wcy0+dmdwdV9zZXRfZmxpcF9ldmVudGZkKHZncHUsIGV2
ZW50X2ZkKTsKIAl9CiAKIAlyZXR1cm4gLUVOT1RUWTsKLS0gCjIuMTcuMQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KaW50ZWwtZ3Z0LWRldiBtYWlsaW5n
IGxpc3QKaW50ZWwtZ3Z0LWRldkBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1ndnQtZGV2
