Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 65FAD70F65
	for <lists+intel-gvt-dev@lfdr.de>; Tue, 23 Jul 2019 04:57:40 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 087EC89E4C;
	Tue, 23 Jul 2019 02:57:39 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5A31089E69;
 Tue, 23 Jul 2019 02:57:38 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 Jul 2019 19:57:38 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,297,1559545200"; d="scan'208";a="171040473"
Received: from vca-bj102.bj.intel.com ([10.240.193.76])
 by fmsmga007.fm.intel.com with ESMTP; 22 Jul 2019 19:57:36 -0700
From: Xiaolin Zhang <xiaolin.zhang@intel.com>
To: intel-gvt-dev@lists.freedesktop.org,
	intel-gfx@lists.freedesktop.org
Subject: [PATCH v8 4/9] drm/i915: vgpu ppgtt update pv optimization
Date: Tue, 23 Jul 2019 19:31:59 +0800
Message-Id: <1563881524-147440-5-git-send-email-xiaolin.zhang@intel.com>
X-Mailer: git-send-email 1.8.3.1
In-Reply-To: <1563881524-147440-1-git-send-email-xiaolin.zhang@intel.com>
References: <1563881524-147440-1-git-send-email-xiaolin.zhang@intel.com>
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: Xiaolin Zhang <xiaolin.zhang@intel.com>, zhenyu.z.wang@intel.com,
 joonas.lahtinen@linux.intel.com, hang.yuan@intel.com, min.he@intel.com,
 zhiyuan.lv@intel.com, chris@chris-wilson.co.uk, zhi.a.wang@intel.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBleHRlbmRzIHZncHUgcHBndHQgZzJ2IG5vdGlmaWNhdGlvbiB0byBub3RpZnkg
aG9zdApHVlQtZyBvZiBwcGd0dCB1cGRhdGUgZnJvbSBndWVzdCBpbmNsdWRpbmcgYWxsb2NfNGx2
bCwgY2xlYXJfNGx2NAphbmQgaW5zZXJ0XzRsdmwuCgpUaGVzZSB1cGRhdGVzIHVzZSB0aGUgc2hh
cmVkIG1lbW9yeSBwYWdlIHRvIHBhc3Mgc3RydWN0IHB2X3BwZ3R0X3VwZGF0ZQpmcm9tIGd1ZXN0
IHRvIEdWVCB3aGljaCBpcyB1c2VkIGZvciBwdiBvcHRpbWlhdGlvbiBpbXBsZW1lYXRpb24gd2l0
aGluCmhvc3QgR1ZUIHNpZGUuCgpUaGlzIHBhdGNoIGFsc28gYWRkIG9uZSBuZXcgcHZfY2FwcyBs
ZXZlbCB0byBjb250cm9sIHBwZ3R0IHVwZGF0ZS4KClVzZSBQVl9QUEdUVF9VUERBVEUgdG8gY29u
dHJvbCB0aGlzIGxldmVsIG9mIHB2IG9wdGltaXphdGlvbi4KCnYwOiBSRkMuCnYxOiByZWJhc2Vk
Lgp2MjogYWRkZWQgcHYgY2FsbGJhY2tzIGZvciB2bS57YWxsb2NhdGVfdmFfcmFuZ2UsIGluc2Vy
dF9lbnRyaWVzLApjbGVhcl9yYW5nZX0gd2l0aGluIHBwZ3R0Lgp2MzogcmViYXNlZCwgZGlzYWJs
ZSBodWdlIHBhZ2UgcHBndHQgc3VwcG9ydCB3aGVuIHVzaW5nIFBWTU1JTyBwcGd0dAp1cGRhdGUg
ZHVlIHRvIGNvbXBsZXggYW5kIHBlcmZvcm1hbmNlIGltcGFjdC4KdjQ6IG1vdmVkIGFsbG9jL2lu
c2VydC9jbGVhcl80bHZsIHB2IGNhbGxiYWNrcyBpbnRvIGk5MTVfdmdwdV9wdi5jIGFuZAphZGRl
ZCBhIHNpbmdsZSBpbnRlbF92Z3B1X2NvbmZpZ19wdl9jYXBzKCkgZm9yIHZncHUgcHYgY2FsbGJh
Y2tzIHNldHVwLgp2NTogcmViYXNlLgp2NjogcmViYXNlLgp2NzogcmViYXNlLgoKU2lnbmVkLW9m
Zi1ieTogWGlhb2xpbiBaaGFuZyA8eGlhb2xpbi56aGFuZ0BpbnRlbC5jb20+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAgICAgfCAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZ3R0LmMgfCAxMCArKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZ3R0LmggfCAgOCArKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZncHUuYyAgICB8
IDc5ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfdmdwdS5oICAgIHwgMjUgKysrKysrKysrKysrCiA1IGZpbGVzIGNoYW5nZWQs
IDEyMCBpbnNlcnRpb25zKCspLCA1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
CmluZGV4IGM2YmEzNTAuLjk1NzFmZDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMTQx
OSw3ICsxNDE5LDggQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCWludCByZXQ7CiAKIAkvKiBXZSBuZWVkIHRvIGZhbGxiYWNrIHRvIDRLIHBh
Z2VzIGlmIGhvc3QgZG9lc24ndCBzdXBwb3J0IGh1Z2UgZ3R0LiAqLwotCWlmIChpbnRlbF92Z3B1
X2FjdGl2ZShkZXZfcHJpdikgJiYgIWludGVsX3ZncHVfaGFzX2h1Z2VfZ3R0KGRldl9wcml2KSkK
KwlpZiAoKGludGVsX3ZncHVfYWN0aXZlKGRldl9wcml2KSAmJiAhaW50ZWxfdmdwdV9oYXNfaHVn
ZV9ndHQoZGV2X3ByaXYpKQorCQl8fCBpbnRlbF92Z3B1X2VuYWJsZWRfcHZfY2FwcyhkZXZfcHJp
diwgUFZfUFBHVFRfVVBEQVRFKSkKIAkJbWt3cml0ZV9kZXZpY2VfaW5mbyhkZXZfcHJpdiktPnBh
Z2Vfc2l6ZXMgPQogCQkJSTkxNV9HVFRfUEFHRV9TSVpFXzRLOwogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jCmluZGV4IDRkZDFmYTkuLjY2N2E4ZWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jCkBAIC05OTcsNyArOTk3LDcgQEAgc3RhdGljIHU2NCBfX2dlbjhfcHBndHRf
Y2xlYXIoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqIGNvbnN0IHZtLAogCXJldHVybiBzdGFy
dDsKIH0KIAotc3RhdGljIHZvaWQgZ2VuOF9wcGd0dF9jbGVhcihzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bSwKK3ZvaWQgZ2VuOF9wcGd0dF9jbGVhcihzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSwKIAkJCSAgICAgdTY0IHN0YXJ0LCB1NjQgbGVuZ3RoKQogewogCUdFTV9CVUdfT04o
IUlTX0FMSUdORUQoc3RhcnQsIEJJVF9VTEwoR0VOOF9QVEVfU0hJRlQpKSk7CkBAIC0xMTA0LDcg
KzExMDQsNyBAQCBzdGF0aWMgaW50IF9fZ2VuOF9wcGd0dF9hbGxvYyhzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICogY29uc3Qgdm0sCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIGludCBnZW44
X3BwZ3R0X2FsbG9jKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAoraW50IGdlbjhfcHBn
dHRfYWxsb2Moc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCQkgICAgdTY0IHN0YXJ0
LCB1NjQgbGVuZ3RoKQogewogCXU2NCBmcm9tOwpAQCAtMTMxNyw3ICsxMzE3LDcgQEAgc3RhdGlj
IHZvaWQgZ2VuOF9wcGd0dF9pbnNlcnRfaHVnZV9lbnRyaWVzKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
LAogCX0gd2hpbGUgKGl0ZXItPnNnKTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuOF9wcGd0dF9pbnNl
cnRfNGx2bChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKK3ZvaWQgZ2VuOF9wcGd0dF9p
bnNlcnRfNGx2bChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCQkgICBzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSwKIAkJCQkgICBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWws
CiAJCQkJICAgdTMyIGZsYWdzKQpAQCAtMTUxMCw4ICsxNTEwLDEwIEBAIHN0YXRpYyBzdHJ1Y3Qg
aTkxNV9wcGd0dCAqZ2VuOF9wcGd0dF9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiAJcHBndHQtPnZtLmFsbG9jYXRlX3ZhX3JhbmdlID0gZ2VuOF9wcGd0dF9hbGxvYzsKIAlw
cGd0dC0+dm0uY2xlYXJfcmFuZ2UgPSBnZW44X3BwZ3R0X2NsZWFyOwogCi0JaWYgKGludGVsX3Zn
cHVfYWN0aXZlKGk5MTUpKQorCWlmIChpbnRlbF92Z3B1X2FjdGl2ZShpOTE1KSkgeworCQlpbnRl
bF92Z3B1X2NvbmZpZ19wdl9jYXBzKGk5MTUsIFBWX1BQR1RUX1VQREFURSwgcHBndHQpOwogCQln
ZW44X3BwZ3R0X25vdGlmeV92Z3QocHBndHQsIHRydWUpOworCX0KIAogCXBwZ3R0LT52bS5jbGVh
bnVwID0gZ2VuOF9wcGd0dF9jbGVhbnVwOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5o
CmluZGV4IGNlYTU5ZWYuLmI0ZjQ3MTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtX2d0dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5o
CkBAIC01NzgsNiArNTc4LDE0IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X3ZtX3B1dChzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIHZvaWQgZ2VuNl9wcGd0dF91bnBpbihzdHJ1Y3Qg
aTkxNV9wcGd0dCAqYmFzZSk7CiB2b2lkIGdlbjZfcHBndHRfdW5waW5fYWxsKHN0cnVjdCBpOTE1
X3BwZ3R0ICpiYXNlKTsKIAordm9pZCBnZW44X3BwZ3R0X2NsZWFyKHN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtLAorCQl1NjQgc3RhcnQsIHU2NCBsZW5ndGgpOwordm9pZCBnZW44X3BwZ3R0
X2luc2VydF80bHZsKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAorCQlzdHJ1Y3QgaTkx
NV92bWEgKnZtYSwKKwkJZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLCB1MzIgZmxh
Z3MpOworaW50IGdlbjhfcHBndHRfYWxsb2Moc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0s
CisJCXU2NCBzdGFydCwgdTY0IGxlbmd0aCk7CisKIHZvaWQgaTkxNV9nZW1fc3VzcGVuZF9ndHRf
bWFwcGluZ3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQgaTkxNV9n
ZW1fcmVzdG9yZV9ndHRfbWFwcGluZ3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92Z3B1LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZncHUuYwppbmRleCAxMjRhMDcwLi4xZmEzMGRmIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZncHUuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3ZncHUuYwpAQCAtOTYsNiArOTYsOSBAQCB2b2lkIGk5MTVfZGV0ZWN0
X3ZncHUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAJZGV2X3ByaXYtPnZn
cHUuYWN0aXZlID0gdHJ1ZTsKIAorCS8qIGd1ZXN0IGRyaXZlciBQViBjYXBhYmlsaXR5ICovCisJ
ZGV2X3ByaXYtPnZncHUucHZfY2FwcyA9IFBWX1BQR1RUX1VQREFURTsKKwogCWlmICghaW50ZWxf
dmdwdV9jaGVja19wdl9jYXBzKGRldl9wcml2LCBzaGFyZWRfYXJlYSkpIHsKIAkJRFJNX0lORk8o
IlZpcnR1YWwgR1BVIGZvciBJbnRlbCBHVlQtZyBkZXRlY3RlZC5cbiIpOwogCQlyZXR1cm47CkBA
IC0zMTMsNiArMzE2LDgyIEBAIGludCBpbnRlbF92Z3RfYmFsbG9vbihzdHJ1Y3QgaTkxNV9nZ3R0
ICpnZ3R0KQogICogaTkxNSB2Z3B1IFBWIHN1cHBvcnQgZm9yIExpbnV4CiAgKi8KIAorc3RhdGlj
IGludCB2Z3B1X3BwZ3R0X3B2X3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCisJCXUzMiBhY3Rpb24sIHU2NCBwZHAsIHU2NCBzdGFydCwgdTY0IGxlbmd0aCwgdTMyIGNh
Y2hlX2xldmVsKQoreworCXUzMiBkYXRhWzhdOworCisJZGF0YVswXSA9IGFjdGlvbjsKKwlkYXRh
WzFdID0gbG93ZXJfMzJfYml0cyhwZHApOworCWRhdGFbMl0gPSB1cHBlcl8zMl9iaXRzKHBkcCk7
CisJZGF0YVszXSA9IGxvd2VyXzMyX2JpdHMoc3RhcnQpOworCWRhdGFbNF0gPSB1cHBlcl8zMl9i
aXRzKHN0YXJ0KTsKKwlkYXRhWzVdID0gbG93ZXJfMzJfYml0cyhsZW5ndGgpOworCWRhdGFbNl0g
PSB1cHBlcl8zMl9iaXRzKGxlbmd0aCk7CisJZGF0YVs3XSA9IGNhY2hlX2xldmVsOworCisJcmV0
dXJuIGludGVsX3ZncHVfcHZfc2VuZChkZXZfcHJpdiwgZGF0YSwgQVJSQVlfU0laRShkYXRhKSk7
Cit9CisKK3N0YXRpYyB2b2lkIGdlbjhfcHBndHRfY2xlYXJfNGx2bF9wdihzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSwKKwkJdTY0IHN0YXJ0LCB1NjQgbGVuZ3RoKQoreworCXN0cnVjdCBp
OTE1X3BwZ3R0ICpwcGd0dCA9IGk5MTVfdm1fdG9fcHBndHQodm0pOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHZtLT5pOTE1OworCisJZ2VuOF9wcGd0dF9jbGVhcih2bSwg
c3RhcnQsIGxlbmd0aCk7CisJdmdwdV9wcGd0dF9wdl91cGRhdGUoZGV2X3ByaXYsIFBWX0FDVElP
Tl9QUEdUVF9MNF9DTEVBUiwKKwkJcHhfZG1hKHBwZ3R0LT5wZCksIHN0YXJ0LCBsZW5ndGgsIDAp
OworfQorCitzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2luc2VydF80bHZsX3B2KHN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtLAorCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkJZW51bSBpOTE1
X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLCB1MzIgZmxhZ3MpCit7CisJc3RydWN0IGk5MTVfcHBn
dHQgKnBwZ3R0ID0gaTkxNV92bV90b19wcGd0dCh2bSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdm0tPmk5MTU7CisJdTY0IHN0YXJ0ID0gdm1hLT5ub2RlLnN0YXJ0Owor
CXU2NCBsZW5ndGggPSB2bWEtPm5vZGUuc2l6ZTsKKworCWdlbjhfcHBndHRfaW5zZXJ0XzRsdmwo
dm0sIHZtYSwgY2FjaGVfbGV2ZWwsIGZsYWdzKTsKKwl2Z3B1X3BwZ3R0X3B2X3VwZGF0ZShkZXZf
cHJpdiwgUFZfQUNUSU9OX1BQR1RUX0w0X0lOU0VSVCwKKwkJcHhfZG1hKHBwZ3R0LT5wZCksIHN0
YXJ0LCBsZW5ndGgsIGNhY2hlX2xldmVsKTsKK30KKworc3RhdGljIGludCBnZW44X3BwZ3R0X2Fs
bG9jXzRsdmxfcHYoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCisJCXU2NCBzdGFydCwg
dTY0IGxlbmd0aCkKK3sKKwlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQgPSBpOTE1X3ZtX3RvX3Bw
Z3R0KHZtKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2bS0+aTkxNTsK
KwlpbnQgcmV0OworCisJcmV0ID0gZ2VuOF9wcGd0dF9hbGxvYyh2bSwgc3RhcnQsIGxlbmd0aCk7
CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldHVybiB2Z3B1X3BwZ3R0X3B2X3VwZGF0
ZShkZXZfcHJpdiwgUFZfQUNUSU9OX1BQR1RUX0w0X0FMTE9DLAorCQlweF9kbWEocHBndHQtPnBk
KSwgc3RhcnQsIGxlbmd0aCwgMCk7Cit9CisKKy8qCisgKiBjb25maWcgZ3Vlc3QgZHJpdmVyIFBW
IG9wcyBmb3IgZGlmZmVyZW50IFBWIGZlYXR1cmVzCisgKi8KK3ZvaWQgaW50ZWxfdmdwdV9jb25m
aWdfcHZfY2FwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCWVudW0gcHZf
Y2FwcyBjYXAsIHZvaWQgKmRhdGEpCit7CisJc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0OworCisJ
aWYgKCFpbnRlbF92Z3B1X2VuYWJsZWRfcHZfY2FwcyhkZXZfcHJpdiwgY2FwKSkKKwkJcmV0dXJu
OworCisJaWYgKGNhcCA9PSBQVl9QUEdUVF9VUERBVEUpIHsKKwkJcHBndHQgPSAoc3RydWN0IGk5
MTVfcHBndHQgKilkYXRhOworCQlwcGd0dC0+dm0uYWxsb2NhdGVfdmFfcmFuZ2UgPSBnZW44X3Bw
Z3R0X2FsbG9jXzRsdmxfcHY7CisJCXBwZ3R0LT52bS5pbnNlcnRfZW50cmllcyA9IGdlbjhfcHBn
dHRfaW5zZXJ0XzRsdmxfcHY7CisJCXBwZ3R0LT52bS5jbGVhcl9yYW5nZSA9IGdlbjhfcHBndHRf
Y2xlYXJfNGx2bF9wdjsKKwl9Cit9CisKIC8qKgogICogd2FpdF9mb3JfZGVzY191cGRhdGUgLSBX
YWl0IGZvciB0aGUgY29tbWFuZCBidWZmZXIgZGVzY3JpcHRvciB1cGRhdGUuCiAgKiBAZGVzYzoJ
YnVmZmVyIGRlc2NyaXB0b3IKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
dmdwdS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92Z3B1LmgKaW5kZXggMjRjNDliNy4u
OTJjODRkMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92Z3B1LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92Z3B1LmgKQEAgLTMzLDYgKzMzLDIxIEBACiAj
ZGVmaW5lIFBWX0NNRF9PRkYJCShQQUdFX1NJWkUvMikKIAogLyoKKyAqIGRlZmluZSBkaWZmZXJl
bnQgY2FwYWJpbGl0aWVzIG9mIFBWIG9wdGltaXphdGlvbgorICovCitlbnVtIHB2X2NhcHMgewor
CVBWX1BQR1RUX1VQREFURSA9IDB4MSwKK307CisKKy8qIFBWIGFjdGlvbnMgKi8KK2VudW0gaW50
ZWxfdmdwdV9wdl9hY3Rpb24geworCVBWX0FDVElPTl9ERUZBVUxUID0gMHgwLAorCVBWX0FDVElP
Tl9QUEdUVF9MNF9BTExPQywKKwlQVl9BQ1RJT05fUFBHVFRfTDRfQ0xFQVIsCisJUFZfQUNUSU9O
X1BQR1RUX0w0X0lOU0VSVCwKK307CisKKy8qCiAgKiBBIHNoYXJlZCBwYWdlKDRLQikgYmV0d2Vl
biBndnQgYW5kIFZNLCBjb3VsZCBiZSBhbGxvY2F0ZWQgYnkgZ3Vlc3QgZHJpdmVyCiAgKiBvciBh
IGZpeGVkIGxvY2F0aW9uIGluIFBDSSBiYXIgMCByZWdpb24KICAqLwpAQCAtMTE5LDYgKzEzNCwx
NCBAQCBzdHJ1Y3QgaTkxNV92aXJ0dWFsX2dwdV9wdiB7CiAJcmV0dXJuIGRldl9wcml2LT52Z3B1
LmNhcHMgJiBWR1RfQ0FQU19QVjsKIH0KIAorc3RhdGljIGlubGluZSBib29sCitpbnRlbF92Z3B1
X2VuYWJsZWRfcHZfY2FwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCWVu
dW0gcHZfY2FwcyBjYXApCit7CisJcmV0dXJuIChkZXZfcHJpdi0+dmdwdS5hY3RpdmUpICYmIGlu
dGVsX3ZncHVfaGFzX3B2X2NhcHMoZGV2X3ByaXYpCisJCQkmJiAoZGV2X3ByaXYtPnZncHUucHZf
Y2FwcyAmIGNhcCk7Cit9CisKIHN0YXRpYyBpbmxpbmUgdm9pZAogaW50ZWxfdmdwdV9wdl9ub3Rp
Znkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewpAQCAtMTM4LDQgKzE2MSw2
IEBAIHN0cnVjdCBpOTE1X3ZpcnR1YWxfZ3B1X3B2IHsKIC8qIGk5MTUgdmdwdSBwdiByZWxhdGVk
IGZ1bmN0aW9ucyAqLwogYm9vbCBpbnRlbF92Z3B1X2NoZWNrX3B2X2NhcHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQl2b2lkIF9faW9tZW0gKnNoYXJlZF9hcmVhKTsKK3Zv
aWQgaW50ZWxfdmdwdV9jb25maWdfcHZfY2FwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCisJCWVudW0gcHZfY2FwcyBjYXAsIHZvaWQgKmRhdGEpOwogI2VuZGlmIC8qIF9JOTE1
X1ZHUFVfSF8gKi8KLS0gCjEuOC4zLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCmludGVsLWd2dC1kZXYgbWFpbGluZyBsaXN0CmludGVsLWd2dC1kZXZA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vaW50ZWwtZ3Z0LWRldg==
