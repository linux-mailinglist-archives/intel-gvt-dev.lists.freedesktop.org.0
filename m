Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 76A64DAAA
	for <lists+intel-gvt-dev@lfdr.de>; Mon, 29 Apr 2019 05:11:49 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2A5D88914A;
	Mon, 29 Apr 2019 03:11:48 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 03A7189150;
 Mon, 29 Apr 2019 03:11:45 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 28 Apr 2019 20:11:45 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.60,408,1549958400"; d="scan'208";a="146648254"
Received: from xzhan34-mobl3.bj.intel.com ([10.238.154.121])
 by fmsmga007.fm.intel.com with ESMTP; 28 Apr 2019 20:11:42 -0700
From: Xiaolin Zhang <xiaolin.zhang@intel.com>
To: intel-gvt-dev@lists.freedesktop.org,
	intel-gfx@lists.freedesktop.org
Subject: [PATCH v5 6/8] drm/i915/gvt: GVTg handle shared_page setup
Date: Mon, 29 Apr 2019 11:10:56 +0800
Message-Id: <1556507458-24684-7-git-send-email-xiaolin.zhang@intel.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1556507458-24684-1-git-send-email-xiaolin.zhang@intel.com>
References: <1556507458-24684-1-git-send-email-xiaolin.zhang@intel.com>
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: Xiaolin Zhang <xiaolin.zhang@intel.com>, zhenyu.z.wang@intel.com,
 joonas.lahtinen@linux.intel.com, hang.yuan@intel.com, min.he@intel.com,
 zhiyuan.lv@intel.com, chris@chris-wilson.co.uk, zhi.a.wang@intel.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

R1ZUZyBpbXBsZW1lbnRlZCBzaGFyZWRfcGFnZSBzZXR1cCBvcGVyYXRpb24gYW5kIHJlYWRfc2hh
cmVkX3BhZ2UKZnVuY3Rpb25hbGl0eSBiYXNlZCBvbiBoeXBlcnZpc29yX3JlYWRfZ3BhKCkuCgp0
aGUgc2hhcmVkX3BhZ2VfZ3BhIHdhcyBwYXNzZWQgZnJvbSBndWVzdCBkcml2ZXIgdGhyb3VnaCBQ
VklORk8Kc2hhcmVkX3BhZ2VfZ3BhIHJlZ2lzdGVyLgoKdjA6IFJGQwp2MTogcmViYXNlCnYyOiBy
ZWJhc2UKdjM6IGFkZGVkIHNoYXJlZF9wYWdlX2dwYSBjaGVjayBhbmQgaWYgcmVhZF9ncGEgZmFp
bHVyZSwgcmV0dXJuIHplcm8KbWVtb3J5IGFuZCBoYW5kbGUgVkdUX0cyVl9TSEFSRURfUEFHRV9T
RVRVUCBnMnYgbm90aWZpY2F0aW9uCnY0OiByZWJhc2UKdjU6IHJlYmFzZQoKU2lnbmVkLW9mZi1i
eTogWGlhb2xpbiBaaGFuZyA8eGlhb2xpbi56aGFuZ0BpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Z0L2d2dC5oICAgICAgfCAgNiArKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d2dC9oYW5kbGVycy5jIHwgMTUgKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndnQvdmdwdS5jICAgICB8IDI0ICsrKysrKysrKysrKysrKysrKysrKysrKwogMyBmaWxl
cyBjaGFuZ2VkLCA0NCBpbnNlcnRpb25zKCspLCAxIGRlbGV0aW9uKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d2dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L2d2dC5oCmluZGV4IGY1YTMyOGIuLjZkYmUzMGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d2dC9ndnQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZ3Z0LmgKQEAg
LTQ5LDYgKzQ5LDcgQEAKICNpbmNsdWRlICJmYl9kZWNvZGVyLmgiCiAjaW5jbHVkZSAiZG1hYnVm
LmgiCiAjaW5jbHVkZSAicGFnZV90cmFjay5oIgorI2luY2x1ZGUgImk5MTVfdmdwdS5oIgogCiAj
ZGVmaW5lIEdWVF9NQVhfVkdQVSA4CiAKQEAgLTIyOSw2ICsyMzAsOCBAQCBzdHJ1Y3QgaW50ZWxf
dmdwdSB7CiAJc3RydWN0IGNvbXBsZXRpb24gdmJsYW5rX2RvbmU7CiAKIAl1MzIgc2Nhbl9ub25w
cml2YmI7CisJdTY0IHNoYXJlZF9wYWdlX2dwYTsKKwlib29sIHNoYXJlZF9wYWdlX2VuYWJsZWQ7
CiB9OwogCiAvKiB2YWxpZGF0aW5nIEdNIGhlYWx0aHkgc3RhdHVzKi8KQEAgLTY4Niw3ICs2ODks
OCBAQCBpbnQgaW50ZWxfZ3Z0X2RlYnVnZnNfYWRkX3ZncHUoc3RydWN0IGludGVsX3ZncHUgKnZn
cHUpOwogdm9pZCBpbnRlbF9ndnRfZGVidWdmc19yZW1vdmVfdmdwdShzdHJ1Y3QgaW50ZWxfdmdw
dSAqdmdwdSk7CiBpbnQgaW50ZWxfZ3Z0X2RlYnVnZnNfaW5pdChzdHJ1Y3QgaW50ZWxfZ3Z0ICpn
dnQpOwogdm9pZCBpbnRlbF9ndnRfZGVidWdmc19jbGVhbihzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQp
OwotCitpbnQgaW50ZWxfZ3Z0X3JlYWRfc2hhcmVkX3BhZ2Uoc3RydWN0IGludGVsX3ZncHUgKnZn
cHUsCisJCXVuc2lnbmVkIGludCBvZmZzZXQsIHZvaWQgKmJ1ZiwgdW5zaWduZWQgbG9uZyBsZW4p
OwogCiAjaW5jbHVkZSAidHJhY2UuaCIKICNpbmNsdWRlICJtcHQuaCIKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9oYW5kbGVycy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Z0L2hhbmRsZXJzLmMKaW5kZXggZjdlY2Q0ZS4uM2Y5NDI2MyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L2hhbmRsZXJzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Z0L2hhbmRsZXJzLmMKQEAgLTExOTMsNiArMTE5Myw4IEBAIHN0YXRpYyBpbnQgcHZpbmZvX21t
aW9fcmVhZChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdW5zaWduZWQgaW50IG9mZnNldCwKIAlj
YXNlIDB4NzgwMTA6CS8qIHZndF9jYXBzICovCiAJY2FzZSAweDc4ODFjOgogCWNhc2UgX3ZndGlm
X3JlZyhwdl9jYXBzKToKKwljYXNlIF92Z3RpZl9yZWcoc2hhcmVkX3BhZ2VfZ3BhKToKKwljYXNl
IF92Z3RpZl9yZWcoc2hhcmVkX3BhZ2VfZ3BhKSArIDQ6CiAJCWJyZWFrOwogCWRlZmF1bHQ6CiAJ
CWludmFsaWRfcmVhZCA9IHRydWU7CkBAIC0xMjEwLDYgKzEyMTIsNyBAQCBzdGF0aWMgaW50IGhh
bmRsZV9nMnZfbm90aWZpY2F0aW9uKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCBpbnQgbm90aWZp
Y2F0aW9uKQogCWludGVsX2d2dF9ndHRfdHlwZV90IHJvb3RfZW50cnlfdHlwZSA9IEdUVF9UWVBF
X1BQR1RUX1JPT1RfTDRfRU5UUlk7CiAJc3RydWN0IGludGVsX3ZncHVfbW0gKm1tOwogCXU2NCAq
cGRwczsKKwl1bnNpZ25lZCBsb25nIGdwYSwgZ2ZuOwogCiAJcGRwcyA9ICh1NjQgKikmdmdwdV92
cmVnNjRfdCh2Z3B1LCB2Z3RpZl9yZWcocGRwWzBdKSk7CiAKQEAgLTEyMjMsNiArMTIyNiwxNiBA
QCBzdGF0aWMgaW50IGhhbmRsZV9nMnZfbm90aWZpY2F0aW9uKHN0cnVjdCBpbnRlbF92Z3B1ICp2
Z3B1LCBpbnQgbm90aWZpY2F0aW9uKQogCWNhc2UgVkdUX0cyVl9QUEdUVF9MM19QQUdFX1RBQkxF
X0RFU1RST1k6CiAJY2FzZSBWR1RfRzJWX1BQR1RUX0w0X1BBR0VfVEFCTEVfREVTVFJPWToKIAkJ
cmV0dXJuIGludGVsX3ZncHVfcHV0X3BwZ3R0X21tKHZncHUsIHBkcHMpOworCWNhc2UgVkdUX0cy
Vl9TSEFSRURfUEFHRV9TRVRVUDoKKwkJZ3BhID0gdmdwdV92cmVnNjRfdCh2Z3B1LCB2Z3RpZl9y
ZWcoc2hhcmVkX3BhZ2VfZ3BhKSk7CisJCWdmbiA9IGdwYSA+PiBQQUdFX1NISUZUOworCQlpZiAo
IWludGVsX2d2dF9oeXBlcnZpc29yX2lzX3ZhbGlkX2dmbih2Z3B1LCBnZm4pKSB7CisJCQl2Z3B1
X3ZyZWdfdCh2Z3B1LCB2Z3RpZl9yZWcocHZfY2FwcykpID0gMDsKKwkJCXJldHVybiAwOworCQl9
CisJCXZncHUtPnNoYXJlZF9wYWdlX2dwYSA9IGdwYTsKKwkJdmdwdS0+c2hhcmVkX3BhZ2VfZW5h
YmxlZCA9IHRydWU7CisJCWJyZWFrOwogCWNhc2UgVkdUX0cyVl9FWEVDTElTVF9DT05URVhUX0NS
RUFURToKIAljYXNlIFZHVF9HMlZfRVhFQ0xJU1RfQ09OVEVYVF9ERVNUUk9ZOgogCWNhc2UgMToJ
LyogUmVtb3ZlIHRoaXMgaW4gZ3Vlc3QgZHJpdmVyLiAqLwpAQCAtMTI4Miw2ICsxMjk1LDggQEAg
c3RhdGljIGludCBwdmluZm9fbW1pb193cml0ZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdW5z
aWduZWQgaW50IG9mZnNldCwKIAljYXNlIF92Z3RpZl9yZWcocGRwWzNdLmhpKToKIAljYXNlIF92
Z3RpZl9yZWcoZXhlY2xpc3RfY29udGV4dF9kZXNjcmlwdG9yX2xvKToKIAljYXNlIF92Z3RpZl9y
ZWcoZXhlY2xpc3RfY29udGV4dF9kZXNjcmlwdG9yX2hpKToKKwljYXNlIF92Z3RpZl9yZWcoc2hh
cmVkX3BhZ2VfZ3BhKToKKwljYXNlIF92Z3RpZl9yZWcoc2hhcmVkX3BhZ2VfZ3BhKSArIDQ6CiAJ
CWJyZWFrOwogCWNhc2UgX3ZndGlmX3JlZyhyc3Y1WzBdKS4uLl92Z3RpZl9yZWcocnN2NVszXSk6
CiAJCWVudGVyX2ZhaWxzYWZlX21vZGUodmdwdSwgR1ZUX0ZBSUxTQUZFX0lOU1VGRklDSUVOVF9S
RVNPVVJDRSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvdmdwdS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3ZncHUuYwppbmRleCAzZWNjNDVhLi4wNjYzYjNlIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvdmdwdS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d2dC92Z3B1LmMKQEAgLTYzLDYgKzYzLDggQEAgdm9pZCBwb3B1bGF0ZV9w
dmluZm9fcGFnZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAl2Z3B1X3ZyZWdfdCh2Z3B1LCB2
Z3RpZl9yZWcoY3Vyc29yX3hfaG90KSkgPSBVSU5UX01BWDsKIAl2Z3B1X3ZyZWdfdCh2Z3B1LCB2
Z3RpZl9yZWcoY3Vyc29yX3lfaG90KSkgPSBVSU5UX01BWDsKIAorCXZncHVfdnJlZzY0X3Qodmdw
dSwgdmd0aWZfcmVnKHNoYXJlZF9wYWdlX2dwYSkpID0gMDsKKwogCWd2dF9kYmdfY29yZSgiUG9w
dWxhdGUgUFZJTkZPIFBBR0UgZm9yIHZHUFUgJWRcbiIsIHZncHUtPmlkKTsKIAlndnRfZGJnX2Nv
cmUoImFwZXJ0dXJlIGJhc2UgW0dNQURSXSAweCVsbHggc2l6ZSAweCVsbHhcbiIsCiAJCXZncHVf
YXBlcnR1cmVfZ21hZHJfYmFzZSh2Z3B1KSwgdmdwdV9hcGVydHVyZV9zeih2Z3B1KSk7CkBAIC01
OTMsMyArNTk1LDI1IEBAIHZvaWQgaW50ZWxfZ3Z0X3Jlc2V0X3ZncHUoc3RydWN0IGludGVsX3Zn
cHUgKnZncHUpCiAJaW50ZWxfZ3Z0X3Jlc2V0X3ZncHVfbG9ja2VkKHZncHUsIHRydWUsIDApOwog
CW11dGV4X3VubG9jaygmdmdwdS0+dmdwdV9sb2NrKTsKIH0KKworLyoqCisgKiBpbnRlbF9ndnRf
cmVhZF9zaGFyZWRfcGFnZSAtIHJlYWQgY29udGVudCBmcm9tIHNoYXJlZCBwYWdlCisgKi8KK2lu
dCBpbnRlbF9ndnRfcmVhZF9zaGFyZWRfcGFnZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwKKwkJ
dW5zaWduZWQgaW50IG9mZnNldCwgdm9pZCAqYnVmLCB1bnNpZ25lZCBsb25nIGxlbikKK3sKKwlp
bnQgcmV0ID0gLUVJTlZBTDsKKwl1bnNpZ25lZCBsb25nIGdwYTsKKworCWlmIChvZmZzZXQgPj0g
c2l6ZW9mKHN0cnVjdCBndnRfc2hhcmVkX3BhZ2UpKQorCQlnb3RvIGVycjsKKworCWdwYSA9IHZn
cHUtPnNoYXJlZF9wYWdlX2dwYSArIG9mZnNldDsKKwlyZXQgPSBpbnRlbF9ndnRfaHlwZXJ2aXNv
cl9yZWFkX2dwYSh2Z3B1LCBncGEsIGJ1ZiwgbGVuKTsKKwlpZiAoIXJldCkKKwkJcmV0dXJuIHJl
dDsKK2VycjoKKwlndnRfdmdwdV9lcnIoInJlYWQgc2hhcmVkIHBhZ2UgKG9mZnNldCAleCkgZmFp
bGVkIiwgb2Zmc2V0KTsKKwltZW1zZXQoYnVmLCAwLCBsZW4pOworCXJldHVybiByZXQ7Cit9Ci0t
IAoyLjcuNAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
aW50ZWwtZ3Z0LWRldiBtYWlsaW5nIGxpc3QKaW50ZWwtZ3Z0LWRldkBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1ndnQtZGV2
