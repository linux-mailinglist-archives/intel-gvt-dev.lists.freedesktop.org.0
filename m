Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 75D96618F0
	for <lists+intel-gvt-dev@lfdr.de>; Mon,  8 Jul 2019 03:35:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1D847899EA;
	Mon,  8 Jul 2019 01:35:50 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 89A96899E9;
 Mon,  8 Jul 2019 01:35:48 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 07 Jul 2019 18:35:48 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,464,1557212400"; d="scan'208";a="173131305"
Received: from xzhan34-mobl3.bj.intel.com ([10.238.154.53])
 by FMSMGA003.fm.intel.com with ESMTP; 07 Jul 2019 18:35:47 -0700
From: Xiaolin Zhang <xiaolin.zhang@intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH v7 7/9] drm/i915/gvt: GVTg handle shared_page setup
Date: Mon,  8 Jul 2019 09:35:20 +0800
Message-Id: <1562549722-27046-8-git-send-email-xiaolin.zhang@intel.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1562549722-27046-1-git-send-email-xiaolin.zhang@intel.com>
References: <1562549722-27046-1-git-send-email-xiaolin.zhang@intel.com>
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: Xiaolin Zhang <xiaolin.zhang@intel.com>,
 intel-gvt-dev@lists.freedesktop.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

R1ZUZyBpbXBsZW1lbnRlZCBzaGFyZWRfcGFnZSBzZXR1cCBvcGVyYXRpb24gYW5kIHJlYWRfc2hh
cmVkX3BhZ2UKZnVuY3Rpb25hbGl0eSBiYXNlZCBvbiBoeXBlcnZpc29yX3JlYWRfZ3BhKCkuCgp0
aGUgc2hhcmVkX3BhZ2VfZ3BhIHdhcyBwYXNzZWQgZnJvbSBndWVzdCBkcml2ZXIgdGhyb3VnaCBQ
VklORk8Kc2hhcmVkX3BhZ2VfZ3BhIHJlZ2lzdGVyLgoKdjA6IFJGQy4KdjE6IHJlYmFzZS4KdjI6
IHJlYmFzZS4KdjM6IGFkZGVkIHNoYXJlZF9wYWdlX2dwYSBjaGVjayBhbmQgaWYgcmVhZF9ncGEg
ZmFpbHVyZSwgcmV0dXJuIHplcm8KbWVtb3J5IGFuZCBoYW5kbGUgVkdUX0cyVl9TSEFSRURfUEFH
RV9TRVRVUCBnMnYgbm90aWZpY2F0aW9uCnY0OiByZWJhc2UuCnY1OiByZWJhc2UuCnY2OiByZWJh
c2UsIGFkZGVkIFBWIHZlcnNpb24gc3VwcG9ydC4Kdjc6IHJlYmFzZS4KClNpZ25lZC1vZmYtYnk6
IFhpYW9saW4gWmhhbmcgPHhpYW9saW4uemhhbmdAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d2dC9ndnQuaCAgICAgIHwgIDggKysrKysrLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2hhbmRsZXJzLmMgfCAyMCArKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L3ZncHUuYyAgICAgfCA0MyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrCiAzIGZpbGVzIGNoYW5nZWQsIDcwIGluc2VydGlvbnMoKyksIDEgZGVsZXRpb24oLSkK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZ3Z0LmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndnQvZ3Z0LmgKaW5kZXggN2ExZmU0NC4uZjdmNGIwMyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d2dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9ndnQuaApAQCAtNDksNiArNDksNyBAQAogI2luY2x1ZGUgImZiX2RlY29kZXIuaCIKICNp
bmNsdWRlICJkbWFidWYuaCIKICNpbmNsdWRlICJwYWdlX3RyYWNrLmgiCisjaW5jbHVkZSAiaTkx
NV92Z3B1LmgiCiAKICNkZWZpbmUgR1ZUX01BWF9WR1BVIDgKIApAQCAtMjI5LDYgKzIzMCw4IEBA
IHN0cnVjdCBpbnRlbF92Z3B1IHsKIAlzdHJ1Y3QgY29tcGxldGlvbiB2YmxhbmtfZG9uZTsKIAog
CXUzMiBzY2FuX25vbnByaXZiYjsKKwl1NjQgc2hhcmVkX3BhZ2VfZ3BhOworCWJvb2wgc2hhcmVk
X3BhZ2VfZW5hYmxlZDsKIH07CiAKIC8qIHZhbGlkYXRpbmcgR00gaGVhbHRoeSBzdGF0dXMqLwpA
QCAtNjg2LDcgKzY4OSwxMCBAQCBpbnQgaW50ZWxfZ3Z0X2RlYnVnZnNfYWRkX3ZncHUoc3RydWN0
IGludGVsX3ZncHUgKnZncHUpOwogdm9pZCBpbnRlbF9ndnRfZGVidWdmc19yZW1vdmVfdmdwdShz
dHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSk7CiBpbnQgaW50ZWxfZ3Z0X2RlYnVnZnNfaW5pdChzdHJ1
Y3QgaW50ZWxfZ3Z0ICpndnQpOwogdm9pZCBpbnRlbF9ndnRfZGVidWdmc19jbGVhbihzdHJ1Y3Qg
aW50ZWxfZ3Z0ICpndnQpOwotCitpbnQgaW50ZWxfZ3Z0X3JlYWRfc2hhcmVkX3BhZ2Uoc3RydWN0
IGludGVsX3ZncHUgKnZncHUsCisJCXVuc2lnbmVkIGludCBvZmZzZXQsIHZvaWQgKmJ1ZiwgdW5z
aWduZWQgbG9uZyBsZW4pOworaW50IGludGVsX2d2dF93cml0ZV9zaGFyZWRfcGFnZShzdHJ1Y3Qg
aW50ZWxfdmdwdSAqdmdwdSwKKwkJdW5zaWduZWQgaW50IG9mZnNldCwgdm9pZCAqYnVmLCB1bnNp
Z25lZCBsb25nIGxlbik7CiAKICNpbmNsdWRlICJ0cmFjZS5oIgogI2luY2x1ZGUgIm1wdC5oIgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2hhbmRsZXJzLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndnQvaGFuZGxlcnMuYwppbmRleCBkZWQ5N2IzLi40MTE1ZmQwIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvaGFuZGxlcnMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndnQvaGFuZGxlcnMuYwpAQCAtMTE5NSw2ICsxMTk1LDggQEAgc3RhdGlj
IGludCBwdmluZm9fbW1pb19yZWFkKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCB1bnNpZ25lZCBp
bnQgb2Zmc2V0LAogCWNhc2UgMHg3ODAxMDoJLyogdmd0X2NhcHMgKi8KIAljYXNlIDB4Nzg4MWM6
CiAJY2FzZSBfdmd0aWZfcmVnKHB2X2NhcHMpOgorCWNhc2UgX3ZndGlmX3JlZyhzaGFyZWRfcGFn
ZV9ncGEpOgorCWNhc2UgX3ZndGlmX3JlZyhzaGFyZWRfcGFnZV9ncGEpICsgNDoKIAkJYnJlYWs7
CiAJZGVmYXVsdDoKIAkJaW52YWxpZF9yZWFkID0gdHJ1ZTsKQEAgLTEyMTIsNiArMTIxNCw5IEBA
IHN0YXRpYyBpbnQgaGFuZGxlX2cydl9ub3RpZmljYXRpb24oc3RydWN0IGludGVsX3ZncHUgKnZn
cHUsIGludCBub3RpZmljYXRpb24pCiAJZW51bSBpbnRlbF9ndnRfZ3R0X3R5cGUgcm9vdF9lbnRy
eV90eXBlID0gR1RUX1RZUEVfUFBHVFRfUk9PVF9MNF9FTlRSWTsKIAlzdHJ1Y3QgaW50ZWxfdmdw
dV9tbSAqbW07CiAJdTY0ICpwZHBzOworCXVuc2lnbmVkIGxvbmcgZ3BhLCBnZm47CisJdTE2IHZl
cl9tYWpvciA9IFBWX01BSk9SOworCXUxNiB2ZXJfbWlub3IgPSBQVl9NSU5PUjsKIAogCXBkcHMg
PSAodTY0ICopJnZncHVfdnJlZzY0X3QodmdwdSwgdmd0aWZfcmVnKHBkcFswXSkpOwogCkBAIC0x
MjI1LDYgKzEyMzAsMTkgQEAgc3RhdGljIGludCBoYW5kbGVfZzJ2X25vdGlmaWNhdGlvbihzdHJ1
Y3QgaW50ZWxfdmdwdSAqdmdwdSwgaW50IG5vdGlmaWNhdGlvbikKIAljYXNlIFZHVF9HMlZfUFBH
VFRfTDNfUEFHRV9UQUJMRV9ERVNUUk9ZOgogCWNhc2UgVkdUX0cyVl9QUEdUVF9MNF9QQUdFX1RB
QkxFX0RFU1RST1k6CiAJCXJldHVybiBpbnRlbF92Z3B1X3B1dF9wcGd0dF9tbSh2Z3B1LCBwZHBz
KTsKKwljYXNlIFZHVF9HMlZfU0hBUkVEX1BBR0VfU0VUVVA6CisJCWdwYSA9IHZncHVfdnJlZzY0
X3QodmdwdSwgdmd0aWZfcmVnKHNoYXJlZF9wYWdlX2dwYSkpOworCQlnZm4gPSBncGEgPj4gUEFH
RV9TSElGVDsKKwkJaWYgKCFpbnRlbF9ndnRfaHlwZXJ2aXNvcl9pc192YWxpZF9nZm4odmdwdSwg
Z2ZuKSkgeworCQkJdmdwdV92cmVnX3QodmdwdSwgdmd0aWZfcmVnKHB2X2NhcHMpKSA9IDA7CisJ
CQlyZXR1cm4gMDsKKwkJfQorCQl2Z3B1LT5zaGFyZWRfcGFnZV9ncGEgPSBncGE7CisJCXZncHUt
PnNoYXJlZF9wYWdlX2VuYWJsZWQgPSB0cnVlOworCisJCWludGVsX2d2dF93cml0ZV9zaGFyZWRf
cGFnZSh2Z3B1LCAwLCAmdmVyX21ham9yLCAyKTsKKwkJaW50ZWxfZ3Z0X3dyaXRlX3NoYXJlZF9w
YWdlKHZncHUsIDIsICZ2ZXJfbWlub3IsIDIpOworCQlicmVhazsKIAljYXNlIFZHVF9HMlZfRVhF
Q0xJU1RfQ09OVEVYVF9DUkVBVEU6CiAJY2FzZSBWR1RfRzJWX0VYRUNMSVNUX0NPTlRFWFRfREVT
VFJPWToKIAljYXNlIDE6CS8qIFJlbW92ZSB0aGlzIGluIGd1ZXN0IGRyaXZlci4gKi8KQEAgLTEy
ODEsNiArMTI5OSw4IEBAIHN0YXRpYyBpbnQgcHZpbmZvX21taW9fd3JpdGUoc3RydWN0IGludGVs
X3ZncHUgKnZncHUsIHVuc2lnbmVkIGludCBvZmZzZXQsCiAJY2FzZSBfdmd0aWZfcmVnKHBkcFsz
XS5oaSk6CiAJY2FzZSBfdmd0aWZfcmVnKGV4ZWNsaXN0X2NvbnRleHRfZGVzY3JpcHRvcl9sbyk6
CiAJY2FzZSBfdmd0aWZfcmVnKGV4ZWNsaXN0X2NvbnRleHRfZGVzY3JpcHRvcl9oaSk6CisJY2Fz
ZSBfdmd0aWZfcmVnKHNoYXJlZF9wYWdlX2dwYSk6CisJY2FzZSBfdmd0aWZfcmVnKHNoYXJlZF9w
YWdlX2dwYSkgKyA0OgogCQlicmVhazsKIAljYXNlIF92Z3RpZl9yZWcocnN2NVswXSkuLi5fdmd0
aWZfcmVnKHJzdjVbM10pOgogCQlpbnZhbGlkX3dyaXRlID0gdHJ1ZTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d2dC92Z3B1LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQv
dmdwdS5jCmluZGV4IDNlY2M0NWEuLjE1MWYyNzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d2dC92Z3B1LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3ZncHUuYwpA
QCAtNjMsNiArNjMsOCBAQCB2b2lkIHBvcHVsYXRlX3B2aW5mb19wYWdlKHN0cnVjdCBpbnRlbF92
Z3B1ICp2Z3B1KQogCXZncHVfdnJlZ190KHZncHUsIHZndGlmX3JlZyhjdXJzb3JfeF9ob3QpKSA9
IFVJTlRfTUFYOwogCXZncHVfdnJlZ190KHZncHUsIHZndGlmX3JlZyhjdXJzb3JfeV9ob3QpKSA9
IFVJTlRfTUFYOwogCisJdmdwdV92cmVnNjRfdCh2Z3B1LCB2Z3RpZl9yZWcoc2hhcmVkX3BhZ2Vf
Z3BhKSkgPSAwOworCiAJZ3Z0X2RiZ19jb3JlKCJQb3B1bGF0ZSBQVklORk8gUEFHRSBmb3IgdkdQ
VSAlZFxuIiwgdmdwdS0+aWQpOwogCWd2dF9kYmdfY29yZSgiYXBlcnR1cmUgYmFzZSBbR01BRFJd
IDB4JWxseCBzaXplIDB4JWxseFxuIiwKIAkJdmdwdV9hcGVydHVyZV9nbWFkcl9iYXNlKHZncHUp
LCB2Z3B1X2FwZXJ0dXJlX3N6KHZncHUpKTsKQEAgLTU5MywzICs1OTUsNDQgQEAgdm9pZCBpbnRl
bF9ndnRfcmVzZXRfdmdwdShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAlpbnRlbF9ndnRfcmVz
ZXRfdmdwdV9sb2NrZWQodmdwdSwgdHJ1ZSwgMCk7CiAJbXV0ZXhfdW5sb2NrKCZ2Z3B1LT52Z3B1
X2xvY2spOwogfQorCisvKioKKyAqIGludGVsX2d2dF9yZWFkX3NoYXJlZF9wYWdlIC0gcmVhZCBj
b250ZW50IGZyb20gc2hhcmVkIHBhZ2UKKyAqLworaW50IGludGVsX2d2dF9yZWFkX3NoYXJlZF9w
YWdlKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LAorCQl1bnNpZ25lZCBpbnQgb2Zmc2V0LCB2b2lk
ICpidWYsIHVuc2lnbmVkIGxvbmcgbGVuKQoreworCWludCByZXQgPSAtRUlOVkFMOworCXVuc2ln
bmVkIGxvbmcgZ3BhOworCisJaWYgKG9mZnNldCA+PSBQQUdFX1NJWkUpCisJCWdvdG8gZXJyOwor
CisJZ3BhID0gdmdwdS0+c2hhcmVkX3BhZ2VfZ3BhICsgb2Zmc2V0OworCXJldCA9IGludGVsX2d2
dF9oeXBlcnZpc29yX3JlYWRfZ3BhKHZncHUsIGdwYSwgYnVmLCBsZW4pOworCWlmICghcmV0KQor
CQlyZXR1cm4gcmV0OworZXJyOgorCWd2dF92Z3B1X2VycigicmVhZCBzaGFyZWQgcGFnZSAob2Zm
c2V0ICV4KSBmYWlsZWQiLCBvZmZzZXQpOworCW1lbXNldChidWYsIDAsIGxlbik7CisJcmV0dXJu
IHJldDsKK30KKworaW50IGludGVsX2d2dF93cml0ZV9zaGFyZWRfcGFnZShzdHJ1Y3QgaW50ZWxf
dmdwdSAqdmdwdSwKKwkJdW5zaWduZWQgaW50IG9mZnNldCwgdm9pZCAqYnVmLCB1bnNpZ25lZCBs
b25nIGxlbikKK3sKKwlpbnQgcmV0ID0gLUVJTlZBTDsKKwl1bnNpZ25lZCBsb25nIGdwYTsKKwor
CWlmIChvZmZzZXQgPj0gUEFHRV9TSVpFKQorCQlnb3RvIGVycjsKKworCWdwYSA9IHZncHUtPnNo
YXJlZF9wYWdlX2dwYSArIG9mZnNldDsKKwlyZXQgPSBpbnRlbF9ndnRfaHlwZXJ2aXNvcl93cml0
ZV9ncGEodmdwdSwgZ3BhLCBidWYsIGxlbik7CisJaWYgKCFyZXQpCisJCXJldHVybiByZXQ7Citl
cnI6CisJZ3Z0X3ZncHVfZXJyKCJ3cml0ZSBzaGFyZWQgcGFnZSAob2Zmc2V0ICV4KSBmYWlsZWQi
LCBvZmZzZXQpOworCW1lbXNldChidWYsIDAsIGxlbik7CisJcmV0dXJuIHJldDsKK30KLS0gCjIu
Ny40CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwppbnRl
bC1ndnQtZGV2IG1haWxpbmcgbGlzdAppbnRlbC1ndnQtZGV2QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWd2
dC1kZXY=
