Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A0D81DAA2
	for <lists+intel-gvt-dev@lfdr.de>; Mon, 29 Apr 2019 05:11:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3CF3689128;
	Mon, 29 Apr 2019 03:11:31 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7224C8911F;
 Mon, 29 Apr 2019 03:11:29 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 28 Apr 2019 20:11:29 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.60,408,1549958400"; d="scan'208";a="146648210"
Received: from xzhan34-mobl3.bj.intel.com ([10.238.154.121])
 by fmsmga007.fm.intel.com with ESMTP; 28 Apr 2019 20:11:26 -0700
From: Xiaolin Zhang <xiaolin.zhang@intel.com>
To: intel-gvt-dev@lists.freedesktop.org,
	intel-gfx@lists.freedesktop.org
Subject: [PATCH v5 2/8] drm/i915: vgpu shared memory setup for pv optimization
Date: Mon, 29 Apr 2019 11:10:52 +0800
Message-Id: <1556507458-24684-3-git-send-email-xiaolin.zhang@intel.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1556507458-24684-1-git-send-email-xiaolin.zhang@intel.com>
References: <1556507458-24684-1-git-send-email-xiaolin.zhang@intel.com>
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: Xiaolin Zhang <xiaolin.zhang@intel.com>, zhenyu.z.wang@intel.com,
 joonas.lahtinen@linux.intel.com, hang.yuan@intel.com, min.he@intel.com,
 zhiyuan.lv@intel.com, chris@chris-wilson.co.uk, zhi.a.wang@intel.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

VG8gZW5hYmxlIHZncHUgcHYgZmVhdHVyZXMsIHdlIG5lZWQgdG8gc2V0dXAgYSBzaGFyZWQgbWVt
b3J5IHBhZ2UKd2hpY2ggd2lsbCBiZSB1c2VkIGZvciBkYXRhIGV4Y2hhbmdlIGRpcmVjdGx5IGFj
Y2Vzc2VkIGJldHdlZW4gYm90aApndWVzdCBhbmQgYmFja2VuZCBpOTE1IGRyaXZlciB0byBhdm9p
ZCBlbXVsYXRpb24gdHJhcCBjb3N0LgoKZ3Vlc3QgaTkxNSB3aWxsIGFsbG9jYXRlIHRoaXMgcGFn
ZSBtZW1vcnkgYW5kIHRoZW4gcGFzcyBpdCdzIHBoeXNpY2FsCmFkZHJlc3MgdG8gYmFja2VuZCBp
OTE1IGRyaXZlciB0aHJvdWdoIFBWSU5GTyByZWdpc3RlciBzbyB0aGF0IGJhY2tlbmQgaTkxNQpk
cml2ZXIgY2FuIGFjY2VzcyB0aGlzIHNoYXJlZCBwYWdlIG1lb3J5IHdpdGhvdXQgYW55IHRyYXAg
Y29zdCB3aXRoIHRoZQpoZWxwIGZvcm0gaHlwZXJ2aXNlcidzIHJlYWQgZ3Vlc3QgZ3BhIGZ1bmN0
aW9uYWxpdHkuCgpndWVzdCBpOTE1IHdpbGwgc2VuZCBWR1RfRzJWX1NIQVJFRF9QQUdFX1NFVFVQ
IG5vdGlmaWNhdGlvbiB0byBob3N0IEdWVApvbmNlIHNoYXJlZCBtZW1vcnkgc2V0dXAgZmluaXNo
ZWQuCgp0aGUgbGF5b3V0IG9mIHRoZSBzaGFyZWRfcGFnZSBhbHNvIGRlZmluZWQgYXMgd2VsbCBp
biB0aGlzIHBhdGNoIHdoaWNoCmlzIHVzZWQgZm9yIHB2IGZlYXR1cmVzIGltcGxlbWVudGF0aW9u
LgoKdjA6IFJGQwp2MTogYWRkcmVzc2VkIFJGQyBjb21tZW50IHRvIG1vdmUgYm90aCBzaGFyZWRf
cGFnZV9sb2NrIGFuZCBzaGFyZWRfcGFnZQp0byBpOTE1X3ZpcnR1YWxfZ3B1IHN0cnVjdHVyZQp2
MjogcGFja2VkIGk5MTVfdmlydHVhbF9ncHUgc3RydWN0dXJlCnYzOiBhZGRlZCBTSEFSRURfUEFH
RV9TRVRVUCBnMnYgbm90aWZpY2F0aW9uIGZvciBwdiBzaGFyZWRfcGFnZSBzZXR1cAp2NDogYWRk
ZWQgaW50ZWxfdmdwdV9zZXR1cF9zaGFyZWRfcGFnZSgpIGluIGk5MTVfdmdwdV9wdi5jCnY1OiBw
ZXIgZW5naW5lIGRlc2MgZGF0YSBpbiBzaGFyZWQgbWVtb3J5CgpTaWduZWQtb2ZmLWJ5OiBYaWFv
bGluIFpoYW5nIDx4aWFvbGluLnpoYW5nQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5oICAgIHwgIDQgKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9w
dmluZm8uaCB8ICA1ICsrKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZncHUuYyAgIHwg
NDAgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfdmdwdS5oICAgfCAyMCArKysrKysrKysrKysrKysrKysrCiA0IGZpbGVzIGNo
YW5nZWQsIDY3IGluc2VydGlvbnMoKyksIDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmgKaW5kZXggOTFhMTZiMzUuLmFjZjkwMzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApA
QCAtMTI0NCw3ICsxMjQ0LDkgQEAgc3RydWN0IGk5MTVfdmlydHVhbF9ncHUgewogCWJvb2wgYWN0
aXZlOwogCXUzMiBjYXBzOwogCXUzMiBwdl9jYXBzOwotfTsKKwlzcGlubG9ja190IHNoYXJlZF9w
YWdlX2xvY2tbSTkxNV9OVU1fRU5HSU5FU107CisJc3RydWN0IGd2dF9zaGFyZWRfcGFnZSAqc2hh
cmVkX3BhZ2U7Cit9IF9fcGFja2VkOwogCiAvKiB1c2VkIGluIGNvbXB1dGluZyB0aGUgbmV3IHdh
dGVybWFya3Mgc3RhdGUgKi8KIHN0cnVjdCBpbnRlbF93bV9jb25maWcgewpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wdmluZm8uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcHZpbmZvLmgKaW5kZXggNjE5MzA1YS4uNDY1N2JmNyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9wdmluZm8uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3B2aW5mby5oCkBAIC00Niw2ICs0Niw3IEBAIGVudW0gdmd0X2cydl90eXBlIHsKIAlWR1Rf
RzJWX1BQR1RUX0w0X1BBR0VfVEFCTEVfREVTVFJPWSwKIAlWR1RfRzJWX0VYRUNMSVNUX0NPTlRF
WFRfQ1JFQVRFLAogCVZHVF9HMlZfRVhFQ0xJU1RfQ09OVEVYVF9ERVNUUk9ZLAorCVZHVF9HMlZf
U0hBUkVEX1BBR0VfU0VUVVAsCiAJVkdUX0cyVl9NQVgsCiB9OwogCkBAIC0xMTAsNyArMTExLDkg
QEAgc3RydWN0IHZndF9pZiB7CiAKIAl1MzIgcHZfY2FwczsKIAotCXUzMiAgcnN2N1sweDIwMCAt
IDI1XTsgICAgLyogcGFkIHRvIG9uZSBwYWdlICovCisJdTY0IHNoYXJlZF9wYWdlX2dwYTsKKwor
CXUzMiAgcnN2N1sweDIwMCAtIDI3XTsgICAgLyogcGFkIHRvIG9uZSBwYWdlICovCiB9IF9fcGFj
a2VkOwogCiAjZGVmaW5lIHZndGlmX3JlZyh4KSBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3ZncHUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdmdwdS5jCmlu
ZGV4IDczMjlmNWEuLmRhNDM5YjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdmdwdS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdmdwdS5jCkBAIC0xMzUs
NiArMTM1LDkgQEAgdm9pZCBpbnRlbF92Z3RfZGViYWxsb29uKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAogCWZvciAoaSA9IDA7IGkgPCA0OyBpKyspCiAJCXZndF9kZWJhbGxv
b25fc3BhY2UoJmRldl9wcml2LT5nZ3R0LCAmYmxfaW5mby5zcGFjZVtpXSk7CisKKwlpZiAoZGV2
X3ByaXYtPnZncHUuc2hhcmVkX3BhZ2UpCisJCWZyZWVfcGFnZSgodW5zaWduZWQgbG9uZylkZXZf
cHJpdi0+dmdwdS5zaGFyZWRfcGFnZSk7CiB9CiAKIHN0YXRpYyBpbnQgdmd0X2JhbGxvb25fc3Bh
Y2Uoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwKQEAgLTI4Niw2ICsyODksMzggQEAgaW50IGludGVs
X3ZndF9iYWxsb29uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKICAqIGk5MTUg
dmdwdSBQViBzdXBwb3J0IGZvciBMaW51eAogICovCiAKKy8qCisgKiBzaGFyZWRfcGFnZSBzZXR1
cCBmb3IgVkdQVSBQViBmZWF0dXJlcworICovCitzdGF0aWMgaW50IGludGVsX3ZncHVfc2V0dXBf
c2hhcmVkX3BhZ2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoreworCXN0cnVj
dCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJpdi0+dW5jb3JlOworCXU2NCBncGE7CisJ
aW50IGk7CisKKwlkZXZfcHJpdi0+dmdwdS5zaGFyZWRfcGFnZSA9ICAoc3RydWN0IGd2dF9zaGFy
ZWRfcGFnZSAqKQorCQkJZ2V0X3plcm9lZF9wYWdlKEdGUF9LRVJORUwpOworCWlmICghZGV2X3By
aXYtPnZncHUuc2hhcmVkX3BhZ2UpIHsKKwkJRFJNX0VSUk9SKCJvdXQgb2YgbWVtb3J5IGZvciBz
aGFyZWQgcGFnZSBtZW1vcnlcbiIpOworCQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwkvKiBwYXNz
IGd1ZXN0IG1lbW9yeSBwYSBhZGRyZXNzIHRvIEdWVCBhbmQgdGhlbiByZWFkIGJhY2sgdG8gdmVy
aWZ5ICovCisJZ3BhID0gX19wYShkZXZfcHJpdi0+dmdwdS5zaGFyZWRfcGFnZSk7CisJX19yYXdf
dW5jb3JlX3dyaXRlNjQodW5jb3JlLCB2Z3RpZl9yZWcoc2hhcmVkX3BhZ2VfZ3BhKSwgZ3BhKTsK
KwlpZiAoZ3BhICE9IF9fcmF3X3VuY29yZV9yZWFkNjQodW5jb3JlLCB2Z3RpZl9yZWcoc2hhcmVk
X3BhZ2VfZ3BhKSkpIHsKKwkJRFJNX0VSUk9SKCJ2Z3B1OiBwYXNzZWQgc2hhcmVkX3BhZ2VfZ3Bh
IGZhaWxlZFxuIik7CisJCWZyZWVfcGFnZSgodW5zaWduZWQgbG9uZylkZXZfcHJpdi0+dmdwdS5z
aGFyZWRfcGFnZSk7CisJCXJldHVybiAtRUlPOworCX0KKwlfX3Jhd191bmNvcmVfd3JpdGUzMih1
bmNvcmUsIHZndGlmX3JlZyhnMnZfbm90aWZ5KSwKKwkJCVZHVF9HMlZfU0hBUkVEX1BBR0VfU0VU
VVApOworCWZvciAoaSA9IDA7IGkgPCBJOTE1X05VTV9FTkdJTkVTOyBpKyspCisJCXNwaW5fbG9j
a19pbml0KCZkZXZfcHJpdi0+dmdwdS5zaGFyZWRfcGFnZV9sb2NrW2ldKTsKKworCXJldHVybiAw
OworfQorCiAvKioKICAqIGludGVsX3ZncHVfY2hlY2tfcHZfY2FwcyAtIGRldGVjdCB2aXJ0dWFs
IEdQVSBQViBjYXBhYmlsaXRpZXMKICAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgcHJpdmF0ZQpA
QCAtMzEzLDYgKzM0OCwxMSBAQCBib29sIGludGVsX3ZncHVfY2hlY2tfcHZfY2FwcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYgKCFwdmNhcHMpCiAJCXJldHVybiBmYWxz
ZTsKIAorCWlmIChpbnRlbF92Z3B1X3NldHVwX3NoYXJlZF9wYWdlKGRldl9wcml2KSkgeworCQlk
ZXZfcHJpdi0+dmdwdS5wdl9jYXBzID0gMDsKKwkJcmV0dXJuIGZhbHNlOworCX0KKwogCV9fcmF3
X3VuY29yZV93cml0ZTMyKHVuY29yZSwgdmd0aWZfcmVnKHB2X2NhcHMpLCBwdmNhcHMpOwogCiAJ
cmV0dXJuIHRydWU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZncHUu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdmdwdS5oCmluZGV4IDkxMDEwZmMuLjY5N2M0
MjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdmdwdS5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdmdwdS5oCkBAIC0yNiw2ICsyNiwyNiBAQAogCiAjaW5j
bHVkZSAiaTkxNV9wdmluZm8uaCIKIAorLyoKKyAqIEEgc2hhcmVkIHBhZ2UoNEtCKSBiZXR3ZWVu
IGd2dCBhbmQgVk0sIGNvdWxkIGJlIGFsbG9jYXRlZCBieSBndWVzdCBkcml2ZXIKKyAqIG9yIGEg
Zml4ZWQgbG9jYXRpb24gaW4gUENJIGJhciAwIHJlZ2lvbgorICovCitzdHJ1Y3QgcHZfcHBndHRf
dXBkYXRlIHsKKwl1NjQgcGRwOworCXU2NCBzdGFydDsKKwl1NjQgbGVuZ3RoOworCXUzMiBjYWNo
ZV9sZXZlbDsKK307CisKK3N0cnVjdCBwdl9zdWJtaXNzaW9uIHsKKwl1NjQgZGVzY3NbRVhFQ0xJ
U1RfTUFYX1BPUlRTXTsKK307CisKK3N0cnVjdCBndnRfc2hhcmVkX3BhZ2UgeworCXN0cnVjdCBw
dl9wcGd0dF91cGRhdGUgcHZfcHBndHQ7CisJc3RydWN0IHB2X3N1Ym1pc3Npb24gcHZfZWxzcFtJ
OTE1X05VTV9FTkdJTkVTXTsKK307CisKIHZvaWQgaTkxNV9jaGVja192Z3B1KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiAKIGJvb2wgaW50ZWxfdmdwdV9oYXNfZnVsbF9wcGd0
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotLSAKMi43LjQKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmludGVsLWd2dC1kZXYgbWFp
bGluZyBsaXN0CmludGVsLWd2dC1kZXZAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ3Z0LWRldg==
