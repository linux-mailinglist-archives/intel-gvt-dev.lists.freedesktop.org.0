Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4022D6CC0C
	for <lists+intel-gvt-dev@lfdr.de>; Thu, 18 Jul 2019 11:40:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F0DAB6E375;
	Thu, 18 Jul 2019 09:40:14 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 17D706E384
 for <intel-gvt-dev@lists.freedesktop.org>;
 Thu, 18 Jul 2019 09:40:14 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 18 Jul 2019 02:40:13 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,276,1559545200"; d="scan'208";a="175970587"
Received: from cfl-host.sh.intel.com ([10.239.158.129])
 by FMSMGA003.fm.intel.com with ESMTP; 18 Jul 2019 02:40:12 -0700
From: fred gao <fred.gao@intel.com>
To: intel-gvt-dev@lists.freedesktop.org
Subject: [PATCH v3 3/3] drm/i915/gvt: Add valid length check for MI variable
 commands
Date: Thu, 18 Jul 2019 09:39:18 +0800
Message-Id: <20190718013918.3389-1-fred.gao@intel.com>
X-Mailer: git-send-email 2.17.1
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: Gao@freedesktop.org, "Gao, Fred" <fred.gao@intel.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

RnJvbTogIkdhbywgRnJlZCIgPGZyZWQuZ2FvQGludGVsLmNvbT4KCkFkZCB2YWxpZCBsZW5ndGgg
Y2hlY2sgZm9yIHRoZSBjb21tYW5kcyB3aXRoIHZhcmlhYmxlIGxlbmd0aC4KCnYyOiByZW1vdmUg
dGhlIG1hY3JvIGRlZmluaXRpb24uIChaaGVueXUpCnYzOiByZWZpbmUgdGhlIExSSSBjb21tYW5k
LiAoWmhlbnl1KQoKU2lnbmVkLW9mZi1ieTogR2FvLCBGcmVkIDxmcmVkLmdhb0BpbnRlbC5jb20+
Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2NtZF9wYXJzZXIuYyB8IDUyICsrKysrKysr
KysrKysrKysrKysrKysrKysrKwogMSBmaWxlIGNoYW5nZWQsIDUyIGluc2VydGlvbnMoKykKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L2NtZF9wYXJzZXIuYwppbmRleCBhNzMxMDJlYmQ3NmUuLjQ0OTFj
Njg3ZmI4MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2NtZF9wYXJzZXIu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jCkBAIC0zNzQsNiAr
Mzc0LDkgQEAgdHlwZWRlZiBpbnQgKCpwYXJzZXJfY21kX2hhbmRsZXIpKHN0cnVjdCBwYXJzZXJf
ZXhlY19zdGF0ZSAqcyk7CiAjZGVmaW5lIEFERFJfRklYXzQoeDEsIHgyLCB4MywgeDQpCShBRERS
X0ZJWF8xKHgxKSB8IEFERFJfRklYXzMoeDIsIHgzLCB4NCkpCiAjZGVmaW5lIEFERFJfRklYXzUo
eDEsIHgyLCB4MywgeDQsIHg1KSAgKEFERFJfRklYXzEoeDEpIHwgQUREUl9GSVhfNCh4MiwgeDMs
IHg0LCB4NSkpCiAKKyNkZWZpbmUgRFdPUkRfRklFTEQoZHdvcmQsIGVuZCwgc3RhcnQpIFwKKwlG
SUVMRF9HRVQoR0VOTUFTSyhlbmQsIHN0YXJ0KSwgY21kX3ZhbChzLCBkd29yZCkpCisKICNkZWZp
bmUgT1BfTEVOR1RIX0JJQVMgMgogI2RlZmluZSBDTURfTEVOKHZhbHVlKSAgKHZhbHVlICsgT1Bf
TEVOR1RIX0JJQVMpCiAKQEAgLTk2MCw2ICs5NjMsMTggQEAgc3RhdGljIGludCBjbWRfaGFuZGxl
cl9scmkoc3RydWN0IHBhcnNlcl9leGVjX3N0YXRlICpzKQogCWludCBpLCByZXQgPSAwOwogCWlu
dCBjbWRfbGVuID0gY21kX2xlbmd0aChzKTsKIAlzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQgPSBzLT52
Z3B1LT5ndnQ7CisJdTMyIHZhbGlkX2xlbiA9IENNRF9MRU4oMSk7CisKKwkvKgorCSAqIE9mZmlj
aWFsIGludGVsIGRvY3MgYXJlIHNvbWV3aGF0IHNsb3BweSAsIGNoZWNrIHRoZSBkZWZpbml0aW9u
IG9mCisJICogTUlfTE9BRF9SRUdJU1RFUl9JTU0uCisJICovCisJI2RlZmluZSBNQVhfVkFMSURf
TEVOIDEyNworCWlmICgoY21kX2xlbiA8IHZhbGlkX2xlbikgfHwgKGNtZF9sZW4gPiBNQVhfVkFM
SURfTEVOKSkgeworCQlndnRfZXJyKCJsZW4gaXMgbm90IHZhbGlkOiAgbGVuPSV1ICB2YWxpZF9s
ZW49JXVcbiIsCisJCQljbWRfbGVuLCB2YWxpZF9sZW4pOworCQlyZXR1cm4gLUVGQVVMVDsKKwl9
CiAKIAlmb3IgKGkgPSAxOyBpIDwgY21kX2xlbjsgaSArPSAyKSB7CiAJCWlmIChJU19CUk9BRFdF
TEwoZ3Z0LT5kZXZfcHJpdikgJiYgcy0+cmluZ19pZCAhPSBSQ1MwKSB7CkBAIC0xMzkxLDYgKzE0
MDYsMTUgQEAgc3RhdGljIGludCBjbWRfaGFuZGxlcl9taV9kaXNwbGF5X2ZsaXAoc3RydWN0IHBh
cnNlcl9leGVjX3N0YXRlICpzKQogCWludCByZXQ7CiAJaW50IGk7CiAJaW50IGxlbiA9IGNtZF9s
ZW5ndGgocyk7CisJdTMyIHZhbGlkX2xlbiA9IENNRF9MRU4oMSk7CisKKwkvKiBGbGlwIFR5cGUg
PT0gU3RlcmVvIDNEIEZsaXAgKi8KKwlpZiAoRFdPUkRfRklFTEQoMiwgMSwgMCkgPT0gMikKKwkJ
dmFsaWRfbGVuKys7CisJcmV0ID0gZ3Z0X2NoZWNrX3ZhbGlkX2NtZF9sZW5ndGgoY21kX2xlbmd0
aChzKSwKKwkJCXZhbGlkX2xlbik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAogCXJldCA9
IGRlY29kZV9taV9kaXNwbGF5X2ZsaXAocywgJmluZm8pOwogCWlmIChyZXQpIHsKQEAgLTE1MTAs
MTIgKzE1MzQsMjEgQEAgc3RhdGljIGludCBjbWRfaGFuZGxlcl9taV9zdG9yZV9kYXRhX2ltbShz
dHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMpCiAJaW50IG9wX3NpemUgPSAoY21kX2xlbmd0aChz
KSAtIDMpICogc2l6ZW9mKHUzMik7CiAJaW50IGNvcmVfaWQgPSAoY21kX3ZhbChzLCAyKSAmICgx
IDw8IDApKSA/IDEgOiAwOwogCXVuc2lnbmVkIGxvbmcgZ21hLCBnbWFfbG93LCBnbWFfaGlnaDsK
Kwl1MzIgdmFsaWRfbGVuID0gQ01EX0xFTigyKTsKIAlpbnQgcmV0ID0gMDsKIAogCS8qIGNoZWNr
IHBwZ2d0ICovCiAJaWYgKCEoY21kX3ZhbChzLCAwKSAmICgxIDw8IDIyKSkpCiAJCXJldHVybiAw
OwogCisJLyogY2hlY2sgaWYgUVdPUkQgKi8KKwlpZiAoRFdPUkRfRklFTEQoMCwgMjEsIDIxKSkK
KwkJdmFsaWRfbGVuKys7CisJcmV0ID0gZ3Z0X2NoZWNrX3ZhbGlkX2NtZF9sZW5ndGgoY21kX2xl
bmd0aChzKSwKKwkJCXZhbGlkX2xlbik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwogCWdt
YSA9IGNtZF92YWwocywgMikgJiBHRU5NQVNLKDMxLCAyKTsKIAogCWlmIChnbWFkcl9ieXRlcyA9
PSA4KSB7CkBAIC0xNTU4LDExICsxNTkxLDIwIEBAIHN0YXRpYyBpbnQgY21kX2hhbmRsZXJfbWlf
b3BfMmYoc3RydWN0IHBhcnNlcl9leGVjX3N0YXRlICpzKQogCWludCBvcF9zaXplID0gKDEgPDwg
KChjbWRfdmFsKHMsIDApICYgR0VOTUFTSygyMCwgMTkpKSA+PiAxOSkpICoKIAkJCXNpemVvZih1
MzIpOwogCXVuc2lnbmVkIGxvbmcgZ21hLCBnbWFfaGlnaDsKKwl1MzIgdmFsaWRfbGVuID0gQ01E
X0xFTigxKTsKIAlpbnQgcmV0ID0gMDsKIAogCWlmICghKGNtZF92YWwocywgMCkgJiAoMSA8PCAy
MikpKQogCQlyZXR1cm4gcmV0OwogCisJLyogY2hlY2sgaWYgUVdPUkQgKi8KKwlpZiAoRFdPUkRf
RklFTEQoMCwgMjAsIDE5KSA9PSAxKQorCQl2YWxpZF9sZW4gKz0gODsKKwlyZXQgPSBndnRfY2hl
Y2tfdmFsaWRfY21kX2xlbmd0aChjbWRfbGVuZ3RoKHMpLAorCQkJdmFsaWRfbGVuKTsKKwlpZiAo
cmV0KQorCQlyZXR1cm4gcmV0OworCiAJZ21hID0gY21kX3ZhbChzLCAxKSAmIEdFTk1BU0soMzEs
IDIpOwogCWlmIChnbWFkcl9ieXRlcyA9PSA4KSB7CiAJCWdtYV9oaWdoID0gY21kX3ZhbChzLCAy
KSAmIEdFTk1BU0soMTUsIDApOwpAQCAtMTYwMCw2ICsxNjQyLDE2IEBAIHN0YXRpYyBpbnQgY21k
X2hhbmRsZXJfbWlfZmx1c2hfZHcoc3RydWN0IHBhcnNlcl9leGVjX3N0YXRlICpzKQogCWJvb2wg
aW5kZXhfbW9kZSA9IGZhbHNlOwogCWludCByZXQgPSAwOwogCXUzMiBod3NfcGdhLCB2YWw7CisJ
dTMyIHZhbGlkX2xlbiA9IENNRF9MRU4oMik7CisKKwlyZXQgPSBndnRfY2hlY2tfdmFsaWRfY21k
X2xlbmd0aChjbWRfbGVuZ3RoKHMpLAorCQkJdmFsaWRfbGVuKTsKKwlpZiAocmV0KSB7CisJCS8q
IENoZWNrIGFnYWluIGZvciBRd29yZCAqLworCQlyZXQgPSBndnRfY2hlY2tfdmFsaWRfY21kX2xl
bmd0aChjbWRfbGVuZ3RoKHMpLAorCQkJKyt2YWxpZF9sZW4pOworCQlyZXR1cm4gcmV0OworCX0K
IAogCS8qIENoZWNrIHBvc3Qtc3luYyBhbmQgcHBndHQgYml0ICovCiAJaWYgKCgoY21kX3ZhbChz
LCAwKSA+PiAxNCkgJiAweDMpICYmIChjbWRfdmFsKHMsIDEpICYgKDEgPDwgMikpKSB7Ci0tIAoy
LjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmlu
dGVsLWd2dC1kZXYgbWFpbGluZyBsaXN0CmludGVsLWd2dC1kZXZAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwt
Z3Z0LWRldg==
