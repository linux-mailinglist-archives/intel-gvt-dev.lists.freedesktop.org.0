Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 91F806CA6C
	for <lists+intel-gvt-dev@lfdr.de>; Thu, 18 Jul 2019 09:58:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 409C56E338;
	Thu, 18 Jul 2019 07:58:01 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B06A36E338
 for <intel-gvt-dev@lists.freedesktop.org>;
 Thu, 18 Jul 2019 07:58:00 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 18 Jul 2019 00:58:00 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,276,1559545200"; d="scan'208";a="158713127"
Received: from gvt-optiplex-7060.bj.intel.com ([10.238.158.89])
 by orsmga007.jf.intel.com with ESMTP; 18 Jul 2019 00:57:57 -0700
From: Kechen Lu <kechen.lu@intel.com>
To: intel-gvt-dev@lists.freedesktop.org, kvm@vger.kernel.org,
 linux-kernel@vger.kernel.org
Subject: [RFC PATCH v4 6/6] drm/i915/gvt: Add cursor plane reg update trap
 emulation handler
Date: Thu, 18 Jul 2019 23:56:40 +0800
Message-Id: <20190718155640.25928-7-kechen.lu@intel.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190718155640.25928-1-kechen.lu@intel.com>
References: <20190718155640.25928-1-kechen.lu@intel.com>
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: kevin.tian@intel.com, zhenyuw@linux.intel.com, hang.yuan@intel.com,
 alex.williamson@redhat.com, kraxel@redhat.com, Kechen Lu <kechen.lu@intel.com>,
 zhi.a.wang@intel.com, zhiyuan.lv@intel.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBhZGRzIHRoZSBjdXJzb3IgcGxhbmUgQ1VSQkFTRSByZWcgdXBkYXRlIHRyYXAg
aGFuZGxlcgppbiBvcmRlciB0byA6CgotIERlbGl2ZXIgdGhlIGN1cnNvciByZWZyZXNoIGV2ZW50
IGF0IGVhY2ggdmJsYW5rIGVtdWxhdGlvbiwKdGhlIGZsaXBfZG9uZV9ldmVudCBiaXQgY2hlY2sg
aXMgc3VwcG9zZWQgdG8gZG8gaGVyZS4gSWYgY3Vyc29yCnBsYW5lIHVwZGF0ZXMgaGFwcGVuLCBk
ZWxpdmVyIHRoZSBjdXJzb3IgcmVmcmVzaCBldmVudHMuCgotIFN1cHBvcnQgdGhlIHN5bmMgYW5k
IGFzeW5jIGN1cnNvciBwbGFuZSB1cGRhdGVzIGFuZApjb3JyZXNwb25kaW5nIGN1cnNvciBwbGFu
ZSBmbGlwIGludGVycnVwdHMgcmVwb3J0aW5nLgoKU2lnbmVkLW9mZi1ieTogS2VjaGVuIEx1IDxr
ZWNoZW4ubHVAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9kaXNwbGF5
LmMgICB8IDExICsrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvaGFuZGxlcnMu
YyAgfCAyNyArKysrKysrKysrKysrKysrKysrKysrKystLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9pbnRlcnJ1cHQuYyB8ICA3ICsrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9p
bnRlcnJ1cHQuaCB8ICAzICsrKwogNCBmaWxlcyBjaGFuZ2VkLCA0NSBpbnNlcnRpb25zKCspLCAz
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9kaXNw
bGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZGlzcGxheS5jCmluZGV4IGRmNTJlNGI0
YzFiMC4uYTBhY2NjNTFkNDRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQv
ZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9kaXNwbGF5LmMKQEAgLTM5
OSw2ICszOTksNyBAQCBzdGF0aWMgdm9pZCBlbXVsYXRlX3ZibGFua19vbl9waXBlKHN0cnVjdCBp
bnRlbF92Z3B1ICp2Z3B1LCBpbnQgcGlwZSkKIAkJW1BJUEVfQ10gPSBQSVBFX0NfVkJMQU5LLAog
CX07CiAJaW50IHByaV9mbGlwX2V2ZW50ID0gU0tMX0ZMSVBfRVZFTlQocGlwZSwgUExBTkVfUFJJ
TUFSWSk7CisJaW50IGN1cl9mbGlwX2V2ZW50ID0gQ1VSU09SX0FfRkxJUF9ET05FICsgcGlwZTsK
IAlpbnQgZXZlbnQ7CiAJdTY0IGV2ZW50ZmRfc2lnbmFsX3ZhbCA9IDA7CiAJc3RhdGljIGludCBw
YWdlZmxpcF9jb3VudDsKQEAgLTQxNyw2ICs0MTgsMTEgQEAgc3RhdGljIHZvaWQgZW11bGF0ZV92
Ymxhbmtfb25fcGlwZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgaW50IHBpcGUpCiAJCQlwYWdl
ZmxpcF9jb3VudCArPSBQQUdFRkxJUF9JTkNfQ09VTlQ7CiAJCX0KIAorCQlpZiAoZXZlbnQgPT0g
Y3VyX2ZsaXBfZXZlbnQpIHsKKwkJCWV2ZW50ZmRfc2lnbmFsX3ZhbCArPSBESVNQTEFZX0NVUl9S
RUZSRVNIX0VWRU5UX0lOQzsKKwkJCXBhZ2VmbGlwX2NvdW50ICs9IFBBR0VGTElQX0lOQ19DT1VO
VDsKKwkJfQorCiAJCWludGVsX3ZncHVfdHJpZ2dlcl92aXJ0dWFsX2V2ZW50KHZncHUsIGV2ZW50
KTsKIAl9CiAKQEAgLTQzMCw2ICs0MzYsMTEgQEAgc3RhdGljIHZvaWQgZW11bGF0ZV92Ymxhbmtf
b25fcGlwZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgaW50IHBpcGUpCiAJCQlldmVudGZkX3Np
Z25hbF92YWwgKz0gRElTUExBWV9QUklfUkVGUkVTSF9FVkVOVF9JTkM7CiAJCQlwYWdlZmxpcF9j
b3VudCArPSBQQUdFRkxJUF9JTkNfQ09VTlQ7CiAJCX0KKworCQlpZiAoZXZlbnQgPT0gUExBTkVf
Q1VSU09SKSB7CisJCQlldmVudGZkX3NpZ25hbF92YWwgKz0gRElTUExBWV9DVVJfUkVGUkVTSF9F
VkVOVF9JTkM7CisJCQlwYWdlZmxpcF9jb3VudCArPSBQQUdFRkxJUF9JTkNfQ09VTlQ7CisJCX0K
IAl9CiAKIAlpZiAoLS1wYWdlZmxpcF9jb3VudCA8IDApIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d2dC9oYW5kbGVycy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2hh
bmRsZXJzLmMKaW5kZXggNmFkMjljNGYwOGU1Li44MjFmZjg4OTc3ZDggMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9oYW5kbGVycy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d2dC9oYW5kbGVycy5jCkBAIC03NjcsNiArNzY3LDI3IEBAIHN0YXRpYyBpbnQgcHJpX3N1
cmZfbW1pb193cml0ZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdW5zaWduZWQgaW50IG9mZnNl
dCwKIAlyZXR1cm4gMDsKIH0KIAorI2RlZmluZSBDVVJCQVNFX1RPX1BJUEUocmVnKSBcCisJY2Fs
Y19pbmRleChvZmZzZXQsIF9DVVJBQkFTRSwgX0NVUkJCQVNFLCAwLCBDVVJCQVNFKFBJUEVfQykp
CisKK3N0YXRpYyBpbnQgY3VyX3N1cmZfbW1pb193cml0ZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdw
dSwgdW5zaWduZWQgaW50IG9mZnNldCwKKwkJdm9pZCAqcF9kYXRhLCB1bnNpZ25lZCBpbnQgYnl0
ZXMpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5k
ZXZfcHJpdjsKKwl1MzIgcGlwZSA9IENVUkJBU0VfVE9fUElQRShvZmZzZXQpOworCWludCBldmVu
dCA9IENVUlNPUl9BX0ZMSVBfRE9ORSArIHBpcGU7CisKKwl3cml0ZV92cmVnKHZncHUsIG9mZnNl
dCwgcF9kYXRhLCBieXRlcyk7CisKKwlpZiAodmdwdV92cmVnX3QodmdwdSwgQ1VSQ05UUihwaXBl
KSkgJiBQTEFORV9DVExfQVNZTkNfRkxJUCkgeworCQlpbnRlbF92Z3B1X3RyaWdnZXJfdmlydHVh
bF9ldmVudCh2Z3B1LCBldmVudCk7CisJCXNldF9iaXQoUExBTkVfQ1VSU09SLCB2Z3B1LT5kaXNw
bGF5LmFzeW5jX2ZsaXBfZXZlbnRbcGlwZV0pOworCX0gZWxzZQorCQlzZXRfYml0KGV2ZW50LCB2
Z3B1LT5pcnEuZmxpcF9kb25lX2V2ZW50W3BpcGVdKTsKKworCXJldHVybiAwOworfQorCiAjZGVm
aW5lIFNQUlNVUkZfVE9fUElQRShvZmZzZXQpIFwKIAljYWxjX2luZGV4KG9mZnNldCwgX1NQUkFf
U1VSRiwgX1NQUkJfU1VSRiwgMCwgU1BSU1VSRihQSVBFX0MpKQogCkBAIC0xOTU1LDkgKzE5NzYs
OSBAQCBzdGF0aWMgaW50IGluaXRfZ2VuZXJpY19tbWlvX2luZm8oc3RydWN0IGludGVsX2d2dCAq
Z3Z0KQogCU1NSU9fRChDVVJQT1MoUElQRV9CKSwgRF9BTEwpOwogCU1NSU9fRChDVVJQT1MoUElQ
RV9DKSwgRF9BTEwpOwogCi0JTU1JT19EKENVUkJBU0UoUElQRV9BKSwgRF9BTEwpOwotCU1NSU9f
RChDVVJCQVNFKFBJUEVfQiksIERfQUxMKTsKLQlNTUlPX0QoQ1VSQkFTRShQSVBFX0MpLCBEX0FM
TCk7CisJTU1JT19ESChDVVJCQVNFKFBJUEVfQSksIERfQUxMLCBOVUxMLCBjdXJfc3VyZl9tbWlv
X3dyaXRlKTsKKwlNTUlPX0RIKENVUkJBU0UoUElQRV9CKSwgRF9BTEwsIE5VTEwsIGN1cl9zdXJm
X21taW9fd3JpdGUpOworCU1NSU9fREgoQ1VSQkFTRShQSVBFX0MpLCBEX0FMTCwgTlVMTCwgY3Vy
X3N1cmZfbW1pb193cml0ZSk7CiAKIAlNTUlPX0QoQ1VSX0ZCQ19DVEwoUElQRV9BKSwgRF9BTEwp
OwogCU1NSU9fRChDVVJfRkJDX0NUTChQSVBFX0IpLCBEX0FMTCk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndnQvaW50ZXJydXB0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dnQvaW50ZXJydXB0LmMKaW5kZXggOTUxNjgxODEzMjMwLi45YzJiOWQyZTE1MjkgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9pbnRlcnJ1cHQuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndnQvaW50ZXJydXB0LmMKQEAgLTExMyw2ICsxMTMsOSBAQCBzdGF0aWMgY29u
c3QgY2hhciAqIGNvbnN0IGlycV9uYW1lW0lOVEVMX0dWVF9FVkVOVF9NQVhdID0gewogCVtTUFJJ
VEVfQV9GTElQX0RPTkVdID0gIlNwcml0ZSBQbGFuZSBBIGZsaXAgZG9uZSIsCiAJW1NQUklURV9C
X0ZMSVBfRE9ORV0gPSAiU3ByaXRlIFBsYW5lIEIgZmxpcCBkb25lIiwKIAlbU1BSSVRFX0NfRkxJ
UF9ET05FXSA9ICJTcHJpdGUgUGxhbmUgQyBmbGlwIGRvbmUiLAorCVtDVVJTT1JfQV9GTElQX0RP
TkVdID0gIkN1cnNvciBQbGFuZSBBIGZsaXAgZG9uZSIsCisJW0NVUlNPUl9CX0ZMSVBfRE9ORV0g
PSAiQ3Vyc29yIFBsYW5lIEIgZmxpcCBkb25lIiwKKwlbQ1VSU09SX0NfRkxJUF9ET05FXSA9ICJD
dXJzb3IgUGxhbmUgQyBmbGlwIGRvbmUiLAogCiAJW1BDVV9USEVSTUFMXSA9ICJQQ1UgVGhlcm1h
bCBFdmVudCIsCiAJW1BDVV9QQ09ERTJEUklWRVJfTUFJTEJPWF0gPSAiUENVIHBjb2RlMmRyaXZl
ciBtYWlsYm94IGV2ZW50IiwKQEAgLTU5Myw2ICs1OTYsMTAgQEAgc3RhdGljIHZvaWQgZ2VuOF9p
bml0X2lycSgKIAkJU0VUX0JJVF9JTkZPKGlycSwgNCwgU1BSSVRFX0FfRkxJUF9ET05FLCBJTlRF
TF9HVlRfSVJRX0lORk9fREVfUElQRV9BKTsKIAkJU0VUX0JJVF9JTkZPKGlycSwgNCwgU1BSSVRF
X0JfRkxJUF9ET05FLCBJTlRFTF9HVlRfSVJRX0lORk9fREVfUElQRV9CKTsKIAkJU0VUX0JJVF9J
TkZPKGlycSwgNCwgU1BSSVRFX0NfRkxJUF9ET05FLCBJTlRFTF9HVlRfSVJRX0lORk9fREVfUElQ
RV9DKTsKKworCQlTRVRfQklUX0lORk8oaXJxLCA2LCBDVVJTT1JfQV9GTElQX0RPTkUsIElOVEVM
X0dWVF9JUlFfSU5GT19ERV9QSVBFX0EpOworCQlTRVRfQklUX0lORk8oaXJxLCA2LCBDVVJTT1Jf
Ql9GTElQX0RPTkUsIElOVEVMX0dWVF9JUlFfSU5GT19ERV9QSVBFX0IpOworCQlTRVRfQklUX0lO
Rk8oaXJxLCA2LCBDVVJTT1JfQ19GTElQX0RPTkUsIElOVEVMX0dWVF9JUlFfSU5GT19ERV9QSVBF
X0MpOwogCX0KIAogCS8qIEdFTjggaW50ZXJydXB0IFBDVSBldmVudHMgKi8KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9pbnRlcnJ1cHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d2dC9pbnRlcnJ1cHQuaAppbmRleCA1MzEzZmIxYjMzZTEuLjE1OGYxYzdhMjNmMiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2ludGVycnVwdC5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d2dC9pbnRlcnJ1cHQuaApAQCAtOTIsNiArOTIsOSBAQCBlbnVtIGlu
dGVsX2d2dF9ldmVudF90eXBlIHsKIAlTUFJJVEVfQV9GTElQX0RPTkUsCiAJU1BSSVRFX0JfRkxJ
UF9ET05FLAogCVNQUklURV9DX0ZMSVBfRE9ORSwKKwlDVVJTT1JfQV9GTElQX0RPTkUsCisJQ1VS
U09SX0JfRkxJUF9ET05FLAorCUNVUlNPUl9DX0ZMSVBfRE9ORSwKIAogCVBDVV9USEVSTUFMLAog
CVBDVV9QQ09ERTJEUklWRVJfTUFJTEJPWCwKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KaW50ZWwtZ3Z0LWRldiBtYWlsaW5nIGxpc3QK
aW50ZWwtZ3Z0LWRldkBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1ndnQtZGV2
