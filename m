Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gvt-dev@lfdr.de
Delivered-To: lists+intel-gvt-dev@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id AACFB7839A
	for <lists+intel-gvt-dev@lfdr.de>; Mon, 29 Jul 2019 05:17:53 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0990F89D8D;
	Mon, 29 Jul 2019 03:17:52 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 17B7989D8D
 for <intel-gvt-dev@lists.freedesktop.org>;
 Mon, 29 Jul 2019 03:17:50 +0000 (UTC)
X-Amp-Result: UNKNOWN
X-Amp-Original-Verdict: FILE UNKNOWN
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 28 Jul 2019 20:17:50 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,321,1559545200"; d="scan'208";a="176255939"
Received: from joy-optiplex-7040.sh.intel.com (HELO joy-OptiPlex-7040)
 ([10.239.13.9])
 by orsmga006.jf.intel.com with ESMTP; 28 Jul 2019 20:17:48 -0700
Date: Sun, 28 Jul 2019 23:11:42 -0400
From: Yan Zhao <yan.y.zhao@intel.com>
To: Tina Zhang <tina.zhang@intel.com>
Subject: Re: [PATCH] drm/i915/gvt: Double check batch buffer size after copy
Message-ID: <20190729031141.GA26151@joy-OptiPlex-7040>
References: <20190729004220.3171-1-tina.zhang@intel.com>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20190729004220.3171-1-tina.zhang@intel.com>
User-Agent: Mutt/1.9.4 (2018-02-28)
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Reply-To: Yan Zhao <yan.y.zhao@intel.com>
Cc: intel-gvt-dev@lists.freedesktop.org, zhiyuan.lv@intel.com,
 zhenyuw@linux.intel.com, hang.yuan@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

UmV2aWV3ZWQtYnk6IFlhbiBaaGFvIDx5YW4ueS56aGFvQGludGVsLmNvbT4KCk9uIE1vbiwgSnVs
IDI5LCAyMDE5IGF0IDA4OjQyOjIwQU0gKzA4MDAsIFRpbmEgWmhhbmcgd3JvdGU6Cj4gRG91Ymxl
IGNoZWNrIHRoZSBzaXplIG9mIHRoZSBwcml2aWxlZ2UgYnVmZmVyIHRvIG1ha2Ugc3VyZSB0aGUg
c2l6ZQo+IHJlbWFpbnMgdW5jaGFuZ2VkIGFmdGVyIGNvcHkuCj4gCj4gdjM6Cj4gLSBUbyBnZXQg
dGhlIHJpZ2h0IG9mZnNldCBvZiB0aGUgYmF0Y2ggYnVmZmVyIGVuZCBjbWQuIChZYW4pCj4gCj4g
djI6Cj4gLSBVc2UgbGlnaHR3ZWlnaHQgd2F5IHRvIGF1ZGl0IGJhdGNoIGJ1ZmZlciBlbmQuIChZ
YW4pCj4gCj4gQ2M6IFlhbiBaaGFvIDx5YW4ueS56aGFvQGludGVsLmNvbT4KPiBTaWduZWQtb2Zm
LWJ5OiBUaW5hIFpoYW5nIDx0aW5hLnpoYW5nQGludGVsLmNvbT4KPiAtLS0KPiAgZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Z0L2NtZF9wYXJzZXIuYyB8IDM5ICsrKysrKysrKysrKysrKysrKysrKysr
KystLQo+ICAxIGZpbGUgY2hhbmdlZCwgMzcgaW5zZXJ0aW9ucygrKSwgMiBkZWxldGlvbnMoLSkK
PiAKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2NtZF9wYXJzZXIuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRfcGFyc2VyLmMKPiBpbmRleCA2ZWE4ODI3MGM4
MTguLmE2NDFlM2VlMWZlNCAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQv
Y21kX3BhcnNlci5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2NtZF9wYXJzZXIu
Ywo+IEBAIC0xNjYxLDcgKzE2NjEsOSBAQCBzdGF0aWMgaW50IGJhdGNoX2J1ZmZlcl9uZWVkc19z
Y2FuKHN0cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAqcykKPiAgCXJldHVybiAxOwo+ICB9Cj4gIAo+
IC1zdGF0aWMgaW50IGZpbmRfYmJfc2l6ZShzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMsIHVu
c2lnbmVkIGxvbmcgKmJiX3NpemUpCj4gK3N0YXRpYyBpbnQgZmluZF9iYl9zaXplKHN0cnVjdCBw
YXJzZXJfZXhlY19zdGF0ZSAqcywKPiArCQkJdW5zaWduZWQgbG9uZyAqYmJfc2l6ZSwKPiArCQkJ
dW5zaWduZWQgbG9uZyAqYmJfZW5kX2NtZF9vZmZzZXQpCj4gIHsKPiAgCXVuc2lnbmVkIGxvbmcg
Z21hID0gMDsKPiAgCWNvbnN0IHN0cnVjdCBjbWRfaW5mbyAqaW5mbzsKPiBAQCAtMTY3Myw2ICsx
Njc1LDcgQEAgc3RhdGljIGludCBmaW5kX2JiX3NpemUoc3RydWN0IHBhcnNlcl9leGVjX3N0YXRl
ICpzLCB1bnNpZ25lZCBsb25nICpiYl9zaXplKQo+ICAJCXMtPnZncHUtPmd0dC5nZ3R0X21tIDog
cy0+d29ya2xvYWQtPnNoYWRvd19tbTsKPiAgCj4gIAkqYmJfc2l6ZSA9IDA7Cj4gKwkqYmJfZW5k
X2NtZF9vZmZzZXQgPSAwOwo+ICAKPiAgCS8qIGdldCB0aGUgc3RhcnQgZ20gYWRkcmVzcyBvZiB0
aGUgYmF0Y2ggYnVmZmVyICovCj4gIAlnbWEgPSBnZXRfZ21hX2JiX2Zyb21fY21kKHMsIDEpOwo+
IEBAIC0xNzA4LDYgKzE3MTEsMTAgQEAgc3RhdGljIGludCBmaW5kX2JiX3NpemUoc3RydWN0IHBh
cnNlcl9leGVjX3N0YXRlICpzLCB1bnNpZ25lZCBsb25nICpiYl9zaXplKQo+ICAJCQkJLyogY2hh
aW5lZCBiYXRjaCBidWZmZXIgKi8KPiAgCQkJCWJiX2VuZCA9IHRydWU7Cj4gIAkJfQo+ICsKPiAr
CQlpZiAoYmJfZW5kKQo+ICsJCQkqYmJfZW5kX2NtZF9vZmZzZXQgPSAqYmJfc2l6ZTsKPiArCj4g
IAkJY21kX2xlbiA9IGdldF9jbWRfbGVuZ3RoKGluZm8sIGNtZCkgPDwgMjsKPiAgCQkqYmJfc2l6
ZSArPSBjbWRfbGVuOwo+ICAJCWdtYSArPSBjbWRfbGVuOwo+IEBAIC0xNzE2LDEyICsxNzIzLDM2
IEBAIHN0YXRpYyBpbnQgZmluZF9iYl9zaXplKHN0cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAqcywg
dW5zaWduZWQgbG9uZyAqYmJfc2l6ZSkKPiAgCXJldHVybiAwOwo+ICB9Cj4gIAo+ICtzdGF0aWMg
aW50IGF1ZGl0X2JiX2VuZChzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMsIHZvaWQgKnZhKQo+
ICt7Cj4gKwlzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSA9IHMtPnZncHU7Cj4gKwl1MzIgY21kID0g
Kih1MzIgKil2YTsKPiArCWNvbnN0IHN0cnVjdCBjbWRfaW5mbyAqaW5mbzsKPiArCj4gKwlpbmZv
ID0gZ2V0X2NtZF9pbmZvKHMtPnZncHUtPmd2dCwgY21kLCBzLT5yaW5nX2lkKTsKPiArCWlmIChp
bmZvID09IE5VTEwpIHsKPiArCQlndnRfdmdwdV9lcnIoInVua25vd24gY21kIDB4JXgsIG9wY29k
ZT0weCV4LCBhZGRyX3R5cGU9JXMsIHJpbmcgJWQsIHdvcmtsb2FkPSVwXG4iLAo+ICsJCQljbWQs
IGdldF9vcGNvZGUoY21kLCBzLT5yaW5nX2lkKSwKPiArCQkJKHMtPmJ1Zl9hZGRyX3R5cGUgPT0g
UFBHVFRfQlVGRkVSKSA/Cj4gKwkJCSJwcGd0dCIgOiAiZ2d0dCIsIHMtPnJpbmdfaWQsIHMtPndv
cmtsb2FkKTsKPiArCQlyZXR1cm4gLUVCQURSUUM7Cj4gKwl9Cj4gKwo+ICsJaWYgKChpbmZvLT5v
cGNvZGUgPT0gT1BfTUlfQkFUQ0hfQlVGRkVSX0VORCkgfHwKPiArCSAgICAoKGluZm8tPm9wY29k
ZSA9PSBPUF9NSV9CQVRDSF9CVUZGRVJfU1RBUlQpICYmCj4gKwkgICAgIChCQVRDSF9CVUZGRVJf
Mk5EX0xFVkVMX0JJVChjbWQpID09IDApKSkKPiArCQlyZXR1cm4gMDsKPiArCj4gKwlyZXR1cm4g
LUVCQURSUUM7Cj4gK30KPiArCj4gIHN0YXRpYyBpbnQgcGVyZm9ybV9iYl9zaGFkb3coc3RydWN0
IHBhcnNlcl9leGVjX3N0YXRlICpzKQo+ICB7Cj4gIAlzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSA9
IHMtPnZncHU7Cj4gIAlzdHJ1Y3QgaW50ZWxfdmdwdV9zaGFkb3dfYmIgKmJiOwo+ICAJdW5zaWdu
ZWQgbG9uZyBnbWEgPSAwOwo+ICAJdW5zaWduZWQgbG9uZyBiYl9zaXplOwo+ICsJdW5zaWduZWQg
bG9uZyBiYl9lbmRfY21kX29mZnNldDsKPiAgCWludCByZXQgPSAwOwo+ICAJc3RydWN0IGludGVs
X3ZncHVfbW0gKm1tID0gKHMtPmJ1Zl9hZGRyX3R5cGUgPT0gR1RUX0JVRkZFUikgPwo+ICAJCXMt
PnZncHUtPmd0dC5nZ3R0X21tIDogcy0+d29ya2xvYWQtPnNoYWRvd19tbTsKPiBAQCAtMTczMiw3
ICsxNzYzLDcgQEAgc3RhdGljIGludCBwZXJmb3JtX2JiX3NoYWRvdyhzdHJ1Y3QgcGFyc2VyX2V4
ZWNfc3RhdGUgKnMpCj4gIAlpZiAoZ21hID09IElOVEVMX0dWVF9JTlZBTElEX0FERFIpCj4gIAkJ
cmV0dXJuIC1FRkFVTFQ7Cj4gIAo+IC0JcmV0ID0gZmluZF9iYl9zaXplKHMsICZiYl9zaXplKTsK
PiArCXJldCA9IGZpbmRfYmJfc2l6ZShzLCAmYmJfc2l6ZSwgJmJiX2VuZF9jbWRfb2Zmc2V0KTsK
PiAgCWlmIChyZXQpCj4gIAkJcmV0dXJuIHJldDsKPiAgCj4gQEAgLTE3ODgsNiArMTgxOSwxMCBA
QCBzdGF0aWMgaW50IHBlcmZvcm1fYmJfc2hhZG93KHN0cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAq
cykKPiAgCQlnb3RvIGVycl91bm1hcDsKPiAgCX0KPiAgCj4gKwlyZXQgPSBhdWRpdF9iYl9lbmQo
cywgYmItPnZhICsgc3RhcnRfb2Zmc2V0ICsgYmJfZW5kX2NtZF9vZmZzZXQpOwo+ICsJaWYgKHJl
dCkKPiArCQlnb3RvIGVycl91bm1hcDsKPiArCj4gIAlJTklUX0xJU1RfSEVBRCgmYmItPmxpc3Qp
Owo+ICAJbGlzdF9hZGQoJmJiLT5saXN0LCAmcy0+d29ya2xvYWQtPnNoYWRvd19iYik7Cj4gIAo+
IC0tIAo+IDIuMTcuMQo+IAo+IF9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCj4gaW50ZWwtZ3Z0LWRldiBtYWlsaW5nIGxpc3QKPiBpbnRlbC1ndnQtZGV2QGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwo+IGh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vaW50ZWwtZ3Z0LWRldgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwppbnRlbC1ndnQtZGV2IG1haWxpbmcgbGlzdAppbnRlbC1ndnQtZGV2
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWd2dC1kZXY=
